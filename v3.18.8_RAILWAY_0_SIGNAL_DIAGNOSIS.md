# ğŸš¨ Railway 0ä¿¡å·é—®é¢˜è¯Šæ–­æŠ¥å‘Š

**é—®é¢˜**ï¼šRailwayéƒ¨ç½²åæ¯ä¸ªå‘¨æœŸæ‰«æ530ä¸ªäº¤æ˜“å¯¹ï¼Œä½†**0ä¸ªä¿¡å·ç”Ÿæˆ**

**æ—¥æœŸ**ï¼š2025-11-01

---

## ğŸ“Š é—®é¢˜ç°è±¡

### **æ—¥å¿—è¯æ®**

```
2025-11-01 11:01:22 - ğŸ“Š æƒæ 530 å€‹äº¤æ˜“å°ä¸­...
2025-11-01 11:01:22 - â¸ï¸  æœ¬é€±æœŸç„¡æ–°ä¿¡è™Ÿ
2025-11-01 11:01:22 - âœ… é€±æœŸå®Œæˆ | è€—æ™‚: 0.9s | æ–°æˆäº¤: 0

2025-11-01 11:02:22 - ğŸ“Š æƒæ 530 å€‹äº¤æ˜“å°ä¸­...
2025-11-01 11:02:23 - â¸ï¸  æœ¬é€±æœŸç„¡æ–°ä¿¡è™Ÿ
2025-11-01 11:02:23 - âœ… é€±æœŸå®Œæˆ | è€—æ™‚: 1.0s | æ–°æˆäº¤: 0

...ï¼ˆæŒç»­0ä¿¡å·ï¼‰
```

### **å…³é”®å¼‚å¸¸**

1. **æ²¡æœ‰è¶‹åŠ¿ç»Ÿè®¡æ—¥å¿—**
   - åº”è¯¥æ¯50ä¸ªäº¤æ˜“å¯¹æ‰“å°ä¸€æ¬¡ç»Ÿè®¡ï¼ˆç¬¬162è¡Œï¼‰
   - æ—¥å¿—ä¸­å®Œå…¨æ²¡æœ‰è¿™äº›è­¦å‘Šä¿¡æ¯
   - è¯´æ˜ `generate_signal()` **è¢«æå‰è¿‡æ»¤ï¼Œæ ¹æœ¬æ²¡æ‰§è¡Œ**

2. **WebSocketæ•°æ®æ­£å¸¸**
   - `DataService WebSocketçµ±è¨ˆï¼ˆæœ€è¿‘5åˆ†é˜ï¼‰: WebSocketå‘½ä¸­: 2651 (100.0%)`
   - æ•°æ®è·å–æ²¡æœ‰é—®é¢˜

3. **ç³»ç»Ÿè¿è¡Œæ­£å¸¸**
   - è´¦æˆ·ä½™é¢ï¼š37.44 USDT
   - æ— æŒä»“
   - äº¤æ˜“å‘¨æœŸæ­£å¸¸å¾ªç¯

---

## ğŸ” æ ¹æœ¬åŸå› åˆ†æ

### **ä¿¡å·ç”Ÿæˆæµç¨‹**

```python
UnifiedScheduler._execute_trading_cycle()
  â†“
SelfLearningTrader.analyze(symbol, multi_tf_data)  # ç¬¬328è¡Œ
  â†“
base_signal = self.signal_generator.generate_signal(symbol, multi_tf_data)  # ç¬¬107è¡Œ
  â†“
if base_signal is None:  # ç¬¬109è¡Œ
    return None  # âŒ è¢«è¿™é‡Œè¿‡æ»¤äº†ï¼
```

### **è¿‡æ»¤ç‚¹1ï¼šä¿¡å·æ–¹å‘åˆ¤æ–­**

**æ–‡ä»¶**ï¼š`src/strategies/rule_based_signal_generator.py` ç¬¬132-140è¡Œ

```python
signal_direction = self._determine_signal_direction(
    h1_trend,
    m15_trend,
    m5_trend,
    market_structure,
    order_blocks,
    liquidity_zones,
    current_price
)

if not signal_direction:  # ç¬¬143è¡Œ
    # âŒ å¦‚æœæ²¡æœ‰ä¿¡å·æ–¹å‘ï¼Œåœ¨ç¬¬162è¡Œæ‰“å°ç»Ÿè®¡
    # ä½†æ—¥å¿—ä¸­æ²¡æœ‰è¿™äº›ç»Ÿè®¡ï¼
    return None  # ç¬¬170è¡Œ
```

**ç»“è®º**ï¼š`_determine_signal_direction()` å¯èƒ½æ²¡æœ‰è¿”å›Noneï¼Œè€Œæ˜¯è¢«åç»­è¿‡æ»¤

---

### **è¿‡æ»¤ç‚¹2ï¼šé˜ˆå€¼éªŒè¯ï¼ˆâŒ æœ€å¯èƒ½çš„åŸå› ï¼‰**

**æ–‡ä»¶**ï¼š`src/strategies/self_learning_trader.py` ç¬¬148-158è¡Œ

```python
# æ­¥é©Ÿ 4ï¼šé©—è­‰é–‹å€‰æ¢ä»¶ï¼ˆä½¿ç”¨å‹•æ…‹é–€æª»ï¼‰
is_valid, reject_reason = self.leverage_engine.validate_signal_conditions(
    win_probability, 
    confidence, 
    rr_ratio,
    min_win_probability=thresholds['min_win_probability'],  # âŒ å…³é”®ï¼
    min_confidence=thresholds['min_confidence']             # âŒ å…³é”®ï¼
)

if not is_valid:
    logger.debug(f"âŒ {symbol} æ‹’çµ•é–‹å€‰: {reject_reason}")  # âŒ debugçº§åˆ«æ—¥å¿—ä¸æ˜¾ç¤ºï¼
    return None  # âŒ è¢«è¿™é‡Œè¿‡æ»¤äº†ï¼
```

### **é˜ˆå€¼æ¥æº**

**æ–‡ä»¶**ï¼š`src/strategies/self_learning_trader.py` ç¬¬1271-1278è¡Œ

```python
def _get_current_thresholds(self):
    if not self.bootstrap_enabled or not self.trade_recorder:
        # è±å…æœªå¯ç”¨æˆ–æ— è®°å½•å™¨ï¼Œä½¿ç”¨æ­£å¸¸é—¨æ§›
        return {
            'min_win_probability': self.config.MIN_WIN_PROBABILITY,  # âŒ é»˜è®¤å€¼ï¼Ÿ
            'min_confidence': self.config.MIN_CONFIDENCE,            # âŒ é»˜è®¤å€¼ï¼Ÿ
            'is_bootstrap': False,
            'completed_trades': 0
        }
```

### **é»˜è®¤é˜ˆå€¼**

**æ–‡ä»¶**ï¼š`src/config.py`

```python
MIN_WIN_PROBABILITY: float = float(os.getenv("MIN_WIN_PROBABILITY", "0.52"))  # âŒ 52%
MIN_CONFIDENCE: float = float(os.getenv("MIN_CONFIDENCE", "0.50"))             # âŒ 50%
```

---

## ğŸš¨ **é—®é¢˜ç¡®å®šï¼šé»˜è®¤é˜ˆå€¼è¿‡é«˜ï¼**

### **å½“å‰æƒ…å†µ**

| å‚æ•° | Railwayè®¾ç½® | ä»£ç é»˜è®¤å€¼ | å®é™…ä½¿ç”¨å€¼ |
|------|------------|-----------|-----------|
| **MIN_WIN_PROBABILITY** | âŒ æœªè®¾ç½® | **0.52** | **0.52** âŒ |
| **MIN_CONFIDENCE** | âŒ æœªè®¾ç½® | **0.50** | **0.50** âŒ |
| **BOOTSTRAP_TRADE_LIMIT** | âœ… 100 | 100 | 100 âœ… |
| **BOOTSTRAP_MIN_WIN_PROBABILITY** | âŒ æœªè®¾ç½® | **0.40** | **0.40** |
| **BOOTSTRAP_MIN_CONFIDENCE** | âŒ æœªè®¾ç½® | **0.40** | **0.40** |

### **è±å…æœŸæœªç”Ÿæ•ˆåŸå› **

```python
if not self.bootstrap_enabled or not self.trade_recorder:
    # âŒ å¦‚æœ trade_recorder ä¸ºç©ºï¼Œç›´æ¥ä½¿ç”¨æ­£å¸¸é—¨æ§›ï¼ˆMIN_CONFIDENCE=0.50ï¼‰
    return {
        'min_win_probability': 0.52,  # âŒ å¤ªé«˜ï¼
        'min_confidence': 0.50,       # âŒ å¤ªé«˜ï¼
        'is_bootstrap': False
    }
```

**å¯èƒ½åŸå› **ï¼š
1. `self.trade_recorder` æœªæ­£ç¡®åˆå§‹åŒ–
2. æˆ–è€…è±å…æœŸåˆ¤æ–­é€»è¾‘æœ‰é—®é¢˜

---

## ğŸ¯ **v3.18.8 EMAåå·®ç­–ç•¥çš„é¢„æœŸèƒœç‡**

### **åå·®è´¨é‡ â†’ åŸºç¡€èƒœç‡æ˜ å°„**

æ ¹æ® `_calculate_ema_based_win_probability()` ç¬¬739-756è¡Œï¼š

```python
base_win_rate = {
    'excellent': 0.675,  # 67.5%
    'good': 0.625,       # 62.5%
    'fair': 0.575,       # 57.5%
    'poor': 0.525        # 52.5%
}
```

**ç†æƒ³åå·®åŒºé—´é¢å¤–åŠ æˆ**ï¼š+3%

**æœ€ç»ˆèŒƒå›´**ï¼š52.5% - 70.5%

### **ä¿¡å¿ƒåº¦èŒƒå›´**

æ ¹æ® `_calculate_confidence()` ç¬¬477-502è¡Œï¼ŒEMAåå·®è¯„åˆ†æ›¿æ¢40%æƒé‡ï¼š

- **EMAåå·®è¯„åˆ†**ï¼š0-40åˆ†
- **å¸‚åœºç»“æ„**ï¼š0-20åˆ†
- **Order Blockä½ç½®**ï¼š0-20åˆ†
- **åŠ¨é‡æŒ‡æ ‡**ï¼š0-10åˆ†
- **æ³¢åŠ¨ç‡**ï¼š0-10åˆ†

**æ€»åˆ†**ï¼š0-100åˆ† â†’ è½¬æ¢ä¸º 0.0-1.0

**é¢„æœŸä¿¡å¿ƒåº¦èŒƒå›´**ï¼š0.30 - 0.80

---

## ğŸ”¥ **å…³é”®å‘ç°ï¼šé˜ˆå€¼é”™é…**

| åœºæ™¯ | é¢„æœŸèƒœç‡èŒƒå›´ | é¢„æœŸä¿¡å¿ƒåº¦èŒƒå›´ | å®é™…é˜ˆå€¼ | ç»“æœ |
|------|------------|--------------|---------|------|
| **Poorè´¨é‡ä¿¡å·** | 52.5% | 0.30-0.50 | å‹ç‡â‰¥52%, ä¿¡å¿ƒâ‰¥50% | âŒ **è¢«è¿‡æ»¤** |
| **Fairè´¨é‡ä¿¡å·** | 57.5% | 0.40-0.60 | å‹ç‡â‰¥52%, ä¿¡å¿ƒâ‰¥50% | âš ï¸ **éƒ¨åˆ†é€šè¿‡** |
| **Goodè´¨é‡ä¿¡å·** | 62.5% | 0.50-0.70 | å‹ç‡â‰¥52%, ä¿¡å¿ƒâ‰¥50% | âœ… **é€šè¿‡** |
| **Excellentè´¨é‡ä¿¡å·** | 67.5%-70.5% | 0.60-0.80 | å‹ç‡â‰¥52%, ä¿¡å¿ƒâ‰¥50% | âœ… **é€šè¿‡** |

### **é—®é¢˜**

1. **Poor/Fairè´¨é‡ä¿¡å·è¢«å®Œå…¨è¿‡æ»¤**ï¼ˆä¿¡å¿ƒåº¦ < 50%ï¼‰
2. **å¯åŠ¨è±å…æœŸæœªç”Ÿæ•ˆ**ï¼ˆåº”è¯¥æ˜¯40%/40%ï¼Œä½†å®é™…ä½¿ç”¨52%/50%ï¼‰
3. **v3.18.8ä¿®å¤é¢„æœŸæ— æ³•éªŒè¯**ï¼ˆä¸­ä½è´¨é‡ä¿¡å·å…¨éƒ¨è¢«é˜ˆå€¼æ‹¦æˆªï¼‰

---

## ğŸ’¡ **è§£å†³æ–¹æ¡ˆ**

### **æ–¹æ¡ˆ1ï¼šéªŒè¯è±å…æœŸé€»è¾‘**

æ£€æŸ¥ `self.trade_recorder` æ˜¯å¦æ­£ç¡®åˆå§‹åŒ–ï¼š

```python
# src/strategies/self_learning_trader.py ç¬¬51è¡Œ
self.trade_recorder = trade_recorder
```

å¦‚æœ `trade_recorder=None`ï¼Œè±å…æœŸæ°¸è¿œä¸ä¼šç”Ÿæ•ˆï¼

### **æ–¹æ¡ˆ2ï¼šRailwayç¯å¢ƒå˜é‡è®¾ç½®**

**å¿…é¡»æ·»åŠ **ï¼š
```bash
MIN_WIN_PROBABILITY=0.40          # å¯åŠ¨æœŸ40%
MIN_CONFIDENCE=0.40               # å¯åŠ¨æœŸ40%
RELAXED_SIGNAL_MODE=true          # å®½æ¾æ¨¡å¼
```

**å¿…é¡»åˆ é™¤**ï¼š
```bash
SIGNAL_QUALITY_THRESHOLD          # åˆ é™¤ï¼ˆä½¿ç”¨å†…éƒ¨é€»è¾‘ï¼‰
```

### **æ–¹æ¡ˆ3ï¼šä¸´æ—¶é™ä½é»˜è®¤é˜ˆå€¼ï¼ˆä»£ç ä¿®æ”¹ï¼‰**

**æ–‡ä»¶**ï¼š`src/config.py` ç¬¬53è¡Œ

```python
# æ—§å€¼
MIN_CONFIDENCE: float = float(os.getenv("MIN_CONFIDENCE", "0.50"))

# æ–°å€¼ï¼ˆä¸´æ—¶ï¼‰
MIN_CONFIDENCE: float = float(os.getenv("MIN_CONFIDENCE", "0.40"))
```

**æ–‡ä»¶**ï¼š`src/config.py` ç¬¬49è¡Œï¼ˆæ–°å¢ï¼‰

```python
MIN_WIN_PROBABILITY: float = float(os.getenv("MIN_WIN_PROBABILITY", "0.40"))
```

---

## ğŸ”§ **è¯Šæ–­æ­¥éª¤**

### **1. æ£€æŸ¥è±å…æœŸçŠ¶æ€**

åœ¨Railwayæ—¥å¿—ä¸­æœç´¢ï¼š
```
ğŸ“ å•Ÿå‹•è±å…
```

**å¦‚æœæœ‰**ï¼šè±å…æœŸå·²ç”Ÿæ•ˆï¼Œä½¿ç”¨40%/40%é—¨æ§›  
**å¦‚æœæ²¡æœ‰**ï¼šè±å…æœŸæœªç”Ÿæ•ˆï¼Œä½¿ç”¨52%/50%é—¨æ§› âŒ

### **2. æ£€æŸ¥æ‹’ç»åŸå› **

å°†æ—¥å¿—çº§åˆ«æ”¹ä¸ºDEBUGï¼š
```bash
LOG_LEVEL=DEBUG
```

é‡å¯ååœ¨æ—¥å¿—ä¸­æœç´¢ï¼š
```
âŒ .* æ‹’çµ•é–‹å€‰
```

æŸ¥çœ‹å…·ä½“æ‹’ç»åŸå› ã€‚

### **3. æ£€æŸ¥ä¿¡å·ç”Ÿæˆç»Ÿè®¡**

åœ¨æ—¥å¿—ä¸­æœç´¢ï¼š
```
ğŸ” ä¿¡è™Ÿç”Ÿæˆçµ±è¨ˆ
```

**å¦‚æœæœ‰**ï¼šè¯´æ˜ `_determine_signal_direction()` è¿”å›None  
**å¦‚æœæ²¡æœ‰**ï¼šè¯´æ˜è¢«æ›´æ—©çš„é€»è¾‘è¿‡æ»¤ï¼ˆæ•°æ®éªŒè¯å¤±è´¥æˆ–å¼‚å¸¸ï¼‰

---

## ğŸ“‹ **æ¨èè¡ŒåŠ¨è®¡åˆ’**

### **ç«‹å³æ‰§è¡Œ**

1. **è®¾ç½®Railwayç¯å¢ƒå˜é‡**ï¼š
   ```bash
   MIN_WIN_PROBABILITY=0.40
   MIN_CONFIDENCE=0.40
   RELAXED_SIGNAL_MODE=true
   LOG_LEVEL=DEBUG  # ä¸´æ—¶è°ƒè¯•
   ```

2. **åˆ é™¤ç¯å¢ƒå˜é‡**ï¼š
   ```bash
   SIGNAL_QUALITY_THRESHOLD  # åˆ é™¤
   ```

3. **é‡å¯RailwayæœåŠ¡**

4. **è§‚å¯Ÿæ—¥å¿—**ï¼š
   - æ˜¯å¦å‡ºç° `ğŸ“ å•Ÿå‹•è±å…`
   - æ˜¯å¦å‡ºç° `âŒ æ‹’çµ•é–‹å€‰` åŠåŸå› 
   - æ˜¯å¦å‡ºç° `ğŸ” ä¿¡è™Ÿç”Ÿæˆçµ±è¨ˆ`

### **å¦‚æœä»ç„¶0ä¿¡å·**

5. **æ£€æŸ¥ `trade_recorder` åˆå§‹åŒ–**

6. **ä¸´æ—¶ä¿®æ”¹ä»£ç **ï¼ˆå¼ºåˆ¶å¯åŠ¨è±å…ï¼‰ï¼š
   ```python
   # src/strategies/self_learning_trader.py ç¬¬1271è¡Œ
   def _get_current_thresholds(self):
       # ğŸ”¥ ä¸´æ—¶å¼ºåˆ¶å¯åŠ¨è±å…
       return {
           'min_win_probability': 0.40,
           'min_confidence': 0.40,
           'is_bootstrap': True,
           'completed_trades': 0
       }
   ```

---

## ğŸ¯ **é¢„æœŸç»“æœ**

### **è®¾ç½®40%/40%é˜ˆå€¼å**

| åå·®è´¨é‡ | é¢„æœŸèƒœç‡ | é¢„æœŸä¿¡å¿ƒåº¦ | 40%/40%é˜ˆå€¼ | ç»“æœ |
|---------|---------|-----------|------------|------|
| **Poor** | 52.5% | 0.30-0.50 | â‰¥40%/40% | âœ… **å¤§éƒ¨åˆ†é€šè¿‡** |
| **Fair** | 57.5% | 0.40-0.60 | â‰¥40%/40% | âœ… **é€šè¿‡** |
| **Good** | 62.5% | 0.50-0.70 | â‰¥40%/40% | âœ… **é€šè¿‡** |
| **Excellent** | 67.5%-70.5% | 0.60-0.80 | â‰¥40%/40% | âœ… **é€šè¿‡** |

**é¢„æœŸä¿¡å·æ•°é‡**ï¼š30-60ä¸ª/å‘¨æœŸï¼ˆä¿®å¤è¶‹åŠ¿åˆ¤æ–­åï¼‰

---

## ğŸ“Š **æ€»ç»“**

### **æ ¹æœ¬åŸå› **

**é˜ˆå€¼è¿‡é«˜**ï¼šMIN_CONFIDENCE=0.50ï¼ŒMIN_WIN_PROBABILITY=0.52  
**å¯åŠ¨è±å…æœªç”Ÿæ•ˆ**ï¼šå¯èƒ½ `trade_recorder` æœªåˆå§‹åŒ–

### **å½±å“**

- v3.18.8è¶‹åŠ¿åˆ¤æ–­ä¿®å¤æ•ˆæœ**æ— æ³•éªŒè¯**
- EMAåå·®ç­–ç•¥äº§ç”Ÿçš„ä¸­ä½è´¨é‡ä¿¡å·**å…¨éƒ¨è¢«è¿‡æ»¤**
- ç³»ç»Ÿå®é™…ä½¿ç”¨æ­£å¸¸æœŸé—¨æ§›ï¼ˆ52%/50%ï¼‰ï¼Œè€Œéå¯åŠ¨æœŸé—¨æ§›ï¼ˆ40%/40%ï¼‰

### **è§£å†³æ–¹æ³•**

1. âœ… **ç«‹å³è®¾ç½®ç¯å¢ƒå˜é‡**ï¼š`MIN_WIN_PROBABILITY=0.40`, `MIN_CONFIDENCE=0.40`
2. âœ… **å¯ç”¨å®½æ¾æ¨¡å¼**ï¼š`RELAXED_SIGNAL_MODE=true`
3. âœ… **åˆ é™¤è´¨é‡é˜ˆå€¼**ï¼šç§»é™¤ `SIGNAL_QUALITY_THRESHOLD`
4. â³ **é‡å¯éªŒè¯**ï¼šè§‚å¯Ÿå¯åŠ¨è±å…æ˜¯å¦ç”Ÿæ•ˆ

---

**ç”Ÿæˆæ—¥æœŸ**ï¼š2025-11-01  
**æŠ¥å‘Šç‰ˆæœ¬**ï¼šv1.0  
**çŠ¶æ€**ï¼šğŸ”´ **ç´§æ€¥**ï¼ˆ0ä¿¡å·é—®é¢˜éœ€ç«‹å³ä¿®å¤ï¼‰
