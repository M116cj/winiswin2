# Railway 简化日志模式

> **用途**: 只显示核心信息 - 当前盈亏、模型学习状态、健康监控、错误/警告

---

## ✅ 保留的日志（INFO 级别）

### 1. 当前盈亏 (P&L)
```
💰 賬戶餘額: 總額=$1000.00 | 可用=$950.00 | 保證金=$50.00 | 未實現盈虧=$+10.50
📦 當前持倉: 2 個 | 總未實現盈虧: $+15.30
   • BTCUSDT LONG | 信心值=85.0% | 勝率=70.0% | 盈虧=$+10.20 (+0.75%)
   • ETHUSDT SHORT | 信心值=78.0% | 勝率=65.0% | 盈虧=$+5.10 (+0.42%)

📊 歷史統計摘要
   總交易次數: 25 筆
   歷史總盈虧: $+150.30
   歷史總報酬率: +15.03%
   歷史總勝率: 56.00% (14/25)
```

### 2. 模型學習狀態
```
🔄 模型重訓練: 性能驟降/市場狀態劇變/樣本累積...
✅ 模型已更新

🧠 開始訓練 XGBoost 模型...
✅ XGBoost 模型訓練完成
📊 訓練AUC: 0.782
📊 驗證AUC: 0.701
```

### 3. 訂單執行結果（簡化）
```
✅ 訂單成功: BTCUSDT LONG @ $67000.00 | 槓桿=8x | 數量=0.01
❌ 訂單失敗: ETHUSDT LONG | 錯誤: Insufficient margin
```

### 4. 健康監控（僅異常）
```
⚠️ 健康檢查異常:
   ├─ WebSocket: ❌ 連接中斷
   ├─ 內存使用: ⚠️ 78% (接近上限)
   └─ 連續失敗次數: 2/3

🚨 系統健康告警！
   連續失敗: 3次 ≥ 3次閾值
   問題組件: WebSocket, 數據庫
```

### 5. 錯誤和警告
```
❌ DATABASE_URL未配置！无法启动系统
❌ 数据库连接失败: connection refused
❌ 訂單失敗: Insufficient margin
⚠️ API連接測試未通過，將在實際調用時重試
⚠️ 平均分析時間48.5ms，可能分析深度不足
```

---

## ❌ 移除的日誌（降級為 DEBUG）

### 系統啟動詳情
- 配置驗證詳情
- 組件初始化詳情（數據服務、模型評估器、技術引擎等）
- WebSocket 連接詳情
- 數據庫連接池詳情

### 交易周期詳情
- 交易週期標頭（`🔄 交易週期 #123 | 2025-11-10...`）
- 掃描進度（`📊 掃描 50 個交易對中...`）
- 批次處理詳情（`批次 1: 64個symbols...`）
- 時間分析報告（平均分析時間、最快/最慢分析）
- 信號診斷（信心值Top 10、Stage7詳細診斷）

### 信號生成詳情
- ML預測詳細過程
- 規則引擎分析詳情
- 槓桿計算詳情
- 止損/止盈調整詳情

### 數據庫操作詳情
- 連接池初始化詳情
- 每次INSERT/SELECT操作
- RETURNING查詢返回值
- 連接獲取/歸還

### WebSocket 詳情
- 心跳正常日誌
- 數據接收詳情（K線、價格、倉位更新）
- ShardFeed/AccountFeed初始化

---

## 📊 簡化效果對比

### 修改前（每個交易周期約 200+ 行日誌）
```
================================================================================
🔄 交易週期 #123 | 2025-11-10 05:36:00 UTC
================================================================================
✅ 配置驗證通過
✅ Binance 客戶端已連接
✅ 數據服務初始化完成
✅ 数据库连接池已创建
...（省略150行）...
📊 信號分析診斷（信心值Top 10）
...（省略30行）...
🔍 Stage7 - 雙門檻驗證詳細診斷
...（省略20行）...
```

### 修改後（每個交易周期約 10-15 行日誌）
```
💰 賬戶餘額: 總額=$1000.00 | 可用=$950.00 | 未實現盈虧=$+10.50
📦 當前持倉: 2 個 | 總未實現盈虧: $+15.30
   • BTCUSDT LONG | 盈虧=$+10.20 (+0.75%)
   • ETHUSDT SHORT | 盈虧=$+5.10 (+0.42%)
📊 歷史總盈虧: $+150.30 | 勝率: 56.00%
✅ 訂單成功: SOLUSDT LONG @ $35.50
```

---

## 🔧 如何查看完整日誌（可選）

如果需要調試，在 Railway 環境變量中設置：
```bash
LOG_LEVEL=DEBUG
```

這將顯示所有降級的詳細日誌，包括：
- 系統初始化詳情
- 交易周期詳情
- 信號分析詳情
- 數據庫操作詳情
- WebSocket 心跳

---

**最後更新**: 2025-11-11  
**適用版本**: v4.0+
