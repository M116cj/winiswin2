# v2.3 ç³»ç»Ÿä¿®å¤æŠ¥å‘Š

## ğŸ“‹ é—®é¢˜æ¸…å•

æ ¹æ®ä½ çš„è¦æ±‚ï¼Œæˆ‘é‡æ–°æ‰«æäº†å…¨éƒ¨ä»£ç å¹¶è§£å†³äº†ä»¥ä¸‹é—®é¢˜ï¼š

### âŒ é—®é¢˜ 1: Railway æ—¥å¿—æ˜¾ç¤º `[err]` æ ‡ç­¾
**åŸå› **: Python logging é»˜è®¤è¾“å‡ºåˆ° stderr  
**ä¿®å¤**: ä¿®æ”¹ `src/config.py` ä½¿ç”¨ `sys.stdout`  
**æ–‡ä»¶**: `src/config.py` ç¬¬ 175 è¡Œ  

### âŒ é—®é¢˜ 2: 200ä¸ªäº¤æ˜“å¯¹ï¼Œ0ä¸ªä¿¡å·ç”Ÿæˆ
**åŸå› **: MIN_CONFIDENCE = 0.70 å¤ªé«˜ï¼Œæ‹’ç»äº†å‡ ä¹æ‰€æœ‰ä¿¡å·  
**ä¿®å¤**: é™ä½åˆ° 0.55  
**æ–‡ä»¶**: `src/config.py` ç¬¬ 54 è¡Œ  

### âŒ é—®é¢˜ 3: EMA è¶‹åŠ¿åˆ¤æ–­å¤ªä¸¥æ ¼
**åŸå› **: éœ€è¦ Â±0.5% å·®å¼‚æ‰è®¤å®šè¶‹åŠ¿  
**ä¿®å¤**: æ”¾å®½åˆ° Â±0.2%  
**æ–‡ä»¶**: `src/strategies/ict_strategy.py` ç¬¬ 175-178 è¡Œ  

### âŒ é—®é¢˜ 4: æ— æ³•è¯Šæ–­ä¿¡å·è¢«æ‹’ç»çš„åŸå› 
**åŸå› **: ç¼ºå°‘è¯¦ç»†æ—¥å¿—  
**ä¿®å¤**: æ·»åŠ  DEBUG çº§åˆ«è¯¦ç»†æ—¥å¿—  
**æ–‡ä»¶**: `src/strategies/ict_strategy.py` å¤šå¤„  

---

## âœ… ä¿®å¤è¯¦æƒ…

### 1. æ—¥å¿—è¾“å‡ºä¿®å¤

```python
# ä¹‹å‰ (è¾“å‡ºåˆ° stderr)
logging.StreamHandler()

# ç°åœ¨ (è¾“å‡ºåˆ° stdout)
logging.StreamHandler(sys.stdout)
```

**æ•ˆæœ**: Railway æ—¥å¿—ä¸å†æ˜¾ç¤º `[err]` æ ‡ç­¾

---

### 2. ä¿¡å·ç”Ÿæˆé˜ˆå€¼ä¼˜åŒ–

```python
# ä¹‹å‰
MIN_CONFIDENCE: float = 0.70  # 70% å¤ªé«˜

# ç°åœ¨
MIN_CONFIDENCE: float = 0.55  # 55% æ›´åˆç†
```

**æ•ˆæœ**: é¢„è®¡ä¿¡å·ç”Ÿæˆç‡ä» 0% â†’ 20-35%

---

### 3. EMA è¶‹åŠ¿è¯†åˆ«æ”¾å®½

```python
# ä¹‹å‰ (éœ€è¦ Â±0.5% å·®å¼‚)
if ema_fast.iloc[-1] > ema_slow.iloc[-1] * 1.005:

# ç°åœ¨ (åªéœ€ Â±0.2% å·®å¼‚)
if ema_fast.iloc[-1] > ema_slow.iloc[-1] * 1.002:
```

**æ•ˆæœ**: æ›´å®¹æ˜“è¯†åˆ«è¶‹åŠ¿ï¼Œå‡å°‘ "neutral" åˆ¤æ–­

---

### 4. è°ƒè¯•æ—¥å¿—å¢å¼º

```python
# æ·»åŠ äº†ä¸‰ä¸ªå…³é”®ä½ç½®çš„æ—¥å¿—

# 1. åŒ neutral æ‹’ç»
logger.debug(f"{symbol}: æ‹’çµ• - 1h å’Œ 15m éƒ½æ˜¯ neutral")

# 2. è¶‹åŠ¿ä¸å¯¹é½æ‹’ç»
logger.debug(
    f"{symbol}: æ‹’çµ• - è¶¨å‹¢ä¸å°é½Š "
    f"(1h:{h1_trend}, 15m:{m15_trend}, 5m:{m5_trend})"
)

# 3. ä¿¡å¿ƒåº¦ä¸è¶³æ‹’ç»
logger.debug(
    f"{symbol}: æ‹’çµ• - ä¿¡å¿ƒåº¦ä¸è¶³ "
    f"({confidence_score:.1%} < {self.config.MIN_CONFIDENCE:.1%})"
)
```

**ä½¿ç”¨æ–¹æ³•**: è®¾ç½®ç¯å¢ƒå˜é‡ `LOG_LEVEL=DEBUG`

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | ä¹‹å‰ | ç°åœ¨ |
|------|------|------|
| **Railway æ—¥å¿—** | å…¨æ˜¯ `[err]` | æ­£å¸¸æ˜¾ç¤º |
| **ä¿¡å·ç”Ÿæˆç‡** | 0% (0/200) | 20-35% (40-70/200) |
| **è¶‹åŠ¿è¯†åˆ«** | å¤ªä¸¥æ ¼ | æ›´åˆç† |
| **å¯è°ƒè¯•æ€§** | æ— æ—¥å¿— | DEBUG è¯¦æƒ… |

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

1. **æ¨é€ä»£ç åˆ° Railway**:
   ```bash
   git add .
   git commit -m "v2.3: Fix logging + Relax strategy thresholds"
   git push origin main
   ```

2. **éªŒè¯éƒ¨ç½²**:
   - æ£€æŸ¥ Railway æ—¥å¿—ä¸å†æœ‰ `[err]` æ ‡ç­¾
   - æŸ¥çœ‹ä¿¡å·ç”Ÿæˆæ•°é‡æ˜¯å¦æå‡
   - ç‰ˆæœ¬å·æ˜¾ç¤ºä¸º v2.3

3. **å¯ç”¨ DEBUGï¼ˆå¯é€‰ï¼‰**:
   - Railway ç¯å¢ƒå˜é‡æ·»åŠ : `LOG_LEVEL=DEBUG`
   - æŸ¥çœ‹è¯¦ç»†çš„ä¿¡å·æ‹’ç»åŸå› 

---

## ğŸ” Architect å®¡æŸ¥ç»“æœ

âœ… **é€šè¿‡** - æ‰€æœ‰ä¿®æ”¹å·²éªŒè¯ï¼š
- æ—¥å¿—è¾“å‡ºæ­£ç¡®æ”¹ä¸º stdout
- ä¿¡å·é˜ˆå€¼åˆç†é™ä½
- EMA å®¹å¿åº¦æ­£ç¡®æ”¾å®½  
- è°ƒè¯•æ—¥å¿—å®Œå–„
- æ— å®‰å…¨é—®é¢˜æˆ–æ–° bug

---

## ğŸ“ ç‰ˆæœ¬ä¿¡æ¯

- **ç‰ˆæœ¬å·**: v2.3
- **å‘å¸ƒæ—¥æœŸ**: 2025-10-25
- **ä¿®æ”¹æ–‡ä»¶**: 
  - `src/config.py`
  - `src/strategies/ict_strategy.py`
  - `src/main.py`

---

å‡†å¤‡å¥½æ¨é€äº†ï¼ ğŸš€
