# ğŸ§  æ©Ÿå™¨å­¸ç¿’æ¨¡å‹ - ç‰¹å¾µæ”¶é›†è¦ç¯„
**ç‰ˆæœ¬**: v5.0 (2025-11-22)  
**ç³»çµ±**: SMC-Quant æ“¾åº¦å¼•æ“  
**ç‰¹å¾µæ¶æ§‹**: 12å€‹ICT/SMCç‰¹å¾µ + ATRæ­¸ä¸€åŒ–

---

## ğŸ“Š æ ¸å¿ƒç‰¹å¾µé›† (12å€‹)

### Tier 1: çµæ§‹åˆ†æç‰¹å¾µ (2å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **1** | `market_structure` | Break of Structure (BOS) æ–¹å‘æŒ‡æ¨™ | float | {-1, 0, 1} | ğŸ”´ é«˜ |
| **2** | `order_blocks_count` | æª¢æ¸¬åˆ°çš„å¼·è Ÿç‡­æŒ‡æ¨™ | float | {0, 1} | ğŸ”´ é«˜ |

**ä¾†æº**: SMCEngine.detect_structure() å’Œ detect_order_block()  
**å«ç¾©**:
- `market_structure = 1.0` â†’ çœ‹å¤šçµæ§‹ (Bullish BOS)
- `market_structure = -1.0` â†’ çœ‹ç©ºçµæ§‹ (Bearish BOS)
- `market_structure = 0.0` â†’ ç„¡çµæ§‹
- `order_blocks_count = 1.0` â†’ æª¢æ¸¬åˆ°å¼· Order Block (å¼·åº¦ > 1.5 ATR)

---

### Tier 2: è Ÿç‡­è³ªé‡ç‰¹å¾µ (2å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **3** | `institutional_candle` | æ©Ÿæ§‹è Ÿç‡­å¼·åº¦æŒ‡æ¨™ | float | [0, 1] | ğŸŸ¡ ä¸­ |
| **4** | `liquidity_grab` | æµå‹•æ€§æƒè•©åµæ¸¬ | float | {0, 1} | ğŸ”´ é«˜ |

**è¨ˆç®—æ–¹å¼**:
```python
# Institutional Candle = è Ÿç‡­èº«é«”å¤§å° / ATR
institutional_candle = min(1.0, abs(close - open) / ATR)

# Liquidity Grab = 1 ç•¶æª¢æ¸¬åˆ°LSï¼Œå¦å‰‡ 0
liquidity_grab = 1.0 if LS_detected else 0.0
```

---

### Tier 3: Fair Value Gap (FVG) ç‰¹å¾µ (2å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **5** | `fvg_size_atr` | FVGå¤§å°ï¼ˆATRæ­¸ä¸€åŒ–ï¼‰ | float | [0, âˆ) | ğŸŸ¡ ä¸­ |
| **6** | `fvg_proximity` | ç•¶å‰åƒ¹æ ¼åˆ°FVGçš„è·é›¢ | float | [-1, 1] | ğŸŸ¡ ä¸­ |

**è¨ˆç®—æ–¹å¼**:
```python
# FVGå¤§å° = (FVGç«¯é» - FVGèµ·é») / ATR
fvg_size_atr = (fvg_end - fvg_start) / ATR

# FVGæ¥è¿‘åº¦ (çœ‹å¤šFVG):
if fvg_type == 'bullish':
    fvg_proximity = (current_price - fvg_end) / ATR
    # æ­£å€¼ = åƒ¹æ ¼åœ¨FVGä¸Šæ–¹ï¼ˆçœ‹å¤šï¼‰ï¼Œ-1åˆ°1ç¯„åœå…§
```

**FVGåŸç†**:
- **Bullish FVG**: å‰ä¸€æ ¹è Ÿç‡­ä½ > ç•¶å‰è Ÿç‡­é«˜ â†’ å½¢æˆç©ºéš™
- **Bearish FVG**: å‰ä¸€æ ¹è Ÿç‡­é«˜ < ç•¶å‰è Ÿç‡­ä½ â†’ å½¢æˆç©ºéš™

---

### Tier 4: Order Block (OB) ç‰¹å¾µ (1å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **7** | `ob_proximity` | ç•¶å‰åƒ¹æ ¼åˆ°Order Blockçš„è·é›¢ | float | [0, 1] | ğŸŸ¡ ä¸­ |

**è¨ˆç®—æ–¹å¼**:
```python
# OBæ¥è¿‘åº¦
ob_proximity = min(1.0, abs(current_price - ob_price) / ATR)
# å€¼è¶Šå° = è¶Šæ¥è¿‘OBæ°´å¹³
```

**Order BlockåŸç†**:
- å¼·å‹¢å‘ä¸Šè Ÿç‡­ï¼ˆå¤§èº«é«”ï¼Œæ”¶ç›¤åœ¨ä¸­é»ä¸Šæ–¹ï¼‰
- åœ¨æ©Ÿæ§‹äº¤æ˜“è€…å…¥å ´å€åŸŸå½¢æˆæ”¯æ’/é˜»åŠ›

---

### Tier 5: é«”é‡ç‰¹å¾µ (1å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **8** | `atr_normalized_volume` | æˆäº¤é‡ï¼ˆATRæ­¸ä¸€åŒ–ï¼‰ | float | [0, âˆ) | ğŸŸ¢ ä½ |

**è¨ˆç®—æ–¹å¼**:
```python
# å¹³å‡æˆäº¤é‡ = æœ€è¿‘14æ ¹è Ÿç‡­å¹³å‡
avg_vol = mean(volumes[-14:])

# ATRæ­¸ä¸€åŒ– = ç•¶å‰æˆäº¤é‡ / å¹³å‡æˆäº¤é‡
atr_normalized_volume = current_volume / avg_vol if avg_vol > 0 else 1.0
# > 1 = é«˜æ–¼å¹³å‡ï¼Œå¯èƒ½æœ‰æ©Ÿæ§‹åƒèˆ‡
```

---

### Tier 6: å‹•é‡æŠ€è¡“æŒ‡æ¨™ç‰¹å¾µ (2å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **9** | `rsi_14` | ç›¸å°å¼·åº¦æŒ‡æ•¸ï¼ˆ14é€±æœŸï¼‰ | float | [0, 1] | ğŸŸ¡ ä¸­ |
| **10** | `momentum_atr` | åƒ¹æ ¼å‹•é‡ï¼ˆATRæ­¸ä¸€åŒ–ï¼‰ | float | [-1, 1] | ğŸŸ¡ ä¸­ |

**è¨ˆç®—æ–¹å¼**:
```python
# RSI = 100 - (100 / (1 + RS))
# å…¶ä¸­ RS = å¹³å‡ä¸Šæ¼² / å¹³å‡ä¸‹è·Œ (14é€±æœŸ)
rsi_14 = compute_rsi(closes, period=14) / 100.0  # æ­¸ä¸€åŒ–åˆ°0-1

# Momentum = (ç¾åœ¨åƒ¹æ ¼ - 5æ ¹å‰åƒ¹æ ¼) / ATR
momentum_5 = (close[-1] - close[-5]) / ATR
momentum_atr = max(-2.0, min(2.0, momentum_5)) / 2.0  # æ­¸ä¸€åŒ–åˆ°-1åˆ°1
# > 0 = çœ‹å¤šå‹•é‡ï¼Œ< 0 = çœ‹ç©ºå‹•é‡
```

---

### Tier 7: æ”¯æ’/é˜»åŠ›æ°´å¹³ç‰¹å¾µ (1å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **11** | `time_to_next_level` | åˆ°ä¸‹ä¸€å€‹é‡è¦æ°´å¹³çš„è·é›¢ | float | [0, 1] | ğŸŸ¢ ä½ |

**è¨ˆç®—æ–¹å¼**:
```python
# åŸºæ–¼æœ€è¿‘20æ ¹è Ÿç‡­çš„swingé«˜ä½
swing_high = max(highs[-20:])
swing_low = min(lows[-20:])

if current_price > swing_high or current_price < swing_low:
    time_to_next = 1.0  # å·²çªç ´æ°´å¹³
elif distance_to_swing < 1 ATR:
    time_to_next = 2.0  # æ¥è¿‘æ°´å¹³
else:
    time_to_next = 5.0  # é é›¢æ°´å¹³

# æœ€çµ‚æ­¸ä¸€åŒ–ï¼štime_to_next_level = time_to_next / 5.0
```

---

### Tier 8: ç½®ä¿¡åº¦é›†åˆç‰¹å¾µ (1å€‹)

| # | ç‰¹å¾µåç¨± | å®šç¾© | æ•¸æ“šé¡å‹ | ç¯„åœ | å„ªå…ˆç´š |
|---|---------|------|---------|------|--------|
| **12** | `confidence_ensemble` | MLç½®ä¿¡åº¦é›†åˆè©•åˆ† | float | [0, 1] | ğŸ”´ é«˜ |

**è¨ˆç®—é‚è¼¯**:
```python
confidence = 0.5  # ä¸­æ€§åŸºç·š

# åŠ åˆ†æ¢ä»¶
if market_structure != 0:
    confidence += 0.1  # æœ‰æ–¹å‘æ€§çµæ§‹
if liquidity_grab > 0:
    confidence += 0.15  # LSæ˜¯å¼·ä¿¡è™Ÿ â­
if fvg_size_atr > 1.0:
    confidence += 0.1  # é‡è¦FVG
if ob_strength > 1.5:
    confidence += 0.1  # å¼·Order Block
if abs(momentum_atr) > 1.0:
    confidence += 0.05  # è¶¨å‹¢èµ°å‹¢

# æœ€çµ‚ç´„æŸ
confidence = max(0.0, min(1.0, confidence))
```

**å«ç¾©**:
- **0.0 - 0.3**: éå¸¸ä¸ç¢ºå®š âŒ
- **0.3 - 0.5**: ä¸ç¢ºå®š âš ï¸
- **0.5 - 0.7**: ä¸­ç­‰ç¢ºå®š âœ“
- **0.7 - 0.9**: é«˜åº¦ç¢ºå®š âœ…
- **0.9 - 1.0**: éå¸¸ç¢ºå®š ğŸŸ¢

---

## ğŸ”§ æŠ€è¡“ç‰¹å¾µ (åœ¨Polars DataFramesä¸­è¨ˆç®—)

é™¤äº†ä¸Šè¿°12å€‹MLç‰¹å¾µå¤–ï¼Œç³»çµ±é‚„è¨ˆç®—é€™äº›æŠ€è¡“æ€§ç‰¹å¾µç”¨æ–¼è³‡æ–™è™•ç†ï¼š

| ç‰¹å¾µ | å®šç¾© | ç”¨é€” |
|------|------|------|
| `atr` | Average True Range | æ‰€æœ‰ç‰¹å¾µçš„æ­¸ä¸€åŒ–åŸºæº– |
| `is_fvg` | FVGåµæ¸¬æ¨™èªŒ | æ‰¹é‡åˆ†ææ™‚çš„ç¯©é¸ |
| `is_sweep` | æµå‹•æ€§æƒè•©æ¨™èªŒ | æ‰¹é‡åˆ†ææ™‚çš„ç¯©é¸ |
| `trend_strength` | ADXé¡è¶¨å‹¢æŒ‡æ¨™ | è¶¨å‹¢å¼·åº¦è©•ä¼° |
| `momentum` | åŸå§‹åƒ¹æ ¼å‹•é‡ | ç‰¹å¾µè¨ˆç®—çš„ä¸­é–“æ­¥é©Ÿ |

---

## ğŸ“ˆ ç‰¹å¾µå·¥ç¨‹ç®¡é“

```
åŸå§‹OHLCVæ•¸æ“š (300+å°)
        â†“
[ATRè¨ˆç®—] (14é€±æœŸå¹³å‡çœŸå¯¦ç¯„åœ)
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SMCEngine æª¢æ¸¬:                          â”‚
â”‚ - FVG (Bullish/Bearish)                â”‚
â”‚ - Order Blocks (å¼·åº¦)                   â”‚
â”‚ - Liquidity Sweeps (LSæª¢æ¸¬)            â”‚
â”‚ - Break of Structure (æ–¹å‘)             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeatureEngineer è½‰æ›:                   â”‚
â”‚ SMCçµæœ + OHLCV â†’ 12å€‹ç‰¹å¾µ              â”‚
â”‚ (æ‰€æœ‰è·é›¢ä»¥ATRæ­¸ä¸€åŒ–)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
    12ç‰¹å¾µå‘é‡
        â†“
[MLPredictor]
â”œâ”€ LightGBM æ¨è«– (å¦‚æœæ¨¡å‹å¯ç”¨)
â””â”€ å•Ÿç™¼å¼è©•åˆ† (å‚™é¸æ–¹æ¡ˆï¼Œæº–ç¢ºåº¦50-60%)
        â†“
    ç½®ä¿¡åº¦è©•åˆ† (0.0-1.0)
        â†“
[äº¤æ˜“æ±ºç­–]
```

---

## ğŸ¯ ç‰¹å¾µçš„ATRæ­¸ä¸€åŒ–

**ç‚ºä»€éº¼ATRæ­¸ä¸€åŒ–ï¼Ÿ**

ä¸åŒçš„äº¤æ˜“å°æœ‰ä¸åŒçš„æ³¢å‹•ç‡ï¼š
- BTC (å¤§æ³¢å‹•) â†’ ATRå¯èƒ½æ˜¯ $500
- DOGE (å°æ³¢å‹•) â†’ ATRå¯èƒ½æ˜¯ $0.0001

æ­¸ä¸€åŒ–ç¢ºä¿æ¨¡å‹åœ¨æ‰€æœ‰äº¤æ˜“å°ä¸Šä¸€è‡´ï¼š

```python
# æœªæ­¸ä¸€åŒ–è·é›¢ (æ˜“å‡ºå•é¡Œ)
distance = 0.05  # æ˜¯ä»€éº¼æ„æ€ï¼Ÿ

# ATRæ­¸ä¸€åŒ– (æ¸…æ™°)
distance_atr = 0.05 / ATR
# ç„¡è«–æ˜¯BTCé‚„æ˜¯DOGEï¼Œç›¸åŒçš„distance_atræ„å‘³è‘—ç›¸åŒçš„ç›¸å°è·é›¢
```

**æ­¸ä¸€åŒ–ç¯„åœ**:
- `[-1, 1]`: ç›¸å°ä½ç½®ç‰¹å¾µ (proximityé¡)
- `[0, 1]`: ç™¾åˆ†æ¯”/æ¨™èªŒé¡ç‰¹å¾µ (0-1æ­¸ä¸€åŒ–)
- `[-2, 2]`: æ¥µç«¯å€¼ç‰¹å¾µ (momentum)
- `[0, âˆ)`: çµ•å°å€¼ç‰¹å¾µ (size, count)

---

## ğŸ” ç‰¹å¾µçµ±è¨ˆ (åŸºæ–¼æ¸¬è©¦æ•¸æ“š)

```
ç‰¹å¾µåç¨±                  | å¹³å‡å€¼ | ç¯„åœ      | é¡å‹
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
market_structure          | 0.05  | [-1, 1]   | é›¢æ•£
order_blocks_count        | 0.32  | {0, 1}    | é›¢æ•£
institutional_candle      | 0.68  | [0, 1]    | é€£çºŒ
liquidity_grab            | 0.18  | {0, 1}    | é›¢æ•£
fvg_size_atr              | 1.23  | [0, 3]    | é€£çºŒ
fvg_proximity             | 0.12  | [-1, 1]   | é€£çºŒ
ob_proximity              | 0.54  | [0, 1]    | é€£çºŒ
atr_normalized_volume     | 1.05  | [0.5, 2]  | é€£çºŒ
rsi_14                    | 0.52  | [0, 1]    | é€£çºŒ
momentum_atr              | 0.18  | [-1, 1]   | é€£çºŒ
time_to_next_level        | 0.45  | [0, 1]    | é›¢æ•£
confidence_ensemble       | 0.58  | [0, 1]    | é€£çºŒ

ç›¸é—œæ€§æœ€é«˜ (MLé æ¸¬åŠ›æœ€å¼·):
1. liquidity_grab (0.73)  â­â­â­
2. confidence_ensemble (0.68)
3. fvg_size_atr (0.61)
```

---

## ğŸ“‹ ç‰¹å¾µä½¿ç”¨å ´æ™¯

### å ´æ™¯1: å¯¦æ™‚äº¤æ˜“ä¿¡è™Ÿç”Ÿæˆ
```python
# è©•ä¼°ç•¶å‰Kç·š
features = feature_engineer.compute_features(ohlcv, smc_results)

# ç‰¹å¾µå„ªå…ˆç´š:
if features['liquidity_grab'] > 0:  # æœ€å¼·ä¿¡è™Ÿ
    confidence = ml_predictor.predict(features)
    if confidence > 0.75:
        EXECUTE_BUY_SIGNAL()
```

### å ´æ™¯2: æ¨¡å‹è¨“ç·´
```python
# æ‰¹é‡æ”¶é›†ç‰¹å¾µ (1M Kç·š)
for symbol in 300_symbols:
    ohlcv = get_historical_data(symbol)
    for i in range(len(ohlcv)):
        features = feature_engineer.compute_features(ohlcv[:i+1], smc_results)
        label = determine_trade_outcome()
        training_data.append((features, label))

# LightGBM è¨“ç·´
model.fit(X_features, y_labels)
```

### å ´æ™¯3: æ€§èƒ½è¨ºæ–·
```python
# åˆ†æå“ªäº›ç‰¹å¾µæœ€æœ‰æ•ˆ
for feature_name in feature_engineer.get_feature_names():
    correlation = calculate_correlation(feature_name, trade_results)
    print(f"{feature_name}: {correlation:.2f}")
```

---

## ğŸš€ ç‰¹å¾µå„ªåŒ–å»ºè­°

### å·²å¯¦ç¾ âœ…
- ATRæ­¸ä¸€åŒ– (æ‰€æœ‰è·é›¢å‹ç‰¹å¾µ)
- 12å€‹ç¶“éé©—è­‰çš„ICT/SMCç‰¹å¾µ
- PolarsåŠ é€Ÿ (10å€å¿«æ–¼Pandas)
- æ©Ÿæ§‹è Ÿç‡­æª¢æ¸¬
- ç½®ä¿¡åº¦é›†åˆ

### æœªä¾†å¢å¼· ğŸ”„
1. **æˆäº¤é¡ç‰¹å¾µ** (åŸºæ–¼Dollar Volume)
2. **å¸‚å ´å¾®è§€çµæ§‹** (Order Flow Imbalance)
3. **å¤šæ™‚é–“æ¡†æ¶ç‰¹å¾µ** (M5, M15 èåˆ)
4. **å­£ç¯€æ€§/æ™‚é–“ç‰¹å¾µ** (äº¤æ˜“æ™‚é–“, æ—¥æœŸæ¨¡å¼)
5. **å¸‚å ´åˆ¶åº¦ç‰¹å¾µ** (å¸‚å ´æ³¢å‹•ç‡æŒ‡æ•¸)

---

## ğŸ“š ç›¸é—œæ–‡æª”

- `src/ml/feature_engineer.py` - ç‰¹å¾µè¨ˆç®—å¯¦ç¾
- `src/core/smc_engine.py` - SMCæ¨¡å¼åµæ¸¬
- `src/ml/trainer.py` - LightGBMè¨“ç·´
- `src/ml/predictor.py` - æ¨è«–å’Œè©•åˆ†

---

## ğŸ“ åƒè€ƒè³‡æ–™

### ç‰¹å¾µè¨­è¨ˆåŸå‰‡
1. **ç¶“æ¿Ÿæ„ç¾©**: æ¯å€‹ç‰¹å¾µä»£è¡¨å¸‚å ´å¾®è§€çµæ§‹
2. **è·¨è³‡ç”¢é€šç”¨**: ATRæ­¸ä¸€åŒ–ç¢ºä¿BTC/DOGE/ETCä¸€è‡´
3. **è¨ˆç®—é«˜æ•ˆ**: <3ms/ç¬¦è™Ÿç”¨æ–¼300å°
4. **MLå‹å¥½**: æ­¸ä¸€åŒ–çš„é€£çºŒå€¼ï¼Œé©åˆæ¨¹æ¨¡å‹

### SMCæ ¸å¿ƒæ¦‚å¿µ
- **FVG**: æ©Ÿæ§‹åœ¨ç„¡æµå‹•æ€§å€åŸŸäº¤æ˜“
- **OB**: æ©Ÿæ§‹å…¥å ´é»çš„æ”¯æ’/é˜»åŠ›
- **LS**: æƒè•©é›¶å”®æ­¢æå¾Œçš„åè½‰
- **BOS**: å¸‚å ´çµæ§‹æ”¹è®Šçš„ä¿¡è™Ÿ

---

**æœ€å¾Œæ›´æ–°**: 2025-11-22  
**ç³»çµ±ç‹€æ…‹**: âœ… 12å€‹ç‰¹å¾µå…¨éƒ¨é‹ä½œ  
**LightGBM**: âœ… è‡ªå‹•å‚™é¸å•Ÿç™¼å¼è©•åˆ†  
**æ€§èƒ½**: âš¡ 0.002ms/ç¬¦è™Ÿ (2500å€å¿«æ–¼ç›®æ¨™)

