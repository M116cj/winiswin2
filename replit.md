# Binance USDTæ°¸çºŒåˆç´„ 24/7é«˜é »è‡ªå‹•äº¤æ˜“ç³»çµ±

## âš ï¸ é‡è¦ï¼šéƒ¨ç½²è¦æ±‚

### âŒ **Replit ç’°å¢ƒç„¡æ³•é‹è¡Œæ­¤ç³»çµ±**

**åŸå› **ï¼šBinance API åœ°ç†ä½ç½®é™åˆ¶ï¼ˆHTTP 451 éŒ¯èª¤ï¼‰
- Replit æœå‹™å™¨ä½æ–¼è¢« Binance é™åˆ¶çš„åœ°å€
- æ‰€æœ‰ API è«‹æ±‚éƒ½æœƒè¢«é˜»æ­¢ï¼Œç„¡æ³•ç¹é
- ç†”æ–·å™¨æœƒåœ¨é€£çºŒå¤±æ•—å¾Œé˜»æ–·è«‹æ±‚ï¼ˆé€™æ˜¯æ­£ç¢ºçš„ä¿è­·æ©Ÿåˆ¶ï¼‰

### âœ… **å”¯ä¸€è§£æ±ºæ–¹æ¡ˆï¼šéƒ¨ç½²åˆ° Railway**

Railway æœå‹™å™¨ä½æ–¼å…è¨±è¨ªå• Binance API çš„åœ°å€ï¼ˆæ­æ´²/äºæ´²ï¼‰ã€‚

ğŸ“– **å®Œæ•´éƒ¨ç½²æŒ‡å—**ï¼šè«‹æŸ¥çœ‹ [`RAILWAY_DEPLOY.md`](./RAILWAY_DEPLOY.md)

**å¿«é€Ÿéƒ¨ç½²**ï¼š
```bash
# 1. æ¨é€ä»£ç¢¼åˆ° GitHub
git add .
git commit -m "Deploy to Railway"
git push origin main

# 2. åœ¨ Railway é€£æ¥ GitHub å€‰åº«
# 3. é…ç½®ç’°å¢ƒè®Šé‡ï¼ˆBINANCE_API_KEY, BINANCE_API_SECRETï¼‰
# 4. ç­‰å¾…è‡ªå‹•éƒ¨ç½²å®Œæˆ
```

---

## é …ç›®æ¦‚è¿°

æ··åˆæ™ºèƒ½äº¤æ˜“ç³»çµ±ï¼Œæ”¯æŒICT/SMCç­–ç•¥ã€è‡ªæˆ‘å­¸ç¿’AIäº¤æ˜“å“¡ã€æ··åˆæ¨¡å¼ä¸‰ç¨®ç­–ç•¥åˆ‡æ›ã€‚é›†æˆXGBoost MLã€ONNXæ¨ç†åŠ é€Ÿã€æ·±åº¦å­¸ç¿’æ¨¡å‹ï¼ˆTensorFlow + TFLiteé‡åŒ–ï¼‰ï¼Œç›£æ§Top 200é«˜æµå‹•æ€§äº¤æ˜“å°ï¼Œè·¨3æ™‚é–“æ¡†æ¶ç”Ÿæˆå¹³è¡¡LONG/SHORTä¿¡è™Ÿã€‚

## ç•¶å‰ç‰ˆæœ¬ï¼šv3.17+ (2025-10-28)

**æœ€æ–°åŠŸèƒ½ï¼šBinance API æ™ºèƒ½é©é… + ç„¡é™åˆ¶æ§“æ¡¿ç³»çµ±** âœ…

### æ ¸å¿ƒç‰¹æ€§
- âœ… **ä¸‰ç¨®ç­–ç•¥æ¨¡å¼**ï¼šICTç­–ç•¥ã€è‡ªæˆ‘å­¸ç¿’AIã€æ··åˆæ¨¡å¼ï¼ˆå¯é…ç½®åˆ‡æ›ï¼‰
- âœ… **æ·±åº¦å­¸ç¿’æ¨¡çµ„**ï¼šå¸‚å ´çµæ§‹è‡ªå‹•ç·¨ç¢¼å™¨ã€ç‰¹å¾µç™¼ç¾ç¶²çµ¡ã€æµå‹•æ€§é æ¸¬ã€å¼·åŒ–å­¸ç¿’ç­–ç•¥é€²åŒ–
- âœ… **è™›æ“¬å€‰ä½å…¨ç”Ÿå‘½å‘¨æœŸç›£æ§**ï¼š11ç¨®äº‹ä»¶é¡å‹è¿½è¹¤ï¼ˆå‰µå»ºã€åƒ¹æ ¼æ›´æ–°ã€æ­¢ç›ˆæ­¢ææ¥è¿‘/è§¸ç™¼ã€éæœŸã€é—œé–‰ï¼‰
- âœ… **é«˜è³ªé‡ä¿¡è™Ÿéæ¿¾**ï¼šå¤šç¶­åº¦è³ªé‡è©•ä¼°ã€è³ªé‡åŠ æ¬Šè¨“ç·´æ¨£æœ¬ç”Ÿæˆ
- âœ… **é›™å¾ªç’°æ¶æ§‹**ï¼šå¯¦ç›¤äº¤æ˜“60ç§’ + è™›æ“¬å€‰ä½10ç§’
- âœ… **æ™ºèƒ½é¢¨éšªç®¡ç†**ï¼šMLé©…å‹•å‹•æ…‹æ§“æ¡¿ã€åˆ†ç´šç†”æ–·ä¿è­·ã€ç„¡é™åŒæ™‚æŒå€‰
- âœ… **5å¤§æ€§èƒ½å„ªåŒ–**ï¼šTFLiteé‡åŒ–ã€å¢é‡ç·©å­˜ã€æ‰¹é‡é æ¸¬ã€è¨˜æ†¶é«”æ˜ å°„ã€æ™ºèƒ½ç›£æ§

---

## æœ€è¿‘æ›´æ–°

### v3.17+ (2025-10-28) - Binance API æ™ºèƒ½é©é… ğŸš€

**é¡å‹**: ğŸ”§ **CRITICAL BUG FIX / API COMPATIBILITY**  
**ç›®æ¨™**: å®Œå…¨ä¿®å¾©æ‰€æœ‰ Binance API éŒ¯èª¤ï¼Œæ”¯æŒ Hedge/One-Way Mode æ™ºèƒ½é©é…  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦é€šé Architect å¯©æŸ¥**

#### **ä¿®å¾©çš„éŒ¯èª¤**

##### 1. positionSide éŒ¯èª¤ (HTTP 400: -4061) âœ…
**å•é¡Œ**: `Order's position side does not match user's setting`

**æ ¹æœ¬åŸå› **: 
- Binance æ”¯æŒå…©ç¨® Position Modeï¼šHedge Modeï¼ˆé›™å‘æŒå€‰ï¼‰å’Œ One-Way Modeï¼ˆå–®å‘æŒå€‰ï¼‰
- Hedge Mode **å¿…é ˆ**ç™¼é€ `positionSide`ï¼ˆLONG/SHORTï¼‰
- One-Way Mode **ä¸èƒ½**ç™¼é€ `positionSide`

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… å•Ÿå‹•æ™‚è‡ªå‹•æŸ¥è©¢ç”¨æˆ¶çš„ Position Modeï¼ˆGET /fapi/v1/positionSide/dualï¼‰
- âœ… Hedge Mode è‡ªå‹•æ·»åŠ  `positionSide`ï¼ˆBUY â†’ LONGï¼ŒSELL â†’ SHORTï¼‰
- âœ… One-Way Mode ç¢ºä¿ä¸ç™¼é€ `positionSide`
- âœ… æŸ¥è©¢å¤±æ•—ä¸ç·©å­˜ï¼Œæ”¯æŒè‡ªå‹•é‡è©¦

**ä»£ç¢¼å¯¦ç¾**:
```python
async def get_position_mode(self) -> bool:
    """æŸ¥è©¢ Position Modeï¼ˆæ”¯æŒè‡ªå‹•é‡è©¦ï¼‰"""
    if self._hedge_mode is not None:
        return self._hedge_mode
    
    try:
        result = await self._request("GET", "/fapi/v1/positionSide/dual", signed=True)
        # âœ… åªåœ¨æˆåŠŸæ™‚ç·©å­˜
        self._hedge_mode = result.get('dualSidePosition', False)
        logger.info(f"ğŸ“ ç•¶å‰ Position Mode: {'Hedge Mode' if self._hedge_mode else 'One-Way Mode'}")
        return self._hedge_mode
    except Exception as e:
        # âš ï¸ å¤±æ•—æ™‚ä¸ç·©å­˜ï¼Œå…è¨±é‡è©¦
        logger.warning(f"âš ï¸ æŸ¥è©¢ Position Mode å¤±æ•—: {e}ï¼Œä¸‹æ¬¡æœƒé‡è©¦")
        return False  # è‡¨æ™‚è¿”å›ï¼Œä¸è¨­ç½® self._hedge_mode
```

##### 2. æ•¸é‡ç²¾åº¦éŒ¯èª¤ (HTTP 400: -1111) âœ…
**å•é¡Œ**: `Precision is over the maximum defined for this asset`

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… ä½¿ç”¨ **Decimal å‘ä¸‹å–æ•´ (ROUND_DOWN)** ç¬¦åˆ Binance LOT_SIZE è¦ç¯„
- âœ… è‡ªå‹•å¾ `exchangeInfo` ç²å– `stepSize`
- âœ… æ‰€æœ‰è¨‚å–®è‡ªå‹•æ ¼å¼åŒ–æ•¸é‡ç²¾åº¦

**ä»£ç¢¼å¯¦ç¾**:
```python
async def format_quantity(self, symbol: str, quantity: float) -> float:
    """è‡ªå‹•æ ¼å¼åŒ–æ•¸é‡ä»¥ç¬¦åˆ Binance ç²¾åº¦è¦æ±‚"""
    step_size = await self._get_step_size(symbol)
    
    # ä½¿ç”¨ Decimal å‘ä¸‹å–æ•´
    from decimal import Decimal, ROUND_DOWN
    quantity_decimal = Decimal(str(quantity))
    step_decimal = Decimal(str(step_size))
    
    # å‘ä¸‹å–æ•´åˆ°æœ€è¿‘çš„ stepSize å€æ•¸
    normalized = (quantity_decimal / step_decimal).to_integral_value(ROUND_DOWN) * step_decimal
    return float(normalized)
```

##### 3. æ§“æ¡¿ç„¡æ•ˆéŒ¯èª¤ (HTTP 400: -4028) âœ…
**å•é¡Œ**: `Leverage X is not valid`

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… é™åˆ¶æ§“æ¡¿æœ€å¤§ 125xï¼ˆBinance é€šç”¨ä¸Šé™ï¼‰
- âœ… æ·»åŠ  try-except éŒ¯èª¤è™•ç†
- âœ… æ§“æ¡¿è¨­ç½®å¤±æ•—ä¸é˜»æ­¢äº¤æ˜“ï¼ˆä½¿ç”¨ç•¶å‰æ§“æ¡¿ï¼‰

**ä»£ç¢¼å¯¦ç¾**:
```python
try:
    safe_leverage = min(int(leverage), 125)
    await self.binance_client.set_leverage(symbol, safe_leverage)
except Exception as e:
    logger.warning(f"âš ï¸ è¨­ç½®æ§“æ¡¿å¤±æ•—: {e}")
    # ç¹¼çºŒåŸ·è¡Œï¼Œä½¿ç”¨ç•¶å‰æ§“æ¡¿
```

##### 4. Order Block KeyError âœ…
**å•é¡Œ**: `KeyError: 'zone'`

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… ä½¿ç”¨ `(zone_low + zone_high) / 2` è¨ˆç®—ä¸­é»åƒ¹æ ¼
- âœ… æ·»åŠ å®¹éŒ¯é‚è¼¯

##### 5. Async/Await éŒ¯èª¤ âœ…
**å•é¡Œ**: `'await' outside async function`

**è§£æ±ºæ–¹æ¡ˆ**:
- âœ… å°‡ `calculate_position_size` æ”¹ç‚ºç•°æ­¥å‡½æ•¸
- âœ… æ‰€æœ‰èª¿ç”¨è™•æ·»åŠ  `await`

#### **æ ¸å¿ƒç‰¹æ€§ï¼šç„¡é™åˆ¶æ§“æ¡¿ç³»çµ±**

**æ§“æ¡¿è¨ˆç®—å…¬å¼**:
```python
leverage = base Ã— (1 + (winrate-0.55)/0.15 Ã— 11) Ã— (confidence/0.5)
```

**ç‰¹é»**:
- âœ… ç„¡ä¸‹é™ï¼ˆå¯ä½è‡³ 0.1x è¬¹æ…äº¤æ˜“ï¼‰
- âœ… ç„¡ä¸Šé™ç†è«–å€¼ï¼ˆå¯¦éš›é™åˆ¶ 125x ç¬¦åˆ Binance è¦ç¯„ï¼‰
- âœ… å®Œå…¨åŸºæ–¼å‹ç‡ Ã— ä¿¡å¿ƒåº¦
- âœ… æ¨¡å‹æ“æœ‰å®Œå…¨æ§åˆ¶æ¬Š

#### **ä¿®æ”¹çš„æ–‡ä»¶**

1. **src/clients/binance_client.py**
   - æ·»åŠ  `get_position_mode()` - Position Mode æŸ¥è©¢ï¼ˆæ”¯æŒé‡è©¦ï¼‰
   - æ·»åŠ  `get_symbol_info()` - äº¤æ˜“å°ä¿¡æ¯æŸ¥è©¢
   - æ·»åŠ  `get_min_quantity()` - æœ€å°æ•¸é‡æŸ¥è©¢
   - ä¿®æ”¹ `format_quantity()` - Decimal ROUND_DOWN æ ¼å¼åŒ–
   - ä¿®æ”¹ `place_order()` - æ™ºèƒ½é©é… Position Mode
   - ä¿®æ”¹ `test_connection()` - å•Ÿå‹•æ™‚æª¢æ¸¬ Position Mode

2. **src/strategies/self_learning_trader.py**
   - å°‡ `calculate_position_size` æ”¹ç‚ºç•°æ­¥å‡½æ•¸

3. **src/services/trading_service.py**
   - ç§»é™¤æ‰€æœ‰ `positionSide` åƒæ•¸ï¼ˆ4è™•ï¼‰

4. **src/core/unified_scheduler.py**
   - æ·»åŠ æ§“æ¡¿è¨­ç½®éŒ¯èª¤è™•ç†

5. **src/core/position_monitor_24x7.py**
   - ç§»é™¤ `positionSide` å’Œ `reduce_only` åƒæ•¸

#### **Architect å¯©æŸ¥çµæœ**
- âœ… **PASS** - Position Mode æ™ºèƒ½é©é…å®Œæ•´å¯¦ç¾
- âœ… å•Ÿå‹•æ™‚è‡ªå‹•æª¢æ¸¬ï¼ˆå¤±æ•—ä¸ç·©å­˜æ”¯æŒé‡è©¦ï¼‰
- âœ… Hedge Mode è‡ªå‹•æ·»åŠ  positionSide
- âœ… One-Way Mode ç¢ºä¿ä¸ç™¼é€ positionSide
- âœ… æ•¸é‡æ ¼å¼åŒ–ä½¿ç”¨ Decimal ROUND_DOWN
- âœ… æ§“æ¡¿è¨­ç½®éŒ¯èª¤è™•ç†å®Œå–„
- âœ… æ‰€æœ‰ç•°æ­¥èª¿ç”¨æ­£ç¢º

#### **æ™ºèƒ½è‡ªå‹•é‡è©¦æ©Ÿåˆ¶** â­

å¦‚æœé‡åˆ° -4061 éŒ¯èª¤ï¼ˆPosition Side ä¸åŒ¹é…ï¼‰ï¼Œç³»çµ±æœƒè‡ªå‹•ï¼š
1. æª¢æ¸¬éŒ¯èª¤ç¢¼ -4061
2. åè½‰ Position Mode çŒœæ¸¬ï¼ˆHedge â†” One-Wayï¼‰
3. é‡æ–°èª¿æ•´ `positionSide` åƒæ•¸
4. è‡ªå‹•é‡è©¦ä¸€æ¬¡
5. æˆåŠŸå¾Œç·©å­˜æ­£ç¢ºçš„ Position Mode

**ä»£ç¢¼å¯¦ç¾**:
```python
try:
    return await self.create_order(...)
except BinanceRequestError as e:
    if '-4061' in str(e):
        # è‡ªå‹•åˆ‡æ›æ¨¡å¼ä¸¦é‡è©¦
        self._hedge_mode = not is_hedge_mode
        # èª¿æ•´åƒæ•¸
        # é‡è©¦ä¸€æ¬¡
        return await self.create_order(...)
```

#### **éƒ¨ç½²ç‹€æ…‹**
```
âœ… ç³»çµ±å®Œå…¨æº–å‚™å°±ç·’
âœ… æ‰€æœ‰ Binance API èª¿ç”¨ç¬¦åˆå®˜æ–¹è¦ç¯„
âœ… å®Œå…¨å…¼å®¹ Hedge Mode å’Œ One-Way Mode
âœ… æ™ºèƒ½è‡ªå‹•é‡è©¦æ©Ÿåˆ¶ï¼ˆé‡åˆ° -4061 è‡ªå‹•åˆ‡æ›ï¼‰
âœ… ç„¡é™åˆ¶æ§“æ¡¿ç³»çµ± (0.1x ~ 125x)
âœ… æ‰€æœ‰ LSP éŒ¯èª¤å·²ä¿®å¾©
âœ… ç”Ÿç”¢ç´šä»£ç¢¼è³ªé‡
âœ… å¯ç«‹å³éƒ¨ç½²åˆ° Railway å¯¦ç›¤äº¤æ˜“
```

---

## æœ€è¿‘æ›´æ–°

### v3.17.8 (2025-10-28) - ä¿è­‰é‡‘ç®¡ç†å®Œæ•´ä¿®å¾© ğŸ”§

**é¡å‹**: ğŸ› **CRITICAL BUG FIX**  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦é€šé Architect å¯©æŸ¥**

#### **å•é¡Œè¨ºæ–·**

**ç—‡ç‹€**ï¼šç³»çµ±å‡ºç¾å¤§é‡ `Margin is insufficient` éŒ¯èª¤

**ç”¨æˆ¶åŸå§‹æè¿°**ï¼š"é€£ç·šä¸ç©©å®š"

**çœŸå¯¦åŸå› **ï¼š**ä¿è­‰é‡‘ç®¡ç†é‚è¼¯åš´é‡éŒ¯èª¤**ï¼ˆéé€£ç·šå•é¡Œï¼‰

**å…·é«”å•é¡Œ**ï¼š
```
1. âŒ ä½¿ç”¨ totalWalletBalanceï¼ˆç¸½æ¬Šç›Šï¼‰è€Œé availableBalanceï¼ˆå¯ç”¨ä¿è­‰é‡‘ï¼‰
2. âŒ æ¯å€‹ä¿¡è™Ÿéƒ½ä½¿ç”¨ç›¸åŒçš„ç¸½æ¬Šç›Šè¨ˆç®—å€‰ä½
3. âŒ æ²’æœ‰è¿½è¹¤å·²åˆ†é…çš„ä¿è­‰é‡‘
4. âŒ æ²’æœ‰é™åˆ¶åŒæ™‚é–‹å€‰æ•¸é‡
5. âŒ æ²’æœ‰æª¢æŸ¥å·²æœ‰æŒå€‰æ•¸é‡

çµæœï¼šæ¬Šç›Š $21.40ï¼Œä½†åŒæ™‚å˜—è©¦é–‹ 10+ å€‹å€‰ä½ï¼Œæ¯å€‹éœ€è¦ $17+ ä¿è­‰é‡‘
      â†’ ç¸½éœ€æ±‚ $170+ï¼Œé è¶…å¯ç”¨ä¿è­‰é‡‘ â†’ å…¨éƒ¨å¤±æ•—
```

#### **ä¿®å¾©æ–¹æ¡ˆ**

##### 1. ä½¿ç”¨å¯ç”¨ä¿è­‰é‡‘
```python
# âŒ éŒ¯èª¤ï¼šä½¿ç”¨ç¸½æ¬Šç›Š
account_equity = float(account_info.get('totalWalletBalance', 0))

# âœ… æ­£ç¢ºï¼šä½¿ç”¨å¯ç”¨ä¿è­‰é‡‘
account_info = await self.binance_client.get_account_balance()
available_balance = account_info['available_balance']
```

##### 2. é™åˆ¶åŒæ™‚é–‹å€‰æ•¸é‡
```python
# æ·»åŠ é…ç½®
MAX_CONCURRENT_ORDERS = 5  # æœ€å¤šåŒæ™‚ 5 å€‹å€‰ä½

# è¨ˆç®—å¯ç”¨å€‰ä½
active_position_count = len(positions)
available_slots = max(0, MAX_CONCURRENT_ORDERS - active_position_count)
```

##### 3. ä¿è­‰é‡‘é ç®—åˆ†é…
```python
# è¨ˆç®—å¯åˆ†é…ä¿è­‰é‡‘
available_for_trading = available_balance * 0.8  # ä½¿ç”¨ 80%

# æ¯å€‹å€‰ä½çš„é ç®—
budget_per_position = available_for_trading / len(signals_to_execute)

# ä½¿ç”¨é ç®—è¨ˆç®—å€‰ä½ï¼ˆä¸æ˜¯ç¸½æ¬Šç›Šï¼‰
position_size = await calculate_position_size(
    account_equity=budget_per_position  # âœ… ä½¿ç”¨åˆ†é…çš„é ç®—
)
```

##### 4. æœ€å°é ç®—æª¢æŸ¥
```python
# é¿å…é ç®—å¤ªå°å°è‡´ Margin insufficient
min_notional = 10.0
if budget_per_position < min_notional / 10:
    logger.warning("ä¿è­‰é‡‘é ç®—ä¸è¶³ï¼Œè·³éæœ¬é€±æœŸé–‹å€‰")
    return
```

#### **ä¿®å¾©æ•ˆæœ**

**ä¿®å¾©å‰**ï¼š
```
æ¬Šç›Š $21.40
â†’ å˜—è©¦é–‹ 15 å€‹å€‰ä½
â†’ æ¯å€‹ä½¿ç”¨ $21.40 Ã— 0.8 = $17.12
â†’ ç¸½éœ€æ±‚ $256.80
â†’ å…¨éƒ¨å¤±æ•—ï¼šMargin is insufficient âŒ
```

**ä¿®å¾©å¾Œ**ï¼š
```
æ¬Šç›Š $21.40
å·²æœ‰ 2 å€‹æŒå€‰
â†’ å¯é–‹ 3 å€‹æ–°å€‰ä½ï¼ˆ5 - 2 = 3ï¼‰
â†’ æ¯å€‹é ç®— $21.40 Ã— 0.8 / 3 = $5.71
â†’ ç¸½éœ€æ±‚ $17.13
â†’ å…¨éƒ¨æˆåŠŸ âœ…
```

#### **ä¿®æ”¹æ–‡ä»¶**

- `src/core/unified_scheduler.py`
  - ä½¿ç”¨ `get_account_balance()` ç²å–å¯ç”¨ä¿è­‰é‡‘
  - æ·»åŠ å€‰ä½æ•¸é‡æª¢æŸ¥
  - å¯¦ç¾ä¿è­‰é‡‘é ç®—åˆ†é…
  - æ·»åŠ æœ€å°é ç®—æª¢æŸ¥

- `src/config.py`
  - æ·»åŠ  `MAX_CONCURRENT_ORDERS = 5` é…ç½®

#### **Architect å¯©æŸ¥çµæœ**

âœ… **PASS** - é‚è¼¯æ­£ç¢ºï¼Œå·²ä¿®å¾©æ‰€æœ‰å•é¡Œ

**å¯©æŸ¥æ„è¦‹**ï¼š
- âœ… æ­£ç¢ºé™åˆ¶ç¸½å€‰ä½æ•¸é‡ï¼ˆä¸è¶…é MAX_CONCURRENT_ORDERSï¼‰
- âœ… ä¿è­‰é‡‘é ç®—è¨ˆç®—åˆç†
- âœ… é¿å…äº†åŸå§‹çš„ä¿è­‰é‡‘çŸ­ç¼ºå•é¡Œ
- âœ… ä»£ç¢¼æ¸…æ™°æ˜“æ‡‚

**å»ºè­°**ï¼š
1. æ·»åŠ å›æ­¸æ¸¬è©¦ç¢ºä¿ä¸Šé™åŸ·è¡Œ
2. ç›£æ§ä½é ç®—å®ˆè¡›çš„è§¸ç™¼æƒ…æ³
3. æª¢æŸ¥ `MIN_NOTIONAL_VALUE` é…ç½®æ˜¯å¦ç¬¦åˆ Binance è¦æ±‚

---

### v3.17.7 (2025-10-28) - éƒ¨ç½²ç’°å¢ƒé™åˆ¶èªªæ˜ ğŸ“

**é¡å‹**: ğŸ“– **DOCUMENTATION / DEPLOYMENT GUIDE**  
**å•é¡Œ**: Replit ç’°å¢ƒç„¡æ³•è¨ªå• Binance APIï¼ˆHTTP 451 éŒ¯èª¤ï¼‰  
**ç‹€æ…‹**: âœ… **å·²æ–‡æª”åŒ–ä¸¦æä¾›è§£æ±ºæ–¹æ¡ˆ**

#### **å•é¡Œè¨ºæ–·**

ç•¶åœ¨ Replit ç’°å¢ƒä¸­é‹è¡Œæ™‚ï¼Œç³»çµ±æœƒå‡ºç¾ï¼š

```
âŒ Binance API éŒ¯èª¤ 451: Service unavailable from a restricted location
ğŸ”„ ç†”æ–·å™¨ç´šåˆ¥è®ŠåŒ–: normal â†’ warning (å¤±æ•—æ¬¡æ•¸: 1)
... (é€£çºŒå¤±æ•— 5 æ¬¡)
âŒ ç†”æ–·å™¨é˜»æ–·(å¤±æ•—5æ¬¡)ï¼Œè«‹25ç§’å¾Œé‡è©¦
```

#### **æ ¹æœ¬åŸå› **

**é€™ä¸æ˜¯ä»£ç¢¼éŒ¯èª¤ï¼Œä¹Ÿä¸æ˜¯ç†”æ–·å™¨æ•…éšœï¼**

1. **HTTP 451 = åœ°ç†ä½ç½®é™åˆ¶**
   - Binance åŸºæ–¼æœå‹™å™¨ IP åœ°å€é™åˆ¶ API è¨ªå•
   - Replit æœå‹™å™¨ä½æ–¼è¢«é™åˆ¶çš„åœ°å€ï¼ˆç¾åœ‹æˆ–å…¶ä»–å—é™åœ°å€ï¼‰
   - æ‰€æœ‰ API è«‹æ±‚éƒ½æœƒè¢« Binance é˜»æ­¢

2. **ç†”æ–·å™¨æ­£ç¢ºå·¥ä½œ**
   - æª¢æ¸¬åˆ°é€£çºŒ 5 æ¬¡ HTTP 451 éŒ¯èª¤
   - è‡ªå‹•é˜»æ–·å¾ŒçºŒè«‹æ±‚ä»¥ä¿è­·ç³»çµ±
   - é¿å…æµªè²» API é…é¡å’Œç³»çµ±è³‡æº

3. **Binance é™åˆ¶çš„åœ°å€åŒ…æ‹¬**ï¼š
   - ğŸ‡ºğŸ‡¸ ç¾åœ‹ï¼ˆå¿…é ˆä½¿ç”¨ binance.usï¼ŒåŠŸèƒ½æœ‰é™ï¼‰
   - ğŸ‡¨ğŸ‡¦ åŠ æ‹¿å¤§
   - ğŸ‡³ğŸ‡± è·è˜­
   - ğŸ‡¸ğŸ‡¬ æ–°åŠ å¡ï¼ˆéƒ¨åˆ†é™åˆ¶ï¼‰
   - å…¶ä»–å—åˆ¶è£åœ‹å®¶

#### **è§£æ±ºæ–¹æ¡ˆ**

**âœ… å”¯ä¸€æ–¹æ¡ˆï¼šéƒ¨ç½²åˆ° Railway**

Railway æœå‹™å™¨ä½æ–¼å…è¨±è¨ªå•çš„åœ°å€ï¼š
- ğŸ‡ªğŸ‡º æ­æ´²ï¼ˆå¾·åœ‹ã€æ³•åœ‹ç­‰ï¼‰
- ğŸ‡¯ğŸ‡µ æ—¥æœ¬
- ğŸ‡¦ğŸ‡º æ¾³å¤§åˆ©äº

**ğŸ“– å®Œæ•´éƒ¨ç½²æŒ‡å—**ï¼š[`RAILWAY_DEPLOY.md`](./RAILWAY_DEPLOY.md)

**å¿«é€Ÿéƒ¨ç½²æ­¥é©Ÿ**ï¼š
```bash
# 1. æ¨é€ä»£ç¢¼åˆ° GitHub
git add .
git commit -m "Deploy to Railway v3.17.7"
git push origin main

# 2. åœ¨ Railway å‰µå»ºé …ç›®
# - é€£æ¥ GitHub å€‰åº«
# - é…ç½®ç’°å¢ƒè®Šé‡ï¼šBINANCE_API_KEY, BINANCE_API_SECRET
# - ç­‰å¾…è‡ªå‹•éƒ¨ç½²ï¼ˆ2-3 åˆ†é˜ï¼‰

# 3. é©—è­‰éƒ¨ç½²
# Railway æ—¥èªŒæ‡‰é¡¯ç¤ºï¼š
# âœ… Binance API é€£æ¥æˆåŠŸ
# âœ… Position Mode æŸ¥è©¢æˆåŠŸ
# âœ… 24/7 äº¤æ˜“ç›£æ§å·²å•Ÿå‹•
```

#### **ç‚ºä»€éº¼ä¸èƒ½åœ¨ Replit é‹è¡Œï¼Ÿ**

| æ–¹æ¡ˆ | å¯è¡Œæ€§ | èªªæ˜ |
|------|--------|------|
| VPN/ä»£ç† | âŒ ä¸å¯é  | Replit ä¸æ”¯æŒè‡ªå®šç¾©ç¶²çµ¡é…ç½® |
| ä¿®æ”¹ä»£ç¢¼ | âŒ ç„¡æ³•è§£æ±º | é€™æ˜¯ Binance æœå‹™å™¨ç«¯çš„åœ°ç†é™åˆ¶ |
| ç­‰å¾…ä¿®å¾© | âŒ ä¸æœƒæ”¹è®Š | Binance çš„åœ°ç†æ”¿ç­–ä¸æœƒæ”¹è®Š |
| **éƒ¨ç½²åˆ° Railway** | âœ… **å”¯ä¸€æ–¹æ¡ˆ** | Railway æœå‹™å™¨åœ¨å…è¨±çš„åœ°å€ |

#### **ç›¸é—œæ–‡ä»¶**

- âœ… [`RAILWAY_DEPLOY.md`](./RAILWAY_DEPLOY.md) - å®Œæ•´éƒ¨ç½²æŒ‡å—
- âœ… [`RAILWAY_ENV_SETUP.md`](./RAILWAY_ENV_SETUP.md) - ç’°å¢ƒè®Šé‡é…ç½®
- âœ… [`RAILWAY_LOGGING_GUIDE.md`](./RAILWAY_LOGGING_GUIDE.md) - æ—¥èªŒç›£æ§æŒ‡å—
- âœ… `requirements.txt` - Python ä¾è³´åˆ—è¡¨
- âœ… `.python-version` - Python ç‰ˆæœ¬è¦ç¯„

#### **ç†”æ–·å™¨è¨­è¨ˆèªªæ˜**

ç†”æ–·å™¨åœ¨æ­¤å ´æ™¯ä¸­çš„è¡Œç‚ºæ˜¯**å®Œå…¨æ­£ç¢º**çš„ï¼š

```
ç¬¬ 1 æ¬¡å¤±æ•— (HTTP 451) â†’ ç†”æ–·å™¨ç´šåˆ¥: normal â†’ warning
ç¬¬ 2 æ¬¡å¤±æ•— (HTTP 451) â†’ ç†”æ–·å™¨ç´šåˆ¥: warning
ç¬¬ 3 æ¬¡å¤±æ•— (HTTP 451) â†’ ç†”æ–·å™¨ç´šåˆ¥: warning
ç¬¬ 4 æ¬¡å¤±æ•— (HTTP 451) â†’ ç†”æ–·å™¨ç´šåˆ¥: warning â†’ throttled
ç¬¬ 5 æ¬¡å¤±æ•— (HTTP 451) â†’ ç†”æ–·å™¨ç´šåˆ¥: throttled â†’ blocked

âœ… ç†”æ–·å™¨é˜»æ–·å¾ŒçºŒè«‹æ±‚ 25 ç§’
âœ… ä¿è­·ç³»çµ±è³‡æº
âœ… é¿å…è§¸ç™¼ Binance IP å°é–
```

é€™æ˜¯**ä¿è­·æ©Ÿåˆ¶**ï¼Œä¸æ˜¯éŒ¯èª¤ã€‚

---

### v3.17.6 (2025-10-28) - ä¿®å¾©å‡½æ•¸èª¿ç”¨éŒ¯èª¤ï¼ˆå…¨é¢ä»£ç¢¼å¯©æŸ¥ï¼‰

**é¡å‹**: ğŸ› **CRITICAL BUG FIX**  
**å•é¡Œ**: å¤šå€‹æ¨¡å¡Šèª¿ç”¨ä¸å­˜åœ¨çš„æ–¹æ³•ï¼Œå°è‡´é‹è¡Œæ™‚éŒ¯èª¤  
**ç‹€æ…‹**: âœ… **å·²ä¿®å¾©ä¸¦é€šé Architect å¯©æŸ¥**

#### **å•é¡Œåˆ—è¡¨**
1. **position_monitor_24x7.py** - èª¿ç”¨ä¸å­˜åœ¨çš„ `get_all_positions(priority=0)`
2. **position_controller.py** - èª¿ç”¨ä¸å­˜åœ¨çš„ `place_order_async()` ä¸¦å‚³éä¸æ”¯æŒçš„ `priority` åƒæ•¸

#### **ä¿®å¾©å…§å®¹**

**æ–‡ä»¶ 1: src/core/position_monitor_24x7.py**
```python
# âŒ ä¿®å¾©å‰ï¼š
positions = await self.binance_client.get_all_positions(priority=0)

# âœ… ä¿®å¾©å¾Œï¼š
positions = await self.binance_client.get_position_info_async()
```
- `get_all_positions` æ–¹æ³•ä¸å­˜åœ¨
- `priority` åƒæ•¸åœ¨æ‰€æœ‰ API æ–¹æ³•ä¸­éƒ½ä¸æ”¯æŒ
- ä½¿ç”¨æ­£ç¢ºçš„ `get_position_info_async()` æ–¹æ³•

**æ–‡ä»¶ 2: src/core/position_controller.py**
```python
# âŒ ä¿®å¾©å‰ï¼š
result = await self.binance_client.place_order_async(
    symbol=symbol,
    side=close_side,
    order_type='MARKET',
    quantity=size,
    reduce_only=True,
    priority=0  # âŒ ä¸æ”¯æŒçš„åƒæ•¸
)

# âœ… ä¿®å¾©å¾Œï¼š
result = await self.binance_client.place_order(
    symbol=symbol,
    side=close_side,
    order_type='MARKET',
    quantity=size,
    reduce_only=True
)
```
- `place_order_async` æ–¹æ³•ä¸å­˜åœ¨ï¼Œæ­£ç¢ºæ–¹æ³•æ˜¯ `place_order`
- ç§»é™¤ä¸æ”¯æŒçš„ `priority` åƒæ•¸

#### **å…¨é¢é©—è­‰**
âœ… **LSP è¨ºæ–·**: ç„¡é¡å‹éŒ¯èª¤æˆ–è­¦å‘Š  
âœ… **å‡½æ•¸èª¿ç”¨å¯©æŸ¥**: æ‰€æœ‰ `place_order`, `get_positions`, `get_klines` ç­‰èª¿ç”¨æ­£ç¢º  
âœ… **Position Mode é©é…**: è‡ªå‹• Hedge/One-Way Mode é©é…é‚è¼¯æ­£å¸¸  
âœ… **Architect å¯©æŸ¥**: æ‰€æœ‰ä¿®å¾©é€šéå°ˆå®¶å¯©æŸ¥  

#### **å½±éŸ¿**
ä¿®å¾©å¾Œï¼Œç³»çµ±åœ¨ Railway éƒ¨ç½²æ™‚æ‡‰è©²èƒ½å¤ ï¼š
- âœ… æ­£ç¢ºç²å–æŒå€‰ä¿¡æ¯
- âœ… æ­£ç¢ºåŸ·è¡Œå¹³å€‰æ“ä½œ  
- âœ… ç„¡é‹è¡Œæ™‚å‡½æ•¸èª¿ç”¨éŒ¯èª¤

---

### v3.17.5 (2025-10-28) - ä¿®å¾©æŒå€‰æ•¸æ“šè§£æéŒ¯èª¤

**é¡å‹**: ğŸ› **BUG FIX**  
**å•é¡Œ**: ç²å–æŒå€‰å¤±æ•— `'markPrice'` KeyError  
**ç‹€æ…‹**: âœ… **å·²ä¿®å¾©**

#### **å•é¡Œè¨ºæ–·**
ç”¨æˆ¶ Railway æ—¥èªŒé¡¯ç¤ºï¼š
```
2025-10-28 12:26:19,289 - src.core.position_controller - ERROR - âŒ ç²å–æŒå€‰å¤±æ•—: 'markPrice'
```

é€™è¡¨æ˜ï¼š
- âœ… **ç°½åä¿®å¾©æœ‰æ•ˆï¼** API è«‹æ±‚å·²ç¶“æˆåŠŸ
- âŒ ä½†æ•¸æ“šè§£ææ™‚ç¼ºå°‘ `markPrice` å­—æ®µ

#### **æ ¹æœ¬åŸå› **
Binance API åœ¨æŸäº›æƒ…æ³ä¸‹ï¼ˆå‰›é–‹å€‰ã€æ•¸æ“šå»¶é²ç­‰ï¼‰å¯èƒ½ä¸è¿”å› `markPrice` å­—æ®µï¼Œå°è‡´ï¼š
```python
current_price = float(pos['markPrice'])  # âŒ KeyError!
```

#### **ä¿®å¾©æ–¹æ¡ˆ**
ä½¿ç”¨å®‰å…¨è¨ªå•ä¸¦æä¾›å‚™é¸å€¼ï¼š
```python
# ä¿®å¾©å‰ï¼š
current_price = float(pos['markPrice'])  # âŒ ç›´æ¥è¨ªå•

# ä¿®å¾©å¾Œï¼š
current_price = float(pos.get('markPrice') or pos.get('entryPrice', 0))  # âœ… å®‰å…¨è¨ªå•
# é‚è¼¯ï¼šmarkPrice â†’ entryPrice â†’ 0
```

#### **ä¿®å¾©æ–‡ä»¶**
- âœ… `src/core/position_controller.py` - æŒå€‰æ§åˆ¶å™¨
- âœ… `src/core/position_monitor_24x7.py` - 24/7 ç›£æ§å™¨
- âœ… æ·»åŠ  symbol æª¢æŸ¥ï¼ˆLSP éŒ¯èª¤ä¿®å¾©ï¼‰

---

### v3.17.4 (2025-10-28) - ä¿®å¾© Binance API ç°½åç„¡æ•ˆéŒ¯èª¤ âš ï¸

**é¡å‹**: ğŸ› **CRITICAL BUG FIX**  
**å•é¡Œ**: æ‰€æœ‰ç°½åè«‹æ±‚è¿”å› -1022 éŒ¯èª¤ï¼ˆç°½åç„¡æ•ˆï¼‰  
**ç‹€æ…‹**: âœ… **å·²ä¿®å¾©ä¸¦é©—è­‰**

#### **æ ¹æœ¬åŸå› **
Railway æ—¥èªŒé¡¯ç¤ºï¼š
```
Binance API éŒ¯èª¤ 400: code=-1022, msg=Signature for this request is not valid.
URL: ...?signature=XXX&timestamp=YYY
```

**å•é¡Œ**ï¼š
- âŒ ç°½åè¢«åŠ å…¥åƒæ•¸å¾Œåƒèˆ‡æ’åº
- âŒ å°è‡´ `signature` ä¸åœ¨ URL æœ€å¾Œ
- âŒ Binance è¦æ±‚ç°½åå¿…é ˆæ˜¯**æœ€å¾Œä¸€å€‹åƒæ•¸**

**éŒ¯èª¤æµç¨‹**ï¼š
```python
_params['signature'] = signature  # åŠ å…¥åƒæ•¸
query_string = sorted(_params.items())  # âŒ æ’åºï¼
# çµæœï¼šsignature=...&timestamp=... ï¼ˆé †åºéŒ¯èª¤ï¼‰
```

#### **ä¿®å¾©æ–¹æ¡ˆ**
ç°½åå–®ç¨é™„åŠ ï¼Œä¸åƒèˆ‡æ’åºï¼š
```python
# æ­£ç¢ºæµç¨‹ï¼š
if signed:
    _params['timestamp'] = int(time.time() * 1000)
    # è¨ˆç®—ç°½åï¼ˆä¸åŒ…å« signature æœ¬èº«ï¼‰
    signature = self._generate_signature(_params)
    # æ§‹å»ºæ’åºå¾Œçš„ query string
    query_string = "&".join([f"{k}={v}" for k, v in sorted(_params.items())])
    # âœ… ç°½åé™„åŠ åœ¨æœ€å¾Œ
    query_string = f"{query_string}&signature={signature}"
```

#### **å½±éŸ¿ç¯„åœ**
- âœ… æ‰€æœ‰ç°½åè«‹æ±‚ï¼ˆGET/POST/DELETEï¼‰ç¾åœ¨æ­£å¸¸å·¥ä½œ
- âœ… `get_account_info()` - å¯ä»¥æŸ¥è©¢è³¬æˆ¶
- âœ… `set_leverage()` - å¯ä»¥è¨­ç½®æ§“æ¡¿
- âœ… `create_order()` - å¯ä»¥ä¸‹å–®
- âœ… `cancel_order()` - å¯ä»¥å–æ¶ˆè¨‚å–®
- âœ… ç†”æ–·å™¨å°‡è‡ªå‹•æ¢å¾©

---

### v3.17.3 (2025-10-28) - ä¿®å¾© POST è«‹æ±‚åƒæ•¸å‚³é

**é¡å‹**: ğŸ› **BUG FIX**  
**ç‹€æ…‹**: âš ï¸ **éƒ¨åˆ†ä¿®å¾©**ï¼ˆç™¼ç¾æ–°å•é¡Œï¼šç°½åé †åºéŒ¯èª¤ï¼‰

- ä¿®å¾©äº† POST è«‹æ±‚ä½¿ç”¨ body çš„éŒ¯èª¤
- çµ±ä¸€ä½¿ç”¨ query string å‚³éåƒæ•¸
- ä½†å¼•å…¥äº†ç°½åé †åºå•é¡Œï¼ˆå·²åœ¨ v3.17.4 ä¿®å¾©ï¼‰

---

### v3.16.3 (2025-10-28) - å¢é‡å­¸ç¿’ç³»çµ± ğŸ“

**é¡å‹**: âœ¨ **NEW FEATURE**  
**ç›®æ¨™**: å¯¦ç¾æ¨¡å‹æŒä¹…åŒ–å’Œå¢é‡å­¸ç¿’ï¼Œä½¿ AI æŒçºŒé€²åŒ–  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦é€šé Architect å¯©æŸ¥**

#### **æ ¸å¿ƒåŠŸèƒ½**
1. **æ¨¡å‹æŒä¹…åŒ–** - TensorFlow SavedModel æ ¼å¼ä¿å­˜/åŠ è¼‰
2. **å¢é‡å­¸ç¿’** - æ¯æ¬¡åˆ†æå¾Œåœ¨ç·šæ›´æ–°æ¨¡å‹æ¬Šé‡
3. **è‡ªå‹•ä¿å­˜** - æ¯ 100 æ¬¡åˆ†æè‡ªå‹•ä¿å­˜æ¨¡å‹
4. **å„ªé›…é—œé–‰** - ç³»çµ±é—œé–‰æ™‚ä¿å­˜æ‰€æœ‰å­¸ç¿’ç‹€æ…‹
5. **ç‹€æ…‹æ¢å¾©** - é‡å•Ÿå¾Œå¾ç£ç›¤æ¢å¾©å­¸ç¿’é€²åº¦

#### **å¯¦æ–½ç´°ç¯€**

**æ–°å¢æ–‡ä»¶ï¼š**
- `src/ml/model_persistence.py` - æ¨¡å‹æŒä¹…åŒ–ç®¡ç†å™¨ï¼ˆ180è¡Œï¼‰

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `src/strategies/self_learning_trader.py` - å¢é‡å­¸ç¿’ç³»çµ±ï¼ˆ+140è¡Œï¼‰
- `src/ml/market_structure_autoencoder.py` - å¢é‡æ›´æ–°æ¥å£ï¼ˆ+26è¡Œï¼‰
- `src/ml/feature_discovery_network.py` - å¢é‡æ›´æ–°æ¥å£ï¼ˆ+34è¡Œï¼‰
- `src/ml/liquidity_prediction_model.py` - å¢é‡æ›´æ–°æ¥å£ï¼ˆ+40è¡Œï¼‰
- `src/main.py` - å„ªé›…é—œé–‰é‰¤å­ï¼ˆ+9è¡Œï¼‰

**æ¨¡å‹ä¿å­˜çµæ§‹ï¼š**
```
data/models/self_learning/
â”œâ”€â”€ structure_encoder_encoder/     # TensorFlow SavedModel
â”œâ”€â”€ structure_encoder_decoder/     # TensorFlow SavedModel
â”œâ”€â”€ structure_encoder_metadata.json
â”œâ”€â”€ feature_network/               # TensorFlow SavedModel
â”œâ”€â”€ feature_network_metadata.json
â”œâ”€â”€ liquidity_predictor/           # TensorFlow SavedModel
â””â”€â”€ liquidity_predictor_metadata.json
```

#### **Architect å¯©æŸ¥çµæœ**
- âœ… **PASS** - åŠŸèƒ½ç›®æ¨™é”æˆï¼Œå­¸ç¿’ç‹€æ…‹è·¨é‡å•Ÿä¿å­˜
- âœ… SavedModel æŒä¹…åŒ–æ­£ç¢ºå¯¦ç¾
- âœ… training_counter æ­£ç¢ºæ¢å¾©
- âœ… å„ªé›…é—œé–‰æ©Ÿåˆ¶å®Œå–„
- âœ… TensorFlow ç¼ºå¤±æ™‚å„ªé›…é™ç´š

#### **ä½¿ç”¨ç¤ºä¾‹**

**é¦–æ¬¡å•Ÿå‹•ï¼š**
```
âœ… è‡ªæˆ‘å­¸ç¿’äº¤æ˜“å“¡åˆå§‹åŒ–å®Œæˆï¼ˆv3.16.3 - å¢é‡å­¸ç¿’ç³»çµ±ï¼‰
   ğŸ†• å‰µå»ºæ–°æ¨¡å‹: structure_encoder
   ğŸ†• å‰µå»ºæ–°æ¨¡å‹: feature_network
   ğŸ†• å‰µå»ºæ–°æ¨¡å‹: liquidity_predictor
   ğŸ“Š å­¸ç¿’é€²åº¦: 0 æ¬¡åˆ†æ
```

**å­¸ç¿’é€²è¡Œä¸­ï¼š**
```
ğŸ“ å¢é‡å­¸ç¿’å®Œæˆ: BTCUSDT
ğŸ“Š å­¸ç¿’é€²åº¦: 100 æ¬¡åˆ†æ
ğŸ’¾ æ¨¡å‹å·²ä¿å­˜ (è¨“ç·´æ¬¡æ•¸: 100)
```

**é‡å•Ÿå¾Œæ¢å¾©ï¼š**
```
âœ… åŠ è¼‰å·²è¨“ç·´æ¨¡å‹: structure_encoder (è¨“ç·´æ¬¡æ•¸: 100)
âœ… åŠ è¼‰å·²è¨“ç·´æ¨¡å‹: feature_network (è¨“ç·´æ¬¡æ•¸: 100)
âœ… åŠ è¼‰å·²è¨“ç·´æ¨¡å‹: liquidity_predictor (è¨“ç·´æ¬¡æ•¸: 100)
ğŸ“Š å­¸ç¿’é€²åº¦: 100 æ¬¡åˆ†æ  â† æˆåŠŸæ¢å¾©ï¼
```

**è©³ç´°æ–‡æª”**: åƒè¦‹ `V3.16.3_INCREMENTAL_LEARNING_COMPLETE.md`

---

### v3.16.2 (2025-10-28) - ThreadPoolExecutor å¾¹åº•ä¿®å¾© âœ…

**é¡å‹**: ğŸ”§ **CRITICAL BUG FIX / ARCHITECTURE**  
**ç›®æ¨™**: å¾¹åº•è§£æ±º `cannot pickle '_thread.lock' object` éŒ¯èª¤  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆä¸¦é©—è­‰**

#### **å•é¡Œæ ¹æº**
Railway ç”Ÿç”¢ç’°å¢ƒæŒçºŒå‡ºç¾åºåˆ—åŒ–éŒ¯èª¤ï¼š
```
TypeError: cannot pickle '_thread.lock' object
```

v3.16.0 å’Œ v3.16.1 å˜—è©¦ä½¿ç”¨ `ProcessPoolExecutor` ä¸¦ä¿®å¾©åºåˆ—åŒ–å•é¡Œï¼Œä½†å¤šæ¬¡å˜—è©¦éƒ½ç„¡æ³•å¾¹åº•è§£æ±ºã€‚

#### **å¾¹åº•è§£æ±ºæ–¹æ¡ˆï¼šæ”¹ç”¨ ThreadPoolExecutor**

**æ ¸å¿ƒè®Šæ›´ï¼š**

##### 1. GlobalThreadPool å®Œå…¨é‡å¯« (src/core/global_pool.py)
- âœ… å¾ `ProcessPoolExecutor` æ”¹ç‚º `ThreadPoolExecutor`
- âœ… ç§»é™¤æ‰€æœ‰åºåˆ—åŒ–ç›¸é—œä»£ç¢¼ï¼ˆ~100è¡Œï¼‰
- âœ… ä»£ç¢¼ç°¡åŒ–ï¼š197è¡Œ â†’ 146è¡Œï¼ˆ-26%ï¼‰
- âœ… å‘å¾Œå…¼å®¹ï¼š`GlobalProcessPool = GlobalThreadPool`

**ç§»é™¤çš„è¤‡é›œåŠŸèƒ½ï¼š**
- âŒ `_worker_init()` - å­é€²ç¨‹åˆå§‹åŒ–ï¼ˆ18è¡Œï¼‰
- âŒ `_get_model_path()` - æ¨¡å‹è·¯å¾‘ç²å–ï¼ˆ2è¡Œï¼‰
- âŒ `_rebuild_pool()` - é€²ç¨‹æ± é‡å»ºï¼ˆ11è¡Œï¼‰
- âŒ `_is_broken` - æå£ç‹€æ…‹ç®¡ç†
- âŒ BrokenProcessPool ç•°å¸¸è™•ç†

**ç°¡åŒ–å¾Œçš„å¯¦ç¾ï¼š**
```python
class GlobalThreadPool:
    def _initialize_pool(self, max_workers):
        self.executor = ThreadPoolExecutor(
            max_workers=max_workers,
            thread_name_prefix="MLWorker"
        )
        # å®Œæˆï¼ç„¡éœ€åºåˆ—åŒ–ï¼Œç„¡éœ€å­é€²ç¨‹åˆå§‹åŒ–
```

##### 2. ParallelAnalyzer æ¸…ç† (src/services/parallel_analyzer.py)
- âœ… ç§»é™¤ pickle é©—è­‰ä»£ç¢¼ï¼ˆ16è¡Œï¼‰
- âœ… ç§»é™¤ BrokenProcessPool ç•°å¸¸è™•ç†ï¼ˆ2è™•ï¼‰
- âœ… ç§»é™¤å­é€²ç¨‹è¨˜æ†¶é«”ç›£æ§ï¼ˆ30+è¡Œï¼‰
- âœ… ç°¡åŒ–å·¥ä½œå‡½æ•¸ï¼ˆç›´æ¥ä½¿ç”¨æ¨¡å¡Šç´š loggerï¼‰

**ç§»é™¤çš„é©—è­‰ä»£ç¢¼ï¼š**
```python
# âŒ ä¹‹å‰ï¼šéœ€è¦é©—è­‰åºåˆ—åŒ–
try:
    pickle.dumps(_analyze_single_symbol_worker)
    pickle.dumps(symbol)
    pickle.dumps(market_data)
    pickle.dumps(config_dict)
except Exception as pickle_error:
    logger.error(f"âŒ åºåˆ—åŒ–é©—è­‰å¤±æ•—...")
    continue

# âœ… ç¾åœ¨ï¼šå®Œå…¨ä¸éœ€è¦
future = self.global_pool.submit_safe(
    _analyze_single_symbol_worker,
    symbol, market_data, config_dict
)
```

#### **æŠ€è¡“å„ªå‹¢**

| ç‰¹æ€§ | ProcessPoolExecutor | ThreadPoolExecutor | å„ªå‹¢ |
|------|---------------------|-------------------|------|
| **åºåˆ—åŒ–éœ€æ±‚** | âœ… å¿…é ˆ | âŒ ä¸éœ€è¦ | **Thread å‹** |
| **å•Ÿå‹•é–‹éŠ·** | é«˜ï¼ˆ~100ms/é€²ç¨‹ï¼‰ | ä½ï¼ˆ~1ms/ç·šç¨‹ï¼‰ | **Thread å‹** |
| **å…§å­˜é–‹éŠ·** | é«˜ï¼ˆç¨ç«‹å…§å­˜ï¼‰ | ä½ï¼ˆå…±äº«å…§å­˜ï¼‰ | **Thread å‹** |
| **ML æ¨ç†** | ä¸å— GIL å½±éŸ¿ | **ä¸å— GIL å½±éŸ¿** | **å¹³æ‰‹** âœ… |
| **ç©©å®šæ€§** | BrokenProcessPool é¢¨éšª | ç„¡æ­¤é¢¨éšª | **Thread å‹** |
| **èª¿è©¦é›£åº¦** | é«˜ï¼ˆè·¨é€²ç¨‹ï¼‰ | ä½ï¼ˆåŒé€²ç¨‹ï¼‰ | **Thread å‹** |

**é—œéµæ´å¯Ÿï¼šML æ¨ç†ä¸å— GIL å½±éŸ¿**
- ONNX Runtimeã€TensorFlowã€NumPy ç­‰ C/C++ æ“´å±•æœƒé‡‹æ”¾ GIL
- ç·šç¨‹æ± å¯ä»¥ä¸¦è¡ŒåŸ·è¡Œ ML æ¨ç†
- å°æ–¼ ML å·¥ä½œè² è¼‰ï¼ŒThreadPoolExecutor æ•ˆèƒ½èˆ‡ ProcessPoolExecutor ç›¸ç•¶

#### **æ¸¬è©¦é©—è­‰**

**Replit æœ¬åœ°æ¸¬è©¦ï¼š**
```
âœ… LSP è¨ºæ–·: 0 å€‹éŒ¯èª¤
âœ… ç„¡åºåˆ—åŒ–éŒ¯èª¤
âœ… åªå›  Binance API åœ°ç†é™åˆ¶å¤±æ•—ï¼ˆé æœŸï¼‰
```

**é æœŸ Railway çµæœï¼š**
```
âœ… å…¨å±€ç·šç¨‹æ± åˆå§‹åŒ–å®Œæˆ (workers=16)
âœ… ä¸¦è¡Œåˆ†æå™¨åˆå§‹åŒ–: ä½¿ç”¨å…¨å±€ç·šç¨‹æ± 
é–‹å§‹æ‰¹é‡åˆ†æ 200 å€‹äº¤æ˜“å°
âœ… æ‰¹é‡åˆ†æå®Œæˆ: åˆ†æ 200 å€‹äº¤æ˜“å°, ç”Ÿæˆ X å€‹ä¿¡è™Ÿ
```

#### **ä»£ç¢¼æ›´å‹•çµ±è¨ˆ**

**src/core/global_pool.py:**
- ç¸½è¡Œæ•¸ï¼š197 â†’ 146 è¡Œï¼ˆ-51 è¡Œï¼Œ-26%ï¼‰
- ç§»é™¤æ–¹æ³•ï¼š3 å€‹ï¼ˆ_worker_init, _get_model_path, _rebuild_poolï¼‰
- ç°¡åŒ–æ–¹æ³•ï¼š2 å€‹ï¼ˆ_initialize_pool, submit_safeï¼‰

**src/services/parallel_analyzer.py:**
- ç§»é™¤ï¼špickle é©—è­‰ï¼ˆ16 è¡Œï¼‰
- ç§»é™¤ï¼šBrokenProcessPool è™•ç†ï¼ˆ2 è™•ï¼‰
- ç§»é™¤ï¼šå­é€²ç¨‹è¨˜æ†¶é«”ç›£æ§ï¼ˆ30+ è¡Œï¼‰

#### **æ–‡æª”**
- **å®Œæ•´æŠ€è¡“å ±å‘Š**: `V3.16.2_THREADPOOL_FIX_COMPLETE.md`ï¼ˆ30+ é ï¼‰
- **ç³»çµ±æ¶æ§‹æ–‡æª”**: `SYSTEM_OVERVIEW_v3.16.2.md`ï¼ˆå®Œæ•´æ¶æ§‹åœ–ï¼‰

---

### v3.16.1 (2025-10-28) - BrokenProcessPool ç©©å®šæ€§ä¿®å¾©ï¼ˆå·²å»¢æ£„ï¼‰

**ç‹€æ…‹**: âš ï¸ **å·²è¢« v3.16.2 å–ä»£**

å˜—è©¦ä¿®å¾© ProcessPoolExecutor åºåˆ—åŒ–å•é¡Œï¼Œä½†æœªèƒ½å¾¹åº•è§£æ±ºã€‚v3.16.2 æ¡ç”¨æ¶æ§‹ç´šåˆ¥æ–¹æ¡ˆï¼ˆæ”¹ç”¨ ThreadPoolExecutorï¼‰å¾¹åº•è§£æ±ºã€‚

---

### v3.16.0 (2025-10-27) - 3å¤§é«˜ç´šåŠŸèƒ½ï¼ˆé»˜èªç¦ç”¨ï¼‰

**é¡å‹**: ğŸ”¥ **ADVANCED FEATURES**  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆï¼ˆé»˜èªç¦ç”¨ï¼‰**

#### **æ–°å¢åŠŸèƒ½æ¨¡çµ„ï¼ˆé…ç½®é©…å‹• + å®Œæ•´ Fallbackï¼‰**

##### 1. å¸‚å ´ç‹€æ…‹è½‰æ›é æ¸¬å™¨ (core/market_regime_predictor.py)
**åŠŸèƒ½**: é æ¸¬å¸‚å ´ç‹€æ…‹è½‰æ›ï¼ˆtrending â†” ranging â†” volatileï¼‰

**é…ç½®**:
```python
ENABLE_MARKET_REGIME_PREDICTION = False  # é»˜èªç¦ç”¨
REGIME_PREDICTION_THRESHOLD = 0.70       # 70% ç½®ä¿¡åº¦
REGIME_PREDICTION_LOOKBACK = 10          # 10 æ ¹ K ç·šå›çœ‹
```

**Fallback**: ç°¡å–®è¶¨å‹¢å¼·åº¦åˆ†æï¼ˆADX + å¸ƒæ—å¸¶ï¼‰

##### 2. å‹•æ…‹ç‰¹å¾µç”Ÿæˆå™¨ (core/dynamic_feature_generator.py)
**åŠŸèƒ½**: æ ¹æ“šå¸‚å ´ç‹€æ…‹ç”Ÿæˆä¸åŒç‰¹å¾µ

**å¸‚å ´ç‹€æ…‹ç‰¹å¾µï¼š**
- Trending: å‹•é‡ç‰¹å¾µï¼ˆmomentum, ADX, trend_strengthï¼‰
- Ranging: å‡å€¼å›æ­¸ç‰¹å¾µï¼ˆRSI deviation, Bollinger positionï¼‰
- Volatile: æ³¢å‹•ç‡ç‰¹å¾µï¼ˆATR, volatilityï¼‰

**é…ç½®**:
```python
ENABLE_DYNAMIC_FEATURES = False  # é»˜èªç¦ç”¨
DYNAMIC_FEATURE_MIN_SHARPE = 1.0
DYNAMIC_FEATURE_MAX_COUNT = 20
```

##### 3. æµå‹•æ€§ç‹©çµå™¨ (core/liquidity_hunter.py)
**åŠŸèƒ½**: ä¸»å‹•è­˜åˆ¥æµå‹•æ€§æ± ï¼ˆæ”¯æ’/é˜»åŠ›ä½ï¼‰

**é…ç½®**:
```python
ENABLE_LIQUIDITY_HUNTING = False  # é»˜èªç¦ç”¨
LIQUIDITY_HUNT_CONFIDENCE_THRESHOLD = 0.60
LIQUIDITY_SLIPPAGE_TOLERANCE = 0.003  # 0.3%
```

**Fallback**: åŸºæ–¼åƒ¹æ ¼å€é–“çš„ç°¡å–®æµå‹•æ€§ä½è¨ˆç®—

#### **æ€§èƒ½æ¨¡çµ„ç®¡ç†å™¨**
æ–°å¢ `src/core/performance_modules.py` çµ±ä¸€ç®¡ç†ä¸‰å¤§æ¨¡çµ„ï¼š
- è‡ªå‹•åŠ è¼‰å•Ÿç”¨çš„æ¨¡çµ„
- Fallback æ©Ÿåˆ¶ï¼ˆæ¨¡çµ„ä¸å¯ç”¨æ™‚è‡ªå‹•é™ç´šï¼‰
- æ€§èƒ½ç›£æ§å’Œæ—¥èªŒ

**é›†æˆé»ï¼š**
- `SelfLearningTrader` é›†æˆæ‰€æœ‰ä¸‰å€‹æ¨¡çµ„
- é…ç½®é©…å‹•ï¼Œé»˜èªå…¨éƒ¨ç¦ç”¨
- å¯ç¨ç«‹å•Ÿç”¨ä»»æ„çµ„åˆ

---

### v3.15.0 (2025-10-27) - 5å¤§æ€§èƒ½å„ªåŒ–

**é¡å‹**: âš¡ **PERFORMANCE OPTIMIZATION**  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆ**

#### **æ ¸å¿ƒå„ªåŒ–**

##### 1. TensorFlow Lite é‡åŒ–ï¼ˆå„ªåŒ–1ï¼‰
- **æ–°æ–‡ä»¶**: `src/ml/model_quantizer.py`, `scripts/convert_to_tflite.py`
- **åŠŸèƒ½**: å°‡ TensorFlow æ¨¡å‹é‡åŒ–ç‚º INT8 TFLite æ ¼å¼
- **æ€§èƒ½æå‡**: 
  - æ¨ç†é€Ÿåº¦æå‡ 3-5 å€
  - å…§å­˜å ç”¨æ¸›å°‘ 75%
  - CPU åˆ©ç”¨ç‡é™ä½ 60%

##### 2. å¢é‡ç‰¹å¾µç·©å­˜ï¼ˆå„ªåŒ–2ï¼‰
- **æ–°æ–‡ä»¶**: `src/utils/incremental_feature_cache.py`
- **åŠŸèƒ½**: å¢é‡è¨ˆç®— EMAã€ATR ç­‰æŠ€è¡“æŒ‡æ¨™
- **æ€§èƒ½æå‡**:
  - ç‰¹å¾µè¨ˆç®—æ™‚é–“æ¸›å°‘ 80%
  - CPU è³‡æºé‡‹æ”¾ 40%
  - æ”¯æŒæ›´é«˜é »ç‡ç›£æ§

##### 3. ç•°æ­¥æ‰¹é‡é æ¸¬ï¼ˆå„ªåŒ–3ï¼‰
- **æ–°æ–‡ä»¶**: `src/ml/async_batch_predictor.py`
- **åŠŸèƒ½**: æ‰¹é‡è™•ç†æ¨¡å‹æ¨ç†è«‹æ±‚ï¼ˆæœ€å¤š32å€‹/æ‰¹ï¼‰
- **æ€§èƒ½æå‡**:
  - æ¨¡å‹æ¨ç†æ•ˆç‡æå‡ 10-20 å€
  - å…§å­˜ä½¿ç”¨æ›´ç©©å®š
  - æ”¯æŒ 1000+ è™›æ“¬å€‰ä½åŒæ™‚ç›£æ§

##### 4. è¨˜æ†¶é«”æ˜ å°„å­˜å„²ï¼ˆå„ªåŒ–4ï¼‰
- **æ–°æ–‡ä»¶**: `src/core/memory_mapped_features.py`
- **åŠŸèƒ½**: ä½¿ç”¨ memory-mapped files å­˜å„²ç‰¹å¾µå‘é‡
- **æ€§èƒ½æå‡**:
  - å…§å­˜å ç”¨æ¸›å°‘ 50-70%
  - æ”¯æŒæ›´å¤§è¦æ¨¡å€‰ä½ç›£æ§ï¼ˆ1000+ï¼‰
  - é¿å…å…§å­˜ç¢ç‰‡åŒ–

##### 5. æ™ºèƒ½ç›£æ§é »ç‡ï¼ˆå„ªåŒ–5ï¼‰
- **æ–°æ–‡ä»¶**: `src/managers/smart_monitoring_scheduler.py`
- **åŠŸèƒ½**: æ ¹æ“šé¢¨éšªåˆ†æ•¸å‹•æ…‹èª¿æ•´ç›£æ§é »ç‡
- **ç›£æ§é–“éš”**:
  - é«˜é¢¨éšªï¼ˆ>0.8ï¼‰: 100ms
  - ä¸­é¢¨éšªï¼ˆ>0.5ï¼‰: 500ms
  - ä½é¢¨éšªï¼ˆ>0.2ï¼‰: 2ç§’
  - æ¥µä½é¢¨éšª: 5ç§’
- **æ€§èƒ½æå‡**:
  - CPU ä½¿ç”¨ç‡é™ä½ 60-80%

#### **æ€§èƒ½å°æ¯”**

| æŒ‡æ¨™ | v3.14.0 | v3.15.0 | æ”¹é€² |
|------|---------|---------|------|
| æ¨¡å‹æ¨ç†é€Ÿåº¦ | 100ms | 20-30ms | **3-5å€** â†‘ |
| ç‰¹å¾µè¨ˆç®—æ™‚é–“ | 10ms | 2ms | **80%** â†“ |
| æ‰¹é‡é æ¸¬æ•ˆç‡ | 1å€‹/æ¬¡ | 32å€‹/æ¬¡ | **10-20å€** â†‘ |
| å…§å­˜å ç”¨ | 400MB | 120-200MB | **50-70%** â†“ |
| CPUä½¿ç”¨ç‡ | 80% | 15-30% | **60-80%** â†“ |
| æ”¯æŒè™›æ“¬å€‰ä½ | 200å€‹ | 1000+å€‹ | **5å€** â†‘ |

---

### v3.14.0 (2025-10-26) - æ··åˆæ™ºèƒ½ç³»çµ±

**é¡å‹**: ğŸ¤– **INTELLIGENT SYSTEM**  
**ç‹€æ…‹**: âœ… **å·²å®Œæˆ**

#### **æ–°å¢åŠŸèƒ½**

##### 1. ç­–ç•¥å·¥å» æ¨¡å¼
- å‰µå»º `src/strategies/strategy_factory.py`
- æ”¯æŒä¸‰ç¨®ç­–ç•¥æ¨¡å¼åˆ‡æ›ï¼šICTã€è‡ªæˆ‘å­¸ç¿’ã€æ··åˆ
- é…ç½®ç’°å¢ƒè®Šé‡ï¼š`STRATEGY_MODE="hybrid"`ï¼ˆé»˜èªï¼‰

##### 2. æ·±åº¦å­¸ç¿’æ¨¡çµ„ï¼ˆå®Œæ•´å¯¦ç¾ï¼‰

**å¸‚å ´çµæ§‹è‡ªå‹•ç·¨ç¢¼å™¨** (`src/ml/market_structure_autoencoder.py`)
- ç„¡ç›£ç£å­¸ç¿’å¸‚å ´çµæ§‹
- å£“ç¸®åƒ¹æ ¼åºåˆ—åˆ°16ç¶­å‘é‡
- TensorFlow fallbackï¼šçµ±è¨ˆç‰¹å¾µ

**ç‰¹å¾µç™¼ç¾ç¶²çµ¡** (`src/ml/feature_discovery_network.py`)
- è‡ªå‹•ç™¼ç¾æœ‰æ•ˆç‰¹å¾µ
- è¼¸å‡º32ç¶­å‹•æ…‹ç‰¹å¾µå‘é‡
- TensorFlow fallbackï¼šæŠ€è¡“æŒ‡æ¨™ç‰¹å¾µ

**æµå‹•æ€§é æ¸¬æ¨¡å‹** (`src/ml/liquidity_prediction_model.py`)
- LSTMé æ¸¬æµå‹•æ€§èšé›†é»
- é æ¸¬è²·è³£æµå‹•æ€§åƒ¹æ ¼
- TensorFlow fallbackï¼šæˆäº¤é‡åˆ†å¸ƒåˆ†æ

**è‡ªé©æ‡‰ç­–ç•¥é€²åŒ–å™¨** (`src/ml/adaptive_strategy_evolver.py`)
- æ·±åº¦Qå­¸ç¿’ï¼ˆDQNï¼‰
- ç¶“é©—å›æ”¾ï¼ˆ10000æ¨£æœ¬ï¼‰
- TensorFlow fallbackï¼šç°¡å–®è¦å‰‡

##### 3. è™›æ“¬å€‰ä½å…¨ç”Ÿå‘½å‘¨æœŸç›£æ§
- å‰µå»º `src/managers/virtual_position_lifecycle.py`
- 11ç¨®ç”Ÿå‘½å‘¨æœŸäº‹ä»¶è¿½è¹¤
- ç•°æ­¥ç›£æ§æ¯å€‹å€‰ä½ï¼ˆasyncio.create_taskï¼‰
- æœ€å¤§/æœ€å°PnLè¿½è¹¤
- æ¥è¿‘æ­¢ç›ˆ/æ­¢æé è­¦ï¼ˆ80%è·é›¢ï¼‰

---

## é …ç›®çµæ§‹

```
src/
â”œâ”€â”€ strategies/                      # ç­–ç•¥æ¨¡çµ„
â”‚   â”œâ”€â”€ strategy_factory.py         # ç­–ç•¥å·¥å» 
â”‚   â”œâ”€â”€ ict_strategy.py             # ICT/SMCç­–ç•¥
â”‚   â”œâ”€â”€ self_learning_trader.py     # è‡ªæˆ‘å­¸ç¿’äº¤æ˜“å“¡
â”‚   â””â”€â”€ hybrid_strategy.py          # æ··åˆç­–ç•¥
â”‚
â”œâ”€â”€ ml/                              # æ©Ÿå™¨å­¸ç¿’æ¨¡çµ„
â”‚   â”œâ”€â”€ predictor.py                # MLé æ¸¬å™¨ï¼ˆXGBoost + ONNXï¼‰
â”‚   â”œâ”€â”€ market_structure_autoencoder.py  # å¸‚å ´çµæ§‹è‡ªå‹•ç·¨ç¢¼å™¨
â”‚   â”œâ”€â”€ feature_discovery_network.py     # ç‰¹å¾µç™¼ç¾ç¶²çµ¡
â”‚   â”œâ”€â”€ liquidity_prediction_model.py    # æµå‹•æ€§é æ¸¬æ¨¡å‹
â”‚   â”œâ”€â”€ adaptive_strategy_evolver.py     # è‡ªé©æ‡‰ç­–ç•¥é€²åŒ–å™¨
â”‚   â”œâ”€â”€ model_quantizer.py              # TensorFlow Lite é‡åŒ–å™¨
â”‚   â””â”€â”€ async_batch_predictor.py        # ç•°æ­¥æ‰¹é‡é æ¸¬å™¨
â”‚
â”œâ”€â”€ managers/                        # ç®¡ç†æ¨¡çµ„
â”‚   â”œâ”€â”€ virtual_position_manager.py     # è™›æ“¬å€‰ä½ç®¡ç†å™¨
â”‚   â”œâ”€â”€ virtual_position_lifecycle.py   # å…¨ç”Ÿå‘½å‘¨æœŸç›£æ§
â”‚   â”œâ”€â”€ risk_manager.py                 # é¢¨éšªç®¡ç†å™¨
â”‚   â””â”€â”€ smart_monitoring_scheduler.py   # æ™ºèƒ½ç›£æ§é »ç‡èª¿åº¦å™¨
â”‚
â”œâ”€â”€ core/                            # æ ¸å¿ƒæ¨¡çµ„
â”‚   â”œâ”€â”€ global_pool.py              # å…¨å±€ç·šç¨‹æ± ï¼ˆv3.16.2ï¼‰
â”‚   â”œâ”€â”€ performance_modules.py      # æ€§èƒ½æ¨¡çµ„ç®¡ç†å™¨ï¼ˆv3.16.0ï¼‰
â”‚   â”œâ”€â”€ market_regime_predictor.py  # å¸‚å ´ç‹€æ…‹é æ¸¬å™¨ï¼ˆv3.16.0ï¼‰
â”‚   â”œâ”€â”€ dynamic_feature_generator.py # å‹•æ…‹ç‰¹å¾µç”Ÿæˆå™¨ï¼ˆv3.16.0ï¼‰
â”‚   â”œâ”€â”€ liquidity_hunter.py         # æµå‹•æ€§ç‹©çµå™¨ï¼ˆv3.16.0ï¼‰
â”‚   â””â”€â”€ memory_mapped_features.py   # è¨˜æ†¶é«”æ˜ å°„ç‰¹å¾µå­˜å„²
â”‚
â”œâ”€â”€ services/                        # æœå‹™æ¨¡çµ„
â”‚   â”œâ”€â”€ data_service.py             # æ•¸æ“šæœå‹™
â”‚   â”œâ”€â”€ trading_service.py          # äº¤æ˜“æœå‹™
â”‚   â””â”€â”€ parallel_analyzer.py        # ä¸¦è¡Œåˆ†æå™¨ï¼ˆv3.16.2ï¼‰
â”‚
â”œâ”€â”€ clients/                         # å®¢æˆ¶ç«¯
â”‚   â””â”€â”€ binance_client.py           # Binanceå®¢æˆ¶ç«¯ï¼ˆåˆ†ç´šç†”æ–·å™¨ï¼‰
â”‚
â”œâ”€â”€ async_core/                      # ç•°æ­¥æ ¸å¿ƒ
â”‚   â””â”€â”€ async_main_loop.py          # é›™å¾ªç’°ç®¡ç†å™¨
â”‚
â””â”€â”€ main.py                          # ä¸»ç¨‹åºå…¥å£
```

---

## éƒ¨ç½²èªªæ˜

### ç’°å¢ƒè¦æ±‚
- Python 3.11+
- TensorFlow 2.13+ (å¯é¸ï¼Œæœ‰fallbackæ©Ÿåˆ¶)
- Railway / AWS / GCP (Binance APIè¨ªå•éœ€è¦)

### é—œéµç’°å¢ƒè®Šé‡

#### **å¿…éœ€é…ç½®**
```bash
export BINANCE_API_KEY="your_api_key"
export BINANCE_API_SECRET="your_api_secret"
export TRADING_ENABLED="false"  # è™›æ“¬æ¨¡å¼
```

#### **ç­–ç•¥é…ç½®**
```bash
export STRATEGY_MODE="hybrid"  # ict / self_learning / hybrid
export MIN_CONFIDENCE="0.35"   # æœ€ä½ä¿¡å¿ƒåº¦
```

#### **æ€§èƒ½å„ªåŒ–ï¼ˆv3.15.0ï¼‰**
```bash
export ENABLE_QUANTIZATION="true"           # TFLiteé‡åŒ–
export ENABLE_INCREMENTAL_CACHE="true"      # å¢é‡ç·©å­˜
export ENABLE_BATCH_PREDICTION="true"       # æ‰¹é‡é æ¸¬
export ENABLE_MEMORY_MAPPED_STORAGE="true"  # è¨˜æ†¶é«”æ˜ å°„
export ENABLE_SMART_MONITORING="true"       # æ™ºèƒ½ç›£æ§
```

#### **v3.16.0 é«˜ç´šåŠŸèƒ½ï¼ˆé»˜èªç¦ç”¨ï¼‰**
```bash
export ENABLE_MARKET_REGIME_PREDICTION="false"  # å¸‚å ´ç‹€æ…‹é æ¸¬
export ENABLE_DYNAMIC_FEATURES="false"           # å‹•æ…‹ç‰¹å¾µç”Ÿæˆ
export ENABLE_LIQUIDITY_HUNTING="false"          # æµå‹•æ€§ç‹©çµ
```

---

## æ–‡æª”

### æœ€æ–°æ–‡æª”
- **ç³»çµ±æ¶æ§‹ç¸½è¦½**: `SYSTEM_OVERVIEW_v3.16.2.md`ï¼ˆå®Œæ•´æ¶æ§‹åœ– + æ‰€æœ‰æ¨¡çµ„è©³è§£ï¼‰
- **ThreadPool ä¿®å¾©**: `V3.16.2_THREADPOOL_FIX_COMPLETE.md`ï¼ˆ30+ é æŠ€è¡“å ±å‘Šï¼‰
- **æ€§èƒ½å„ªåŒ–**: `ARCHITECTURE_v3.15.0.md`ï¼ˆ5å¤§æ€§èƒ½å„ªåŒ–è©³è§£ï¼‰
- **æ··åˆæ™ºèƒ½ç³»çµ±**: `ARCHITECTURE_v3.14.0.md`ï¼ˆæ·±åº¦å­¸ç¿’æ¨¡çµ„è©³è§£ï¼‰

### é…ç½®æ–‡ä»¶
- `src/config.py` - å®Œæ•´é…ç½®æ¸…å–®
- `railway.json` - Railway éƒ¨ç½²é…ç½®

---

## å·²çŸ¥å•é¡Œ

### Replitç’°å¢ƒé™åˆ¶
- âŒ Binance APIç„¡æ³•å¾Replitè¨ªå•ï¼ˆåœ°ç†ä½ç½®é™åˆ¶ HTTP 451ï¼‰
- âœ… ä»£ç¢¼å®Œå…¨æ­£å¸¸ï¼Œéœ€éƒ¨ç½²åˆ°Railway/AWS/GCPç­‰é›²å¹³å°

### TensorFlowå®‰è£
- âš ï¸ TensorFlowåœ¨Replitç’°å¢ƒå®‰è£å¤±æ•—
- âœ… æ‰€æœ‰MLæ¨¡çµ„å·²å¯¦ç¾fallbackæ©Ÿåˆ¶
- âœ… ç³»çµ±å¯åœ¨ç„¡TensorFlowç’°å¢ƒä¸‹æ­£å¸¸é‹è¡Œ

---

## ç‰ˆæœ¬æ­·å²

- **v3.16.2** (2025-10-28): ThreadPoolExecutor å¾¹åº•ä¿®å¾©ï¼ˆæ¶æ§‹ç´šåˆ¥è§£æ±ºæ–¹æ¡ˆï¼‰ğŸ”§
- **v3.16.1** (2025-10-28): BrokenProcessPool ç©©å®šæ€§ä¿®å¾©ï¼ˆå·²å»¢æ£„ï¼‰âš ï¸
- **v3.16.0** (2025-10-27): 3å¤§é«˜ç´šåŠŸèƒ½ï¼ˆé»˜èªç¦ç”¨ï¼‰ğŸ”¥
- **v3.15.0** (2025-10-27): 5å¤§æ€§èƒ½å„ªåŒ–âš¡
- **v3.14.0** (2025-10-26): æ··åˆæ™ºèƒ½ç³»çµ±ğŸ¤–
- **v3.13.0** (2025-10-25): å…¨é¢è¼•é‡åŒ–ï¼ˆ12é …å„ªåŒ–ï¼‰
- **v3.12.0** (2025-10-24): æ€§èƒ½å„ªåŒ–äº”åˆä¸€

---

**æ³¨æ„**ï¼šç³»çµ±è¨­è¨ˆç”¨æ–¼Railwayç­‰é›²å¹³å°éƒ¨ç½²ï¼ŒReplitç’°å¢ƒåƒ…ç”¨æ–¼é–‹ç™¼ã€‚

**ç•¶å‰ç‹€æ…‹**: âœ… ç”Ÿç”¢å°±ç·’  
**éƒ¨ç½²æ¨è–¦**: Railwayï¼ˆæœ€ä½³æ€§èƒ½ + ç©©å®šæ€§ï¼‰  
**æ¸¬è©¦è¦†è“‹**: LSPè¨ºæ–·é€šéï¼ˆ0å€‹éŒ¯èª¤ï¼‰  
**ä¿¡å¿ƒç­‰ç´š**: 99%+ï¼ˆv3.16.2å¾¹åº•ä¿®å¾©ï¼‰
