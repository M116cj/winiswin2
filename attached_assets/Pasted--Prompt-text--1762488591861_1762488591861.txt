完整精確的系統架構審查與代碼優化 Prompt
text
你現在是一位資深系統架構師和代碼優化專家，專門負責審查和重構大型項目。請對我的交易機器人系統進行全面的架構審查和代碼優化。

## 任務目標
對整個交易機器人系統進行深度分析，識別並移除不必要的組件，優化代碼結構，確保系統保持最高效、最整潔的狀態。

## 審查範圍
### 1. 架構層面審查
- [ ] 分析整個系統的模塊依賴關係
- [ ] 識別重複功能的組件
- [ ] 檢查不必要的抽象層
- [ ] 評估第三方依賴的必要性
- [ ] 審查配置文件的複雜度

### 2. 代碼質量審查
- [ ] 檢查重複代碼片段
- [ ] 識別未使用的變數、函數、類
- [ ] 審查過度複雜的邏輯結構
- [ ] 檢查內存泄漏風險
- [ ] 評估異常處理的完整性

### 3. 性能優化審查
- [ ] 分析數據庫查詢效率
- [ ] 檢查連接池使用情況
- [ ] 評估緩存策略有效性
- [ ] 審查循環和遞歸性能
- [ ] 檢查I/O操作優化

### 4. 資源使用審查
- [ ] 評估內存使用效率
- [ ] 檢查CPU使用模式
- [ ] 分析網絡請求優化
- [ ] 審查文件操作效率
- [ ] 評估日誌系統資源消耗

## 具體審查標準

### 必須刪除的項目
1. **未使用的代碼**
   - 從未調用的函數和方法
   - 無用的導入語句
   - 未使用的變數和常量
   - 空實現的接口

2. **重複功能**
   - 多個組件實現相同功能
   - 重複的工具函數
   - 相似的配置項

3. **過度設計**
   - 不必要的抽象層
   - 過多的設計模式應用
   - 複雜的繼承層次
   - 冗餘的封裝

4. **性能瓶頸**
   - 低效的算法實現
   - 重複的數據庫查詢
   - 未優化的循環操作
   - 阻塞式I/O操作

### 必須優化的項目
1. **代碼結構**
   - 函數單一職責原則
   - 模塊化程度
   - 接口設計清晰度
   - 錯誤處理一致性

2. **資源管理**
   - 連接池正確使用
   - 內存及時釋放
   - 文件句柄關閉
   - 緩存策略優化

3. **配置管理**
   - 環境變數統一管理
   - 配置驗證機制
   - 默認值設置合理
   - 敏感信息保護

## 審查深度要求

### 層級1：基礎清理
```python
# 示例：識別未使用的導入
# 不良範例
import os, sys, json, pickle, datetime, time, logging, asyncio  # 部分未使用
from sklearn.ensemble import RandomForestClassifier, GradientBoostingClassifier  # 只使用一個

# 優化後
import os, json, pickle, datetime, logging
from sklearn.ensemble import RandomForestClassifier
層級2：邏輯優化
python
# 示例：簡化複雜條件判斷
# 不良範例
def should_execute_trade(signal, market_condition, account_balance):
    if signal is not None:
        if signal.strength > 0.8:
            if market_condition == 'stable':
                if account_balance > 1000:
                    return True
                else:
                    return False
            else:
                return False
        else:
            return False
    else:
        return False

# 優化後
def should_execute_trade(signal, market_condition, account_balance):
    return (signal and 
            signal.strength > 0.8 and 
            market_condition == 'stable' and 
            account_balance > 1000)
層級3：架構重構
python
# 示例：合併重複的數據訪問層
# 不良範例
class TradeRepository:
    def save_trade(self, trade): ...
    def get_trade(self, id): ...

class OrderRepository:  
    def save_order(self, order): ...
    def get_order(self, id): ...

# 優化後
class TradingDataRepository:
    def save_trading_record(self, record_type, data): ...
    def get_trading_record(self, record_type, id): ...
預期交付物
1. 詳細審計報告
text
📋 系統架構審計報告
================================
🗂️  模塊分析:
   • 核心模塊: 3個 (保留)
   • 輔助模塊: 2個 (合併)
   • 未使用模塊: 1個 (刪除)

📊 代碼統計:
   • 總代碼行數: 從 1500 → 900
   • 函數數量: 從 45 → 28  
   • 類數量: 從 12 → 8
   • 導入語句: 從 35 → 18

⚡ 性能改進:
   • 數據庫查詢: 減少 40%
   • 內存使用: 降低 25%
   • 啟動時間: 縮短 30%

🔧 具體優化項目:
   1. 移除重複的配置管理類
   2. 合併相似的數據驗證邏輯
   3. 優化數據庫連接池配置
   4. 簡化錯誤處理機制
2. 優化後的完整代碼
提供重構後的完整代碼文件，包括：

精簡後的核心業務邏輯

優化的數據庫訪問層

改進的錯誤處理機制

清理後的配置文件

3. 變更說明文檔
詳細說明每個修改的原因和預期效果：

text
## 主要變更說明

### 1. 刪除未使用的ML模型緩存模塊
**原因**: 系統已使用數據庫持久化，內存緩存冗余
**影響**: 減少內存使用，簡化代碼結構

### 2. 合併交易記錄和訂單記錄服務
**原因**: 功能重疊，業務邏輯相似
**影響**: 代碼復用率提高，維護成本降低

### 3. 優化數據庫連接管理
**原因**: 原實現存在連接泄漏風險
**影響**: 系統穩定性提升，資源使用更高效
特殊要求
1. 保持向後兼容
不改變現有API接口

保持數據結構一致性

維護現有配置格式

2. 性能優先
優先考慮運行時性能

保持代碼可讀性

確保資源正確釋放

3. 測試保障
確保現有測試通過

添加必要的性能測試

驗證邊界條件處理

4. 文檔更新
更新代碼註釋

維護API文檔

更新部署指南

驗證標準
功能驗證
所有核心功能正常運行

數據庫操作正確無誤

錯誤處理機制有效

配置加載正常

性能驗證
內存使用無增長

CPU使用率合理

響應時間無退化

並發處理正常

代碼質量驗證
無編譯警告或語法錯誤

通過代碼風格檢查

測試覆蓋率不降低

文檔完整性保持

請基於以上標準，對整個交易機器人系統進行徹底的審查和優化，提供一個精簡、高效、易維護的最終版本。確保每個修改都有明確的理由和預期的改進效果。

text

這個 prompt 設計為：

1. **全面系統性** - 涵蓋架構、代碼、性能、資源等多個維度
2. **具體可操作** - 提供明確的審查標準和優化示例
3. **質量導向** - 強調代碼整潔性、性能效率和可維護性
4. **結果驅動** - 要求具體的優化指標和驗證標準
5. **風險控制** - 確保向後兼容和功能完整性