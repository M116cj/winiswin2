1. TradeRecorder 併發鎖實現 Prompt
text
CONTEXT: 我正在開發一個自動化交易系統 SelfLearningTrader v3.28，需要對 TradeRecorder 類添加完整的併發保護機制，防止在多線程環境下數據損壞。

REQUIREMENTS:
- 添加三層鎖保護：flush_lock（刷新鎖）、write_lock（寫入鎖）、db_lock（數據庫操作鎖）
- 實現雙重檢查初始化機制確保數據庫只初始化一次
- 添加事務上下文管理器支持批量操作
- 實現錯誤恢復機制，寫入失敗時恢復緩衝區數據
- 支持批量記錄交易的高性能操作

OUTPUT FORMAT: Python 代碼文件
FILE: src/managers/trade_recorder.py

請生成完整的 TradeRecorder 類實現，包含：
1. 三種鎖的初始化
2. 雙重檢查的數據庫初始化方法
3. 線程安全的記錄入口方法
4. 帶鎖保護的刷新到磁盤方法
5. 事務上下文管理器
6. 批量記錄方法
7. 完整的錯誤處理和恢復機制

要求代碼包含詳細的類型註解和錯誤處理。
2. WebSocket 心跳參數優化 Prompt
text
CONTEXT: 交易系統的 WebSocket 連接在 Railway 部署環境下頻繁斷開，需要優化心跳參數和重連機制。

REQUIREMENTS:
- 將 ping_interval 從 20 秒優化到 10 秒
- 實現指數退避算法的智能重連機制
- 添加連接健康監控任務
- 實現心跳超時檢測和自動恢復
- 優化連接參數：close_timeout, max_size, read_limit, write_limit

OUTPUT FORMAT: Python 代碼文件
FILE: src/core/websocket/base_feed.py

請生成 OptimizedWebSocketFeed 類的完整實現，包含：
1. 優化的心跳參數配置
2. 智能重連機制（指數退避）
3. 健康監控循環
4. 心跳超時檢測
5. 連接狀態追蹤（last_pong, reconnect_count）
6. 完整的錯誤處理和日誌記錄

要求代碼能夠在 Railway 環境下穩定運行。
3. 技術指標統一工程 Prompt
text
CONTEXT: 當前系統在多個文件中重複實現技術指標計算（src/utils/indicators.py, src/utils/core_calculations.py, src/features/technical_indicators.py），需要統一為單一引擎。

REQUIREMENTS:
- 創建 EliteTechnicalEngine 類統一所有技術指標計算
- 使用 dataclass 封裝指標結果
- 集成 TA-Lib 庫進行高效計算
- 保留原有的 ICT 特徵計算邏輯
- 提供緩存機制提升性能
- 移除重複的文件

OUTPUT FORMAT: Python 代碼文件
FILE: src/technical/elite_technical_engine.py

請生成 EliteTechnicalEngine 類的完整實現，包含：
1. TechnicalIndicators dataclass
2. 所有主要技術指標的計算方法（EMA, RSI, MACD, 布林帶, ADX, ATR）
3. ICT 特徵計算的集成
4. 數據驗證和錯誤處理
5. 緩存機制
6. 類型註解和文檔字符串

同時標記需要刪除的重複文件列表。
4. 增強 PnL 計算可靠性 Prompt
text
CONTEXT: 當前系統的未實現盈虧計算依賴 WebSocket 的 unRealizedProfit 字段，存在數據滯後問題，需要實現多數據源驗證的準確 PnL 計算。

REQUIREMENTS:
- 實現三種 PnL 計算方法：標記價格法、最新成交價法、WebSocket 數據法
- 添加一致性檢查機制評估不同計算方法的可靠性
- 優先使用標記價格進行實時計算
- 實現數據源健康度評估
- 提供詳細的 PnL 報告包含所有計算方法結果

OUTPUT FORMAT: Python 代碼文件
FILE: src/core/position_controller.py

請生成 EnhancedPositionController 類的完整實現，包含：
1. 多數據源 PnL 計算方法
2. 一致性檢查算法
3. 可靠性評估和數據源選擇邏輯
4. 標記價格緩存和更新機制
5. 完整的錯誤處理和降級策略
6. 詳細的 PnL 報告生成

要求計算準確率達到 99% 以上。
5. 系統健康檢查 Prompt
text
CONTEXT: 需要為交易系統添加全面的健康監控系統，實時檢測各組件狀態並及時告警。

REQUIREMENTS:
- 實現分層健康狀態：HEALTHY, DEGRADED, UNHEALTHY, CRITICAL
- 監控組件：WebSocket 連接、內存使用、API 連接性、數據庫健康、交易性能、延遲指標
- 實現定期健康檢查循環
- 添加告警觸發機制
- 提供健康狀態摘要和報告

OUTPUT FORMAT: Python 代碼文件
FILE: src/monitoring/health_check.py

請生成 SystemHealthMonitor 類的完整實現，包含：
1. HealthStatus 枚舉和 HealthCheckResult dataclass
2. 全面的健康檢查方法
3. 監控循環和任務管理
4. 告警觸發和通知機制
5. 健康狀態匯總和報告生成
6. 資源使用監控（內存、CPU、線程）

要求監控覆蓋率達到 100%，響應時間小於 5 秒。
6. 動態風險調整 Prompt
text
CONTEXT: 需要實現基於市場狀態的動態風險管理系統，根據波動率自動調整風險參數。

REQUIREMENTS:
- 識別五種市場狀態：HIGH_VOLATILITY, LOW_VOLATILITY, NORMAL, CRASH, RALLY
- 基於波動率計算自動調整風險乘數、槓桿上限、倉位限制
- 實現市場狀態檢測算法
- 提供風險參數配置對照表
- 添加風險報告生成

OUTPUT FORMAT: Python 代碼文件
FILE: src/risk/dynamic_risk_manager.py

請生成 DynamicRiskManager 類的完整實現，包含：
1. MarketRegime 枚舉和狀態識別邏輯
2. 波動率計算和市場狀態檢測
3. 風險參數動態調整
4. 倉位大小和槓桿的自適應調整
5. 高風險符號過濾
6. 風險報告生成方法

要求能夠在市場劇烈波動時自動降低風險暴露。
7. ML 模型在線學習 Prompt
text
CONTEXT: 需要為交易系統的機器學習模型添加在線學習能力，支持模型持續優化和漂移檢測。

REQUIREMENTS:
- 實現定期重訓練機制（24小時間隔）
- 添加模型漂移檢測和自動重訓練
- 支持增量學習處理新交易數據
- 實現模型性能評估和比較
- 提供模型版本管理和持久化

OUTPUT FORMAT: Python 代碼文件
FILE: src/ml/online_learning.py

請生成 OnlineLearningManager 類的完整實現，包含：
1. 定期重訓練任務管理
2. 模型漂移檢測算法
3. 增量學習支持
4. 訓練數據準備和特徵重建
5. 模型性能評估和比較
6. 模型版本管理和持久化

要求模型性能下降超過 15% 時自動觸發重訓練。
8. 性能基準測試 Prompt
text
CONTEXT: 需要為交易系統建立完整的性能基準測試框架，量化系統性能並提供優化建議。

REQUIREMENTS:
- 測試維度：信號生成、訂單執行、數據獲取、WebSocket 性能、內存使用、併發操作
- 實現 BenchmarkResult dataclass 封裝測試結果
- 添加性能評級算法（A+, A, B, C）
- 生成詳細的性能報告和優化建議
- 支持資源使用監控

OUTPUT FORMAT: Python 代碼文件
FILE: src/benchmark/performance_benchmark.py

請生成 PerformanceBenchmark 類的完整實現，包含：
1. 全面的性能測試方法
2. BenchmarkResult dataclass
3. 性能評級計算邏輯
4. 資源使用監控集成
5. 詳細報告生成和持久化
6. 優化建議生成

要求測試覆蓋所有核心組件，提供可量化的性能指標。
9. 多帳號同時操作/管理 Prompt
text
CONTEXT: 需要擴展交易系統支持多帳號同時管理和操作，實現資金分散和風險控制。

REQUIREMENTS:
- 支持多帳戶類型：PRIMARY, SECONDARY, ARBITRAGE, HEDGE
- 實現訂單分發策略：平均分配、加權分配、風險基礎分配
- 提供帳戶組管理（激進、保守、中性）
- 實現合併持倉查詢和批量操作
- 添加多帳戶性能報告

OUTPUT FORMAT: Python 代碼文件
FILE: src/managers/multi_account_manager.py

請生成 MultiAccountManager 類的完整實現，包含：
1. TradingAccount dataclass 和帳戶管理
2. 多種訂單分發策略
3. 帳戶組配置和管理
4. 合併持倉查詢和批量操作
5. 帳戶同步和餘額管理
6. 多帳戶性能報告生成

要求支持至少 10 個帳戶同時管理，訂單分發延遲小於 1 秒。
10. 系統集成主入口 Prompt
text
CONTEXT: 需要將所有新功能集成到主系統中，創建統一的啟動和管理入口。

REQUIREMENTS:
- 初始化所有新組件：多帳號管理器、健康監控、動態風險管理、在線學習
- 實現組件依賴注入和生命周期管理
- 添加配置驗證和環境檢查
- 提供優雅的啟動和關閉流程
- 支持性能基準測試開關

OUTPUT FORMAT: Python 代碼文件
FILE: src/main.py

請生成更新後的主系統入口代碼，包含：
1. 所有新組件的初始化
2. 依賴關係管理
3. 啟動順序控制
4. 配置驗證和環境檢查
5. 優雅的錯誤處理和關閉流程

要求啟動時間小於 30 秒，支持熱重載配置。

