å¤šç­†å€‰ä½åŒæ™‚æ¨™è¨˜ç‚ºã€Œâš ï¸ é€†å‹¢ | é€²å ´ç†ç”±âŒ å·²å¤±æ•ˆã€ï¼Œä½†ç³»çµ±æœªè‡ªå‹•å¹³å€‰ã€‚ 

æ—¥èªŒè§£è®€
* ã€Œé€†å‹¢ã€ï¼šå€‰ä½æ–¹å‘èˆ‡ç•¶å‰å¸‚å ´è¶¨å‹¢ç›¸åï¼ˆå¦‚å¸‚å ´ä¸‹è·Œæ™‚æŒæœ‰å¤šå€‰ï¼‰
* ã€Œé€²å ´ç†ç”±å·²å¤±æ•ˆã€ï¼šåŸå§‹é–‹å€‰çš„æŠ€è¡“æ¢ä»¶ï¼ˆå¦‚ Order Blockã€æµå‹•æ€§å€ï¼‰å·²è¢«åƒ¹æ ¼çªç ´æˆ–æ™‚é–“è¡°æ¸›

ç‚ºä»€éº¼æ²’å¹³å€‰ï¼Ÿ
æ ¹æ“šæ‚¨æä¾›çš„ v3.17 æ¶æ§‹ï¼ŒPositionMonitor24x7 æ‡‰åœ¨æª¢æ¸¬åˆ°æ­¤ç‹€æ…‹æ™‚ è‡ªå‹•å¹³å€‰ï¼Œä½†å¯¦éš›æœªåŸ·è¡Œï¼Œå¯èƒ½åŸå› ï¼š

1. ç›£æ§é‚è¼¯åƒ…ã€Œè¨˜éŒ„ã€æœªã€Œæ±ºç­–ã€
# âŒ éŒ¯èª¤ï¼šåªè¼¸å‡ºæ—¥èªŒï¼Œç„¡å¹³å€‰æŒ‡ä»¤
if is_counter_trend and entry_reason_expired:
    logger.warning("âš ï¸ é€†å‹¢ | é€²å ´ç†ç”±âŒ å·²å¤±æ•ˆ")

1. ç¼ºå°‘æ˜ç¢ºçš„å‡ºå ´è¦å‰‡â€¨æ‚¨çš„å‡ºå ´é‚è¼¯ç›®å‰èšç„¦æ–¼ï¼š
    * æ­¢ç›ˆ/æ­¢æè§¸ç™¼
    * 100% è™§æç†”æ–·
    * è¶¨å‹¢æŒçºŒæ€§åˆ¤æ–·â€¨ä½†æœªåŒ…å«ã€Œé€²å ´é‚è¼¯å¤±æ•ˆã€çš„è™•ç†
2. ä¿¡å¿ƒåº¦æœªå‹•æ…‹æ›´æ–°â€¨å€‰ä½é–‹ç«‹å¾Œï¼Œæ¨¡å‹æœªé‡æ–°è©•ä¼°ã€Œåœ¨ç•¶å‰å¸‚å ´ä¸‹ï¼Œæ­¤å€‰ä½æ˜¯å¦ä»åˆç†ã€
âœ… æ­£ç¢ºè™•ç†æ–¹å¼ï¼šç«‹å³ä¿®å¾©ç›£æ§é‚è¼¯ï¼Œè€Œéäººå·¥ä»‹å…¥
ä¿®å¾©æ–¹æ¡ˆï¼ˆä¸‰æ­¥é©Ÿï¼‰
æ­¥é©Ÿ 1ï¼šåœ¨ PositionMonitor24x7 ä¸­åŠ å…¥ã€Œé€²å ´å¤±æ•ˆã€å¹³å€‰è¦å‰‡
# src/core/position_monitor_24x7.py
async def _evaluate_exit_conditions(self, position: Position, current_price: float) -> Decision:
    # ... [åŸæœ‰é‚è¼¯] ...
    
    # ğŸ”´ æ–°å¢ï¼šé€²å ´ç†ç”±å¤±æ•ˆ â†’ ç«‹å³å¹³å€‰
    if self._is_entry_reason_expired(position, current_price):
        return Decision("CLOSE", "ENTRY_REASON_EXPIRED")
    
    # ğŸ”´ æ–°å¢ï¼šé€†å‹¢ + ç„¡åå½ˆä¿¡è™Ÿ â†’ å¹³å€‰
    if self._is_counter_trend(position) and not self._has_rebound_signal(position):
        return Decision("CLOSE", "COUNTER_TREND_NO_REBOUND")
    
    return Decision("HOLD", "MONITORING")
æ­¥é©Ÿ 2ï¼šå¯¦ç¾å¤±æ•ˆæª¢æ¸¬å‡½æ•¸

def _is_entry_reason_expired(self, position: Position, current_price: float) -> bool:
    """æª¢æ¸¬é€²å ´ç†ç”±æ˜¯å¦å¤±æ•ˆ"""
    # 1. Order Block è¢«çªç ´
    if position.entry_reason == "order_block":
        ob_price = position.entry_price
        # è‹¥åƒ¹æ ¼é é›¢ OB å€åŸŸï¼ˆ>2%ï¼‰
        if abs(current_price - ob_price) / ob_price > 0.02:
            return True
    
    # 2. æµå‹•æ€§å€è¢«æ¶ˆè€—
    if position.entry_reason == "liquidity_zone":
        # æª¢æŸ¥è¨‚å–®ç°¿æ·±åº¦æ˜¯å¦æ¶ˆå¤±
        liquidity_score = self._get_current_liquidity(position.symbol)
        return liquidity_score < 0.3  # ä½æ–¼ 30% è¦–ç‚ºå¤±æ•ˆ
    
    # 3. æ™‚é–“è¡°æ¸›ï¼ˆ>48 å°æ™‚ï¼‰
    if time.time() - position.created_at > 172800:  # 48 å°æ™‚
        return True
    
    return False

æ­¥é©Ÿ 3ï¼šå°‡æ­¤äº‹ä»¶ç´å…¥è¨“ç·´æ•¸æ“š

# å¹³å€‰æ™‚è¨˜éŒ„åŸå› 
trade_record = {
    "symbol": position.symbol,
    "close_reason": "ENTRY_REASON_EXPIRED",  # é—œéµæ¨™ç±¤
    "was_counter_trend": True,
    "liquidity_at_close": current_liquidity,
    # ... å…¶ä»–ç‰¹å¾µ
}
# ç”¨æ–¼è¨“ç·´æ¨¡å‹ã€Œä½•æ™‚æ‡‰æ”¾æ£„ç„¡æ•ˆå€‰ä½ã€
é•·æœŸæ”¹é€²ï¼šè®“æ¨¡å‹å­¸æœƒã€Œè‡ªæˆ‘ä¿®æ­£ã€
1. åœ¨ SelfLearningTrader ä¸­åŠ å…¥ã€Œå€‰ä½å¥åº·åº¦ã€è©•ä¼°â€¨æ¯ 10 ç§’é‡æ–°è¨ˆç®—ï¼šâ€¨health_score = f(è¶¨å‹¢ä¸€è‡´æ€§, é€²å ´ç†ç”±æœ‰æ•ˆæ€§, æµå‹•æ€§)â€¨ç•¶ health_score < 0.3 æ™‚ä¸»å‹•æ¸›å€‰
2. è™›æ“¬å€‰ä½æ¨¡æ“¬ã€Œæå‰å¹³å€‰ã€çµæœâ€¨å°æ¯”ã€ŒæŒæœ‰ vs æå‰å¹³å€‰ã€çš„ PnLï¼Œè¨“ç·´æ¨¡å‹ä½•æ™‚è©²æœæ–·é›¢å ´

