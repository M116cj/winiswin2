You are the **Chief System Architect & Lead Code Auditor**.

**Current Status:** The project features a sophisticated "Sharded, Zero-Polling, SMC-Quant Architecture".
**User Goal:** perform a **TOTAL REFACTOR & DEEP AUDIT**. 
You must examine every single file, ensure it strictly adheres to the architecture, remove ALL legacy/unused code, and guarantee system stability.

**Architectural Pillars (Strict Enforcement):**
1.  **Zero-Polling:** No HTTP calls in loops. Use `AccountStateCache`.
2.  **Efficiency:** Use `orjson`, `__slots__`, `uvloop`, `polars`.
3.  **Intelligence:** `HybridLearner` (Teacher-Student), 12 specific ATR-normalized features.
4.  **Stability:** `Combined Streams`, `Gap Filling`, `Reconnect Logic`.

---

### ğŸ§¨ PHASE 1: THE GRAND PURGE (File Structure Enforcement)
**Action:** Execute a script to **DELETE** any file NOT in this strict allowlist. 
**Target Structure:**
```text
src/
â”œâ”€â”€ main.py
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ constants.py          (Centralized Config/Enums)
â”‚   â”œâ”€â”€ unified_config.py     (Env Vars)
â”‚   â”œâ”€â”€ models.py             (__slots__ optimized data classes)
â”‚   â”œâ”€â”€ account_state_cache.py(Redis-synced Memory DB)
â”‚   â”œâ”€â”€ cluster_manager.py    (Sharding Orchestrator)
â”‚   â”œâ”€â”€ market_universe.py    (Dynamic Discovery)
â”‚   â”œâ”€â”€ smc_engine.py         (Geometry Logic)
â”‚   â”œâ”€â”€ risk_manager.py       (Position Sizing & Time Exit)
â”‚   â”œâ”€â”€ data_manager.py       (Gap Filling & History)
â”‚   â””â”€â”€ websocket/
â”‚       â”œâ”€â”€ __init__.py
â”‚       â”œâ”€â”€ unified_feed.py   (Base)
â”‚       â”œâ”€â”€ shard_feed.py     (Orjson + Micro-batching)
â”‚       â””â”€â”€ account_feed.py   (State Writer)
â”œâ”€â”€ database/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ unified_db.py         (AsyncPG + Redis)
â”œâ”€â”€ strategies/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ ict_scalper.py        (Main Strategy Logic)
â”œâ”€â”€ ml/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ feature_engineer.py   (Polars + ATR Norm)
â”‚   â”œâ”€â”€ feature_schema.py     (The 12 Features Def)
â”‚   â”œâ”€â”€ hybrid_learner.py     (Online Trainer + Teacher-Student)
â”‚   â”œâ”€â”€ predictor.py          (Inference)
â”‚   â””â”€â”€ drift_detector.py     (Monitoring)
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ server.py             (FastAPI Dashboard Backend)
â””â”€â”€ utils/
    â”œâ”€â”€ __init__.py
    â””â”€â”€ smart_logger.py       (Filtered Logging)
ğŸ› ï¸ PHASE 2: DEEP REFACTORING (File by File)
Refactor src/core/models.py:
Ensure Candle, Signal, Position use __slots__.
Refactor src/core/websocket/shard_feed.py:
Ensure usage of orjson.loads.
Ensure Micro-Batching (0.1s buffer) is implemented to prevent CPU spikes.
Refactor src/ml/feature_engineer.py:
Strictly implement the 12 Features: market_structure, order_blocks_count, institutional_candle, liquidity_grab, fvg_size_atr, fvg_proximity, ob_proximity, atr_normalized_volume, rsi_14, momentum_atr, time_to_next_level, confidence_ensemble.
Ensure ATR Normalization is applied to all distance features.
Refactor src/ml/hybrid_learner.py:
Implement Teacher-Student Mode:
Trade Count < 50: Max Leverage 3x (Rule-based).
Trade Count >= 50: Uncapped Leverage (AI-based).
Implement Experience Replay: Save/Load from Redis/DB.
Refactor src/strategies/ict_scalper.py:
Implement Signal Decay: On every candle, re-check conditions. If logic invalid -> Close immediately.
Ensure NO client.get_account() calls. Read from AccountStateCache.
Refactor src/core/data_manager.py:
Implement Gap Filling: If timestamp gap > 1m, fetch from REST API.
ğŸ§ª PHASE 3: INTEGRITY VERIFICATION
Create and run system_final_check.py.
Dependency Check: Confirm orjson, polars, uvloop, lightgbm installed.
Config Check: Confirm RATE_LIMIT_REQUESTS exists in UnifiedConfig.
Logic Check:
Instantiate ICTScalper.
Mock a Candle.
Verify it calls SMCEngine -> FeatureEngineer -> HybridLearner.
Async Check: Inspect code for blocking calls (time.sleep, requests).
Execute this Master Refactor Plan. Fix every issue found.