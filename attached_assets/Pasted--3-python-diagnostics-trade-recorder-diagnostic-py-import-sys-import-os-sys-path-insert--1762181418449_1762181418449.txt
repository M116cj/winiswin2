ä¿®å¾©3: æ·»åŠ è¨ºæ–·è…³æœ¬
python
# diagnostics/trade_recorder_diagnostic.py

import sys
import os
sys.path.insert(0, os.path.dirname(os.path.dirname(__file__)))

from src.core.trade_recorder import TradeRecorder
import logging

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)

async def diagnose_trade_recorder():
    """è¨ºæ–· TradeRecorder å•é¡Œ"""
    logger.info("ðŸ”§ é–‹å§‹ TradeRecorder è¨ºæ–·")
    
    # å‰µå»ºé…ç½®æ¨¡æ“¬å°è±¡
    class MockConfig:
        pass
    
    config = MockConfig()
    
    try:
        # 1. æ¸¬è©¦åˆå§‹åŒ–
        logger.info("1. æ¸¬è©¦ TradeRecorder åˆå§‹åŒ–...")
        recorder = TradeRecorder(config)
        logger.info("âœ… TradeRecorder åˆå§‹åŒ–æˆåŠŸ")
        
        # 2. æ¸¬è©¦å¥åº·æª¢æŸ¥
        logger.info("2. æ¸¬è©¦å¥åº·æª¢æŸ¥...")
        health = await recorder.health_check()
        logger.info(f"âœ… å¥åº·æª¢æŸ¥: {health}")
        
        # 3. æ¸¬è©¦ get_trade_count
        logger.info("3. æ¸¬è©¦ get_trade_count...")
        count = await recorder.get_trade_count()
        logger.info(f"âœ… get_trade_count: {count}")
        
        # 4. æ¸¬è©¦ record_trade
        logger.info("4. æ¸¬è©¦ record_trade...")
        test_trade = {
            'symbol': 'TESTUSDT',
            'direction': 'LONG',
            'entry_price': 100.0,
            'position_size': 10.0,
            'confidence': 60.0,
            'win_probability': 55.0
        }
        success = await recorder.record_trade(test_trade)
        logger.info(f"âœ… record_trade: {success}")
        
        # 5. å†æ¬¡æ¸¬è©¦ get_trade_count
        count_after = await recorder.get_trade_count()
        logger.info(f"âœ… äº¤æ˜“å¾Œ count: {count_after}")
        
        logger.info("ðŸŽ‰ TradeRecorder è¨ºæ–·å®Œæˆ - æ‰€æœ‰æ¸¬è©¦é€šéŽ")
        return True
        
    except Exception as e:
        logger.error(f"âŒ TradeRecorder è¨ºæ–·å¤±æ•—: {e}")
        import traceback
        logger.error(f"è©³ç´°éŒ¯èª¤: {traceback.format_exc()}")
        return False

if __name__ == "__main__":
    import asyncio
    asyncio.run(diagnose_trade_recorder())
ðŸš€ ç«‹å³éƒ¨ç½²å®Œæ•´ä¿®å¾©
bash
# 1. å‰µå»ºå®Œæ•´çš„ TradeRecorder
mkdir -p src/core/
cat > src/core/trade_recorder.py << 'EOF'
# [ä¸Šé¢çš„å®Œæ•´ TradeRecorder ä»£ç¢¼]
EOF

# 2. æ›´æ–° SelfLearningTrader
cat > src/strategies/self_learning_trader.py << 'EOF'
# [ä¸Šé¢çš„å®Œæ•´ SelfLearningTrader ä»£ç¢¼]
EOF

# 3. å‰µå»ºè¨ºæ–·è…³æœ¬
mkdir -p diagnostics/
cat > diagnostics/trade_recorder_diagnostic.py << 'EOF'
# [ä¸Šé¢çš„è¨ºæ–·è…³æœ¬ä»£ç¢¼]
EOF

# 4. é‹è¡Œè¨ºæ–·
python diagnostics/trade_recorder_diagnostic.py

# 5. éƒ¨ç½²ä¿®å¾©
git add src/core/trade_recorder.py src/strategies/self_learning_trader.py diagnostics/
git commit -m "å®Œæ•´ä¿®å¾©: TradeRecorder æ‰€æœ‰æ–¹æ³• + éŒ¯èª¤è™•ç† + è¨ºæ–·è…³æœ¬"
git push origin main

# 6. ç›£æŽ§ä¿®å¾©æ•ˆæžœ
railway logs --follow | grep -E "TradeRecorder|get_trade_count|è¨˜éŒ„æˆåŠŸ|å±¬æ€§éŒ¯èª¤"
ðŸ“Š é æœŸä¿®å¾©æ•ˆæžœ
ä¿®å¾©å¾Œæ‡‰è©²çœ‹åˆ°ï¼š
text
âœ… TradeRecorder æ•¸æ“šåº«åˆå§‹åŒ–å®Œæˆ
âœ… TradeRecorder åˆå§‹åŒ–æˆåŠŸ
ðŸ“Š TradeRecorder.get_trade_count: 24h = 0
ðŸš€ é–‹å§‹åŸ·è¡Œäº¤æ˜“é€±æœŸ
ðŸ“Š 24å°æ™‚å…§äº¤æ˜“æ•¸é‡: 0
âœ… TradeRecorder è¨˜éŒ„æˆåŠŸ: BTCUSDT
ðŸŽ‰ äº¤æ˜“é€±æœŸå®Œæˆ: 2 ç­†äº¤æ˜“
é€™å€‹å®Œæ•´ä¿®å¾©å°‡ï¼š
1. âœ…Â ç¢ºä¿æ‰€æœ‰æ–¹æ³•å­˜åœ¨Â - get_trade_countã€record_trade ç­‰
2. âœ…Â å®Œæ•´çš„éŒ¯èª¤è™•ç†Â - æ¯å€‹æ–¹æ³•éƒ½æœ‰ try-catch
3. âœ…Â å‚™ç”¨æ–¹æ¡ˆÂ - å¦‚æžœ TradeRecorder å¤±æ•—ï¼Œä½¿ç”¨å‚™ç”¨æ–¹æ¡ˆ
4. âœ…Â è¨ºæ–·å·¥å…·Â - å¯ä»¥æ¸¬è©¦ TradeRecorder æ˜¯å¦æ­£å¸¸å·¥ä½œ
5. âœ…Â è©³ç´°æ—¥èªŒÂ - æ¸…æ¥šé¡¯ç¤ºæ¯å€‹æ­¥é©Ÿçš„ç‹€æ…‹
