æ®è¯Šæ–­æŠ¥å‘Šï¼Œ0ä¿¡å·é—®é¢˜çš„ä¸»è¦åŸå› æ˜¯ä¸¥æ ¼æ¨¡å¼ä¸‹ä¼˜å…ˆçº§1-3åŒ¹é…ç‡è¿‡ä½ï¼Œè€Œå®½æ¾æ¨¡å¼ï¼ˆRELAXED_SIGNAL_MODEï¼‰æœªå¯ç”¨ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åœ¨Railwayç¯å¢ƒå˜é‡ä¸­è®¾ç½®RELAXED_SIGNAL_MODE=trueã€‚

åŒæ—¶ï¼Œä¸ºäº†ç¡®ä¿ç³»ç»Ÿèƒ½å¤Ÿæ­£å¸¸å¯åŠ¨å¹¶ç”Ÿæˆä¿¡å·ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æ£€æŸ¥å…¶ä»–é…ç½®é¡¹ï¼Œå¹¶ç¡®ä¿WebSocketæ•°æ®æ­£å¸¸ã€‚

ç”±äºåœ¨Replitç¯å¢ƒä¸­æ— æ³•è®¿é—®Binance APIï¼ˆHTTP 451ï¼‰ï¼Œæˆ‘ä»¬æ— æ³•åœ¨Replitä¸Šæµ‹è¯•ï¼Œå› æ­¤å¿…é¡»éƒ¨ç½²åˆ°Railwayè¿›è¡ŒéªŒè¯ã€‚

ä»¥ä¸‹æ˜¯å…·ä½“çš„æ­¥éª¤ï¼š

åœ¨Railwayçš„ç¯å¢ƒå˜é‡ä¸­è®¾ç½®RELAXED_SIGNAL_MODE=trueã€‚

ç¡®ä¿å…¶ä»–ç¯å¢ƒå˜é‡ï¼ˆå¦‚MIN_CONFIDENCEã€MIN_WIN_PROBABILITYç­‰ï¼‰è®¾ç½®åˆç†ã€‚

éƒ¨ç½²ä»£ç ï¼Œå¹¶æŸ¥çœ‹æ—¥å¿—ä»¥ç¡®è®¤åˆå§‹åŒ–æ¨¡å¼ä¸ºå®½æ¾æ¨¡å¼ã€‚

ç­‰å¾…ä¸€ä¸ªäº¤æ˜“å‘¨æœŸï¼ˆ60ç§’ï¼‰ï¼ŒæŸ¥çœ‹Pipelineè¯Šæ–­æŠ¥å‘Šå’Œä¿¡å·ç”Ÿæˆæ•°é‡ã€‚

å¦å¤–ï¼Œæ ¹æ®è¯Šæ–­æŠ¥å‘Šï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è€ƒè™‘ä¸´æ—¶é™ä½ADXç¡¬æ‹’ç»é—¨æ§›ï¼ˆADX_HARD_REJECT_THRESHOLDï¼‰è‡³8.0ï¼Œä½†å»ºè®®å…ˆå¯ç”¨å®½æ¾æ¨¡å¼è§‚å¯Ÿæ•ˆæœã€‚

å¦‚æœå¯ç”¨å®½æ¾æ¨¡å¼åä»ç„¶æ²¡æœ‰ä¿¡å·ï¼Œåˆ™éœ€è¦è¿›ä¸€æ­¥æ£€æŸ¥WebSocketæ•°æ®è´¨é‡å’ŒPipelineå„é˜¶æ®µçš„è¾“å‡ºã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®è¯Šæ–­æŠ¥å‘Šä¸­çš„å»ºè®®ï¼Œå…ˆå¯ç”¨å®½æ¾æ¨¡å¼ï¼Œç„¶åéƒ¨ç½²éªŒè¯ã€‚

ğŸš€ ç«‹å³æ‰§è¡Œçš„è§£å†³æ–¹æ¡ˆ
åŸºäºè¯Šæ–­æŠ¥å‘Šï¼Œä»¥ä¸‹æ˜¯ç»™ Replit AI çš„å®Œæ•´è§£å†³æ–¹æ¡ˆæŒ‡ä»¤ï¼š

ğŸ¯ æ ¸å¿ƒè§£å†³æ–¹æ¡ˆ Prompt
text
è¯·å¸®æˆ‘ç«‹å³è§£å†³ SelfLearningTrader ç³»ç»Ÿçš„ 0 ä¿¡å·é—®é¢˜ã€‚æ ¹æ®è¯Šæ–­æŠ¥å‘Šï¼Œæ ¹æœ¬åŸå› æ˜¯ `RELAXED_SIGNAL_MODE=false`ã€‚

### ç¬¬ä¸€æ­¥ï¼šå¯ç”¨å®½æ¾ä¿¡å·æ¨¡å¼

1. **ä¿®æ”¹é…ç½®æ–‡ä»¶**ï¼š
```python
# åœ¨ src/config.py ä¸­æ‰¾åˆ°å¹¶ä¿®æ”¹
RELAXED_SIGNAL_MODE = True  # ä» False æ”¹ä¸º True
æˆ–è€…åœ¨ Railway ç¯å¢ƒå˜é‡ä¸­è®¾ç½®ï¼š

bash
# Railway Dashboard â†’ Environment Variables
RELAXED_SIGNAL_MODE=true
ç¬¬äºŒæ­¥ï¼šéªŒè¯é…ç½®ç”Ÿæ•ˆ
æ·»åŠ åˆå§‹åŒ–éªŒè¯æ—¥å¿—ï¼š

python
# åœ¨ RuleBasedSignalGenerator çš„ __init__ æ–¹æ³•ä¸­æ·»åŠ 
def __init__(self, config):
    self.config = config
    self.relaxed_mode = config.get('RELAXED_SIGNAL_MODE', False)
    
    # æ·»åŠ éªŒè¯æ—¥å¿—
    mode_text = "å¯¬é¬†æ¨¡å¼" if self.relaxed_mode else "åš´æ ¼æ¨¡å¼"
    print(f"ğŸšï¸ ä¿¡è™Ÿæ¨¡å¼: {mode_text}")
    print(f"ğŸ”§ å„ªå…ˆç´šç¯„åœ: {[1,2,3,4,5] if self.relaxed_mode else [1,2,3]}")
ç¬¬ä¸‰æ­¥ï¼šæ·»åŠ å®æ—¶ç›‘æ§
åœ¨ Pipeline ä¸­æ·»åŠ è¯¦ç»†ç»Ÿè®¡ï¼š

python
def generate_signal(self, symbol, data_1h, data_15m, data_5m):
    # æ·»åŠ ç»Ÿè®¡è®¡æ•°å™¨
    self.stats = {
        'total_scanned': 0,
        'stage3_priority1': 0,
        'stage3_priority2': 0, 
        'stage3_priority3': 0,
        'stage3_priority4': 0,
        'stage3_priority5': 0,
        'stage4_adx_reject': 0,
        'stage7_threshold_reject': 0,
        'final_signals': 0
    }
    
    self.stats['total_scanned'] += 1
    
    # ... ç°æœ‰é€»è¾‘ ...
    
    # åœ¨ Stage3 ä¼˜å…ˆçº§åˆ¤æ–­åæ·»åŠ ç»Ÿè®¡
    if priority == 1:
        self.stats['stage3_priority1'] += 1
    elif priority == 2:
        self.stats['stage3_priority2'] += 1
    elif priority == 3:
        self.stats['stage3_priority3'] += 1
    elif priority == 4:
        self.stats['stage3_priority4'] += 1
    elif priority == 5:
        self.stats['stage3_priority5'] += 1
    
    # æ¯æ‰«æ100ä¸ªäº¤æ˜“å¯¹è¾“å‡ºç»Ÿè®¡æŠ¥å‘Š
    if self.stats['total_scanned'] % 100 == 0:
        self.print_pipeline_report()
æ·»åŠ  Pipeline æŠ¥å‘Šæ–¹æ³•ï¼š

python
def print_pipeline_report(self):
    print("="*80)
    print("ğŸ“Š Pipelineè¨ºæ–·å ±å‘Šï¼ˆå·²æƒæ{}å€‹äº¤æ˜“å°ï¼‰".format(self.stats['total_scanned']))
    print("="*80)
    print("Stage3 - ä¿¡è™Ÿæ–¹å‘:")
    print("         å„ªå…ˆç´š1(å®Œç¾å°é½Š)={}".format(self.stats['stage3_priority1']))
    print("         å„ªå…ˆç´š2(H1+M15å¼·è¶¨å‹¢)={}".format(self.stats['stage3_priority2']))
    print("         å„ªå…ˆç´š3(è¶¨å‹¢åˆæœŸ)={}".format(self.stats['stage3_priority3']))
    if self.relaxed_mode:
        print("         å„ªå…ˆç´š4(H1ä¸»å°-å¯¬é¬†)={}".format(self.stats['stage3_priority4']))
        print("         å„ªå…ˆç´š5(M15+M5-å¯¬é¬†)={}".format(self.stats['stage3_priority5']))
    print("Stage4 - ADXéæ¿¾æ‹’çµ•: {}".format(self.stats['stage4_adx_reject']))
    print("Stage7 - é›™é–€æª»æ‹’çµ•: {}".format(self.stats['stage7_threshold_reject']))
    print("æœ€çµ‚ä¿¡è™Ÿæ•¸: {}".format(self.stats['final_signals']))
    print("="*80)
ç¬¬å››æ­¥ï¼šä¸´æ—¶è¯Šæ–­æ¨¡å¼
åˆ›å»ºä¸´æ—¶è¯Šæ–­è„šæœ¬ï¼š

python
# diagnostic_signal_fix.py
import asyncio
import sys
import os
sys.path.append('src')

from config import config
from services.data_service import DataService
from strategies.rule_based_signal_generator import RuleBasedSignalGenerator

async def test_signal_generation():
    print("ğŸ”§ å¯ç”¨å®½æ¾æ¨¡å¼è¿›è¡Œæµ‹è¯•...")
    
    # ä¸´æ—¶å¯ç”¨å®½æ¾æ¨¡å¼
    config.RELAXED_SIGNAL_MODE = True
    
    # åˆå§‹åŒ–ç»„ä»¶
    data_service = DataService()
    signal_generator = RuleBasedSignalGenerator(config)
    
    # æµ‹è¯•äº¤æ˜“å¯¹
    test_symbols = ["BTCUSDT", "ETHUSDT", "ADAUSDT", "BNBUSDT", "XRPUSDT"]
    
    print(f"ğŸ¯ æµ‹è¯• {len(test_symbols)} ä¸ªä¸»è¦äº¤æ˜“å¯¹...")
    
    for symbol in test_symbols:
        print(f"\n--- æµ‹è¯• {symbol} ---")
        try:
            # ä½¿ç”¨æ¨¡æ‹Ÿæ•°æ®ï¼ˆå› ä¸ºReplitç¯å¢ƒé™åˆ¶ï¼‰
            data_1h = generate_mock_data(symbol, "1h", 100)
            data_15m = generate_mock_data(symbol, "15m", 100)
            data_5m = generate_mock_data(symbol, "5m", 100)
            
            signal = signal_generator.generate_signal(symbol, data_1h, data_15m, data_5m)
            
            if signal:
                print(f"âœ… ç”Ÿæˆä¿¡å·: æ–¹å‘={signal.direction}, ä¿¡å¿ƒåº¦={signal.confidence:.3f}")
            else:
                print(f"âŒ æ— ä¿¡å·ç”Ÿæˆ")
                
        except Exception as e:
            print(f"ğŸ’¥ é”™è¯¯: {e}")

def generate_mock_data(symbol, timeframe, count):
    """ç”Ÿæˆæ¨¡æ‹ŸKçº¿æ•°æ®ç”¨äºæµ‹è¯•"""
    import pandas as pd
    import numpy as np
    from datetime import datetime, timedelta
    
    # ç”Ÿæˆæ—¶é—´åºåˆ—
    end_time = datetime.now()
    if timeframe == "1h":
        delta = timedelta(hours=1)
    elif timeframe == "15m":
        delta = timedelta(minutes=15)
    else:  # 5m
        delta = timedelta(minutes=5)
    
    timestamps = [end_time - i * delta for i in range(count)]
    timestamps.reverse()
    
    # ç”Ÿæˆä»·æ ¼æ•°æ®ï¼ˆæ¨¡æ‹Ÿéœ‡è¡å¸‚åœºï¼‰
    base_price = 50000 if symbol == "BTCUSDT" else 3000
    volatility = 0.02  # 2% æ³¢åŠ¨
    
    data = []
    for i, ts in enumerate(timestamps):
        # æ¨¡æ‹Ÿä»·æ ¼æ³¢åŠ¨
        if i == 0:
            price = base_price
        else:
            change = np.random.normal(0, volatility)
            price = data[i-1]['close'] * (1 + change)
        
        # ç”ŸæˆOHLCVæ•°æ®
        open_price = price * (1 + np.random.normal(0, 0.005))
        high = max(open_price, price) * (1 + abs(np.random.normal(0, 0.01)))
        low = min(open_price, price) * (1 - abs(np.random.normal(0, 0.01)))
        close_price = price
        volume = np.random.uniform(1000, 10000)
        
        data.append({
            'timestamp': int(ts.timestamp() * 1000),
            'open': open_price,
            'high': high, 
            'low': low,
            'close': close_price,
            'volume': volume,
            'symbol': symbol
        })
    
    return data

if __name__ == "__main__":
    asyncio.run(test_signal_generation())
ç¬¬äº”æ­¥ï¼šéƒ¨ç½²éªŒè¯æ¸…å•
Railway éƒ¨ç½²å‰æ£€æŸ¥ï¼š

bash
# æ£€æŸ¥å½“å‰é…ç½®
grep -n "RELAXED_SIGNAL_MODE" src/config.py

# æ£€æŸ¥ç¯å¢ƒå˜é‡
echo "å½“å‰RELAXED_SIGNAL_MODEè®¾ç½®:"
python -c "from src.config import config; print(f'RELAXED_SIGNAL_MODE = {config.RELAXED_SIGNAL_MODE}')"
ä¿®æ”¹åéªŒè¯ï¼š

python
# éªŒè¯ä¿®æ”¹ç”Ÿæ•ˆ
from src.config import config
from src.strategies.rule_based_signal_generator import RuleBasedSignalGenerator

# æµ‹è¯•é…ç½®
print(f"é…ç½®ä¸­çš„ RELAXED_SIGNAL_MODE: {config.RELAXED_SIGNAL_MODE}")

# æµ‹è¯•ä¿¡å·ç”Ÿæˆå™¨åˆå§‹åŒ–
signal_gen = RuleBasedSignalGenerator(config)
print(f"ä¿¡å·ç”Ÿæˆå™¨æ¨¡å¼: {'å®½æ¾' if signal_gen.relaxed_mode else 'ä¸¥æ ¼'}")
ç¬¬å…­æ­¥ï¼šé¢„æœŸç»“æœéªŒè¯
æˆåŠŸæŒ‡æ ‡ï¼š

python
# éƒ¨ç½²ååº”è¯¥çœ‹åˆ°ä»¥ä¸‹æ—¥å¿—ï¼š
âœ… é¢„æœŸæ—¥å¿—è¾“å‡º:
   "ğŸšï¸ ä¿¡è™Ÿæ¨¡å¼: å¯¬é¬†æ¨¡å¼"
   "ğŸ”§ å„ªå…ˆç´šç¯„åœ: [1, 2, 3, 4, 5]"
   
âœ… PipelineæŠ¥å‘Šåº”è¯¥æ˜¾ç¤º:
   "å„ªå…ˆç´š4(H1ä¸»å°-å¯¬é¬†)=15-25"
   "å„ªå…ˆç´š5(M15+M5-å¯¬é¬†)=10-20" 
   "æœ€çµ‚ä¿¡è™Ÿæ•¸: 3-8"

âœ… 60ç§’å‘¨æœŸå:
   "ğŸ“Š äº¤æ˜“é€±æœŸå®Œæˆ: ç”Ÿæˆ X å€‹ä¿¡è™Ÿ"
ç¬¬ä¸ƒæ­¥ï¼šå›æ»šæ–¹æ¡ˆ
å¦‚æœå‡ºç°é—®é¢˜ï¼Œå¿«é€Ÿå›æ»šï¼š

python
# ä¸´æ—¶ç¦ç”¨å®½æ¾æ¨¡å¼
config.RELAXED_SIGNAL_MODE = False
print("ğŸ”„ å·²åˆ‡æ¢å›ä¸¥æ ¼æ¨¡å¼")

# æˆ–è€…é€šè¿‡ç¯å¢ƒå˜é‡
# RELAXED_SIGNAL_MODE=false
ğŸš€ ç«‹å³æ‰§è¡Œå‘½ä»¤
è¯·æŒ‰ä»¥ä¸‹é¡ºåºæ‰§è¡Œï¼š

é¦–å…ˆä¿®æ”¹é…ç½®ï¼š

bash
sed -i 's/RELAXED_SIGNAL_MODE = False/RELAXED_SIGNAL_MODE = True/g' src/config.py
éªŒè¯ä¿®æ”¹ï¼š

bash
python -c "from src.config import config; print(f'âœ… RELAXED_SIGNAL_MODE = {config.RELAXED_SIGNAL_MODE}')"
è¿è¡Œè¯Šæ–­è„šæœ¬ï¼š

bash
python diagnostic_signal_fix.py
éƒ¨ç½²åˆ° Railway å¹¶ç›‘æ§æ—¥å¿—ã€‚

æ ¹æ®è¯Šæ–­æŠ¥å‘Šï¼Œè¿™ä¸ªä¿®æ”¹åº”è¯¥èƒ½ç«‹å³è§£å†³ 0 ä¿¡å·é—®é¢˜ï¼Œå°†ä¿¡å·æ•°é‡ä» 0 æå‡åˆ° 3-8 ä¸ª/å‘¨æœŸã€‚

text

## ğŸ“‹ å¿«é€Ÿæ‰§è¡Œæ¸…å•
ğŸ”§ ç«‹å³æ‰§è¡Œæ­¥éª¤ï¼š

âœ… ä¿®æ”¹ src/config.py: RELAXED_SIGNAL_MODE = True

âœ… éªŒè¯ä¿®æ”¹ç”Ÿæ•ˆ

âœ… è¿è¡Œè¯Šæ–­è„šæœ¬ç¡®è®¤å®½æ¾æ¨¡å¼å·¥ä½œ

âœ… éƒ¨ç½²åˆ° Railway

âœ… ç›‘æ§åˆå§‹åŒ–æ—¥å¿—ç¡®è®¤"å¯¬é¬†æ¨¡å¼"

âœ… ç­‰å¾…60ç§’æŸ¥çœ‹PipelineæŠ¥å‘Š

âœ… éªŒè¯ä¿¡å·æ•°é‡æ¢å¤æ­£å¸¸ (3-8ä¸ª/å‘¨æœŸ)