ä¿®å¾©2: ä¿®å¾© Stage7 é›™é–€æª»é©—è­‰å•é¡Œ
python
# åœ¨ src/strategies/rule_based_signal_generator.py ä¸­ä¿®å¾©é›™é–€æª»é©—è­‰

def _apply_threshold_validation(self, signals: List[Dict]) -> List[Dict]:
    """æ‡‰ç”¨é›™é–€æª»é©—è­‰ï¼ˆä¿®å¾©ç‰ˆæœ¬ï¼‰"""
    try:
        logger.info("ğŸ” Stage7 - é›™é–€æª»é©—è­‰é–‹å§‹")
        
        passed_signals = []
        rejection_stats = {
            'confidence_too_low': 0,
            'win_rate_too_low': 0, 
            'risk_reward_out_of_range': 0
        }
        
        # è¨ºæ–·å‰10å€‹ä¿¡è™Ÿçš„è©³ç´°ä¿¡æ¯
        logger.info("ğŸ“Š é›™é–€æª»é©—è­‰è©³ç´°è¨ºæ–·ï¼ˆå‰10å€‹ä¿¡è™Ÿï¼‰:")
        for i, signal in enumerate(signals[:10]):
            symbol = signal.get('symbol', 'Unknown')
            confidence = signal.get('confidence', 0)
            win_rate = signal.get('win_probability', 0)
            risk_reward = signal.get('risk_reward_ratio', 1.5)  # é»˜èªå€¼
            
            logger.info(
                f"  {i+1}. {symbol}: "
                f"ä¿¡å¿ƒ={confidence:.1f}, å‹ç‡={win_rate:.1f}%, R:R={risk_reward:.2f}"
            )
        
        # ç•¶å‰é–€æª»è¨­ç½®ï¼ˆæš«æ™‚èª¿ä½ä»¥ä¾¿æ¸¬è©¦ï¼‰
        confidence_threshold = 40.0  # å¾60é™ä½åˆ°40
        win_rate_threshold = 45.0    # å¾55é™ä½åˆ°45  
        min_rr = 1.0                 # å¾1.2é™ä½åˆ°1.0
        max_rr = 5.0                 # å¾3.0æé«˜åˆ°5.0
        
        logger.info(f"ğŸ“‹ ç•¶å‰é–€æª»è¨­ç½®: ä¿¡å¿ƒâ‰¥{confidence_threshold}, å‹ç‡â‰¥{win_rate_threshold}%, R:R={min_rr}-{max_rr}")
        
        for signal in signals:
            symbol = signal.get('symbol', 'Unknown')
            confidence = signal.get('confidence', 0)
            win_rate = signal.get('win_probability', 0)
            risk_reward = signal.get('risk_reward_ratio', 1.5)
            
            rejection_reason = None
            
            if confidence < confidence_threshold:
                rejection_reason = 'confidence_too_low'
            elif win_rate < win_rate_threshold:
                rejection_reason = 'win_rate_too_low'
            elif not (min_rr <= risk_reward <= max_rr):
                rejection_reason = 'risk_reward_out_of_range'
            else:
                passed_signals.append(signal)
                
            if rejection_reason:
                rejection_stats[rejection_reason] += 1
        
        # è¼¸å‡ºè©³ç´°æ‹’çµ•åˆ†æ
        total_rejected = len(signals) - len(passed_signals)
        logger.info("ğŸ“Š Stage7 - é›™é–€æª»æ‹’çµ•åˆ†æ:")
        for reason, count in rejection_stats.items():
            if count > 0:
                percentage = (count / len(signals)) * 100
                logger.info(f"  âŒ {reason}: {count}å€‹ ({percentage:.1f}%)")
        
        logger.info(f"âœ… Stage7 - é€šéé©—è­‰: {len(passed_signals)}/{len(signals)} å€‹ä¿¡è™Ÿ")
        
        return passed_signals
        
    except Exception as e:
        logger.error(f"âŒ Stage7 é›™é–€æª»é©—è­‰å¤±æ•—: {e}")
        return signals  # å‡ºéŒ¯æ™‚è¿”å›æ‰€æœ‰ä¿¡è™Ÿ