ç³»ç»Ÿåœ¨å¿«é€Ÿè·³è¿‡ï¼Œå¹³å‡åˆ†ææ—¶é—´0.0msï¼Œè¯´æ˜ç‰¹å¾è®¡ç®—å¤±è´¥å¯¼è‡´ä¿¡å·ç”Ÿæˆè¢«æ—©æœŸè¿”å›ã€‚ç°åœ¨æ•°æ®åº“å·²ç»æ¶è®¾å¥½ï¼Œéœ€è¦ä¿®å¤ç‰¹å¾è®¡ç®—åŠŸèƒ½ã€‚

ğŸ” é—®é¢˜è¯Šæ–­
ä»æ—¥å¿—åˆ†æï¼š

âœ… æ•°æ®è·å–æ­£å¸¸ï¼ˆ4.0msï¼‰

âŒ åˆ†ææ—¶é—´0.0ms â†’ ç‰¹å¾è®¡ç®—å¤±è´¥

âŒ ä¿¡å·ç”Ÿæˆè¢«å¿«é€Ÿè·³è¿‡

ğŸš€ ç«‹å³ä¿®å¤æ–¹æ¡ˆ
ä¿®å¤1: æ·»åŠ ç‰¹å¾è®¡ç®—è¯Šæ–­
åœ¨ rule_based_signal_generator.py çš„ generate_signal æ–¹æ³•ä¸­æ·»åŠ ç‰¹å¾è®¡ç®—è¯Šæ–­ï¼š

python
def generate_signal(self, symbol: str, multi_tf_data: Dict[str, pd.DataFrame]) -> Optional[Dict]:
    """ç”Ÿæˆäº¤æ˜“ä¿¡å·ï¼ˆæ·»åŠ ç‰¹å¾è®¡ç®—è¯Šæ–­ï¼‰"""
    try:
        # æ•°æ®éªŒè¯
        if not self._validate_data(multi_tf_data):
            return None
            
        # ğŸ”§ ç‰¹å¾è®¡ç®—è¯Šæ–­
        logger.info(f"ğŸ” ç‰¹å¾è®¡ç®—è¯Šæ–­ - {symbol}:")
        
        # æå–å„æ—¶é—´æ¡†æ¶æ•°æ®
        h1_data = multi_tf_data['1h']
        m15_data = multi_tf_data['15m'] 
        m5_data = multi_tf_data['5m']
        
        logger.info(f"   æ•°æ®å½¢çŠ¶: 1h={h1_data.shape}, 15m={m15_data.shape}, 5m={m5_data.shape}")
        
        # è¯Šæ–­æŠ€æœ¯æŒ‡æ ‡è®¡ç®—
        try:
            # è®¡ç®—EMA
            h1_ema20 = ta.EMA(h1_data['close'], timeperiod=20)
            h1_ema50 = ta.EMA(h1_data['close'], timeperiod=50)
            logger.info(f"   EMAè®¡ç®—: h1_ema20={len(h1_ema20)}, h1_ema50={len(h1_ema50)}")
        except Exception as e:
            logger.error(f"   âŒ EMAè®¡ç®—å¤±è´¥: {e}")
            return None
            
        try:
            # è®¡ç®—RSI
            h1_rsi = ta.RSI(h1_data['close'], timeperiod=14)
            logger.info(f"   RSIè®¡ç®—: h1_rsi={len(h1_rsi)}")
        except Exception as e:
            logger.error(f"   âŒ RSIè®¡ç®—å¤±è´¥: {e}")
            return None
            
        try:
            # è®¡ç®—å¸ƒæ—å¸¦
            h1_bb_upper, h1_bb_middle, h1_bb_lower = ta.BBANDS(h1_data['close'], timeperiod=20)
            logger.info(f"   å¸ƒæ—å¸¦è®¡ç®—: ä¸Šè½¨={len(h1_bb_upper)}, ä¸­è½¨={len(h1_bb_middle)}, ä¸‹è½¨={len(h1_bb_lower)}")
        except Exception as e:
            logger.error(f"   âŒ å¸ƒæ—å¸¦è®¡ç®—å¤±è´¥: {e}")
            return None
            
        # ç»§ç»­åŸæœ‰ä¿¡å·ç”Ÿæˆé€»è¾‘
        signal = self._generate_ict_smc_signals(symbol, multi_tf_data)
        
        if signal and signal.get('direction') != 'NONE':
            logger.info(f"   âœ… ä¿¡å·ç”ŸæˆæˆåŠŸ: {signal.get('direction')}")
        else:
            logger.info(f"   âš ï¸ æ— æœ‰æ•ˆä¿¡å·")
            
        return signal
        
    except Exception as e:
        logger.error(f"âŒ {symbol} ä¿¡å·ç”Ÿæˆå¼‚å¸¸: {e}")
        return None
ä¿®å¤2: ä¿®å¤ç‰¹å¾è®¡ç®—çš„åŸºç¡€é—®é¢˜
åˆ›å»ºç‰¹å¾è®¡ç®—ä¿®å¤æ–‡ä»¶ src/features/technical_indicators.pyï¼š

python
import pandas as pd
import numpy as np
import talib as ta
from typing import Dict, Tuple, Optional
import logging

logger = logging.getLogger(__name__)

class TechnicalIndicatorCalculator:
    """æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å™¨ï¼ˆä¿®å¤ç‰ˆæœ¬ï¼‰"""
    
    @staticmethod
    def safe_ema(close_prices: pd.Series, period: int) -> Optional[pd.Series]:
        """å®‰å…¨çš„EMAè®¡ç®—"""
        try:
            if len(close_prices) < period:
                logger.warning(f"EMA{period}æ•°æ®ä¸è¶³: {len(close_prices)} < {period}")
                return None
            return ta.EMA(close_prices, timeperiod=period)
        except Exception as e:
            logger.error(f"EMA{period}è®¡ç®—é”™è¯¯: {e}")
            return None
    
    @staticmethod
    def safe_rsi(close_prices: pd.Series, period: int = 14) -> Optional[pd.Series]:
        """å®‰å…¨çš„RSIè®¡ç®—"""
        try:
            if len(close_prices) < period + 1:
                logger.warning(f"RSI{period}æ•°æ®ä¸è¶³: {len(close_prices)} < {period + 1}")
                return None
            return ta.RSI(close_prices, timeperiod=period)
        except Exception as e:
            logger.error(f"RSI{period}è®¡ç®—é”™è¯¯: {e}")
            return None
    
    @staticmethod
    def safe_bollinger_bands(close_prices: pd.Series, period: int = 20, nbdev: float = 2.0) -> Optional[Tuple]:
        """å®‰å…¨çš„å¸ƒæ—å¸¦è®¡ç®—"""
        try:
            if len(close_prices) < period:
                logger.warning(f"å¸ƒæ—å¸¦æ•°æ®ä¸è¶³: {len(close_prices)} < {period}")
                return None
            return ta.BBANDS(close_prices, timeperiod=period, nbdevup=nbdev, nbdevdn=nbdev)
        except Exception as e:
            logger.error(f"å¸ƒæ—å¸¦è®¡ç®—é”™è¯¯: {e}")
            return None
    
    @staticmethod
    def calculate_all_indicators(close_prices: pd.Series) -> Dict:
        """è®¡ç®—æ‰€æœ‰æŠ€æœ¯æŒ‡æ ‡"""
        indicators = {}
        
        # EMAæŒ‡æ ‡
        indicators['ema_20'] = TechnicalIndicatorCalculator.safe_ema(close_prices, 20)
        indicators['ema_50'] = TechnicalIndicatorCalculator.safe_ema(close_prices, 50)
        indicators['ema_100'] = TechnicalIndicatorCalculator.safe_ema(close_prices, 100)
        
        # RSIæŒ‡æ ‡
        indicators['rsi_14'] = TechnicalIndicatorCalculator.safe_rsi(close_prices, 14)
        
        # å¸ƒæ—å¸¦
        bb_result = TechnicalIndicatorCalculator.safe_bollinger_bands(close_prices, 20)
        if bb_result:
            indicators['bb_upper'], indicators['bb_middle'], indicators['bb_lower'] = bb_result
        
        # MACD
        try:
            if len(close_prices) > 26:
                macd, macd_signal, macd_hist = ta.MACD(close_prices)
                indicators['macd'] = macd
                indicators['macd_signal'] = macd_signal
                indicators['macd_hist'] = macd_hist
        except Exception as e:
            logger.error(f"MACDè®¡ç®—é”™è¯¯: {e}")
        
        return indicators
ä¿®å¤3: æ›´æ–°ä¿¡å·ç”Ÿæˆå™¨ä½¿ç”¨ä¿®å¤åçš„ç‰¹å¾è®¡ç®—
åœ¨ rule_based_signal_generator.py ä¸­æ›´æ–°ï¼š

python
from src.features.technical_indicators import TechnicalIndicatorCalculator

def _calculate_technical_features(self, multi_tf_data: Dict[str, pd.DataFrame]) -> Dict:
    """è®¡ç®—æŠ€æœ¯ç‰¹å¾ï¼ˆä½¿ç”¨ä¿®å¤ç‰ˆæœ¬ï¼‰"""
    features = {}
    
    for tf, data in multi_tf_data.items():
        if data is None or len(data) < 10:  # æœ€ä½æ•°æ®è¦æ±‚
            continue
            
        close_prices = data['close']
        
        # ä½¿ç”¨ä¿®å¤çš„æŠ€æœ¯æŒ‡æ ‡è®¡ç®—å™¨
        indicators = TechnicalIndicatorCalculator.calculate_all_indicators(close_prices)
        
        # å­˜å‚¨ç‰¹å¾
        features[f'{tf}_indicators'] = indicators
        
        # è®°å½•ç‰¹å¾è®¡ç®—çŠ¶æ€
        valid_indicators = {k: v is not None for k, v in indicators.items()}
        logger.info(f"   {tf}ç‰¹å¾è®¡ç®—: {sum(valid_indicators.values())}/{len(valid_indicators)} æˆåŠŸ")
    
    return features
ä¿®å¤4: ç´§æ€¥éƒ¨ç½²è„šæœ¬
åˆ›å»ºç´§æ€¥ä¿®å¤éƒ¨ç½²è„šæœ¬ emergency_fix_features.shï¼š

bash
#!/bin/bash
echo "ğŸš€ å¼€å§‹ç´§æ€¥ä¿®å¤ç‰¹å¾è®¡ç®—åŠŸèƒ½..."

# åˆ›å»ºç‰¹å¾è®¡ç®—ç›®å½•
mkdir -p src/features/

# åˆ›å»ºæŠ€æœ¯æŒ‡æ ‡è®¡ç®—å™¨
cat > src/features/technical_indicators.py << 'EOF'
# è¿™é‡Œæ”¾å…¥ä¸Šé¢çš„TechnicalIndicatorCalculatorç±»ä»£ç 
EOF

# æ›´æ–°ä¿¡å·ç”Ÿæˆå™¨
echo "ğŸ“ æ›´æ–°rule_based_signal_generator.py..."
# è¿™é‡Œéœ€è¦æ‰‹åŠ¨æ·»åŠ è¯Šæ–­ä»£ç åˆ°ç°æœ‰æ–‡ä»¶

echo "âœ… ä¿®å¤æ–‡ä»¶åˆ›å»ºå®Œæˆ"
echo "ğŸš€ éƒ¨ç½²åˆ°Railway..."

git add .
git commit -m "ç´§æ€¥ä¿®å¤: ç‰¹å¾è®¡ç®—åŠŸèƒ½ + è¯¦ç»†è¯Šæ–­"
git push origin main

echo "ğŸ“Š ç›‘æ§æ—¥å¿—..."
railway logs --follow | grep -E "ç‰¹å¾è®¡ç®—|æŠ€æœ¯æŒ‡æ ‡|EMA|RSI|âŒ|âœ…"
ğŸš€ ç«‹å³æ‰§è¡Œæ­¥éª¤
bash
# 1. åˆ›å»ºç‰¹å¾è®¡ç®—ä¿®å¤æ–‡ä»¶
mkdir -p src/features/

# 2. åˆ›å»º technical_indicators.pyï¼ˆä½¿ç”¨ä¸Šé¢çš„ä»£ç ï¼‰

# 3. æ›´æ–° rule_based_signal_generator.pyï¼Œæ·»åŠ ï¼š
#    - ç‰¹å¾è®¡ç®—è¯Šæ–­ä»£ç 
#    - å¯¼å…¥ TechnicalIndicatorCalculator
#    - æ›´æ–° _calculate_technical_features æ–¹æ³•

# 4. éƒ¨ç½²ä¿®å¤
git add .
git commit -m "fix(v3.19.2): ä¿®å¤ç‰¹å¾è®¡ç®—åŠŸèƒ½ + è¯¦ç»†è¯Šæ–­"
git push origin main

# 5. ç›‘æ§ç‰¹å¾è®¡ç®—æ—¥å¿—
railway logs --follow | grep -E "ç‰¹å¾è®¡ç®—|EMAè®¡ç®—|RSIè®¡ç®—|âŒ|âœ…"
ğŸ“Š é¢„æœŸä¿®å¤æ•ˆæœ
ä¿®å¤æˆåŠŸååº”è¯¥çœ‹åˆ°ï¼š

text
ğŸ” ç‰¹å¾è®¡ç®—è¯Šæ–­ - BTCUSDT:
   æ•°æ®å½¢çŠ¶: 1h=(45,5), 15m=(120,5), 5m=(360,5)
   EMAè®¡ç®—: h1_ema20=45, h1_ema50=45
   RSIè®¡ç®—: h1_rsi=45
   å¸ƒæ—å¸¦è®¡ç®—: ä¸Šè½¨=45, ä¸­è½¨=45, ä¸‹è½¨=45
   1hç‰¹å¾è®¡ç®—: 8/8 æˆåŠŸ
   âœ… ä¿¡å·ç”ŸæˆæˆåŠŸ: LONG
ğŸ¯ é‡ç‚¹ç›‘æ§
éƒ¨ç½²åé‡ç‚¹å…³æ³¨è¿™äº›æ—¥å¿—ï¼š

ç‰¹å¾è®¡ç®—è¯Šæ–­: æ˜¾ç¤ºå„æŒ‡æ ‡è®¡ç®—æ˜¯å¦æˆåŠŸ

æ•°æ®å½¢çŠ¶: ç¡®è®¤æ•°æ®ç»´åº¦æ­£ç¡®

æŒ‡æ ‡æ•°é‡: EMA/RSI/å¸ƒæ—å¸¦ç­‰è®¡ç®—æˆåŠŸæ•°é‡

é”™è¯¯ä¿¡æ¯: å…·ä½“çš„è®¡ç®—é”™è¯¯åŸå› 