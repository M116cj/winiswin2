2025-11-02 08:22:00,920 - src.core.unified_scheduler - INFO - âœ… ä½¿ç”¨DataServiceå·²åŠ è¼‰çš„ 530 å€‹äº¤æ˜“å°ï¼ˆæ‰€æœ‰å¯äº¤æ˜“USDTæ°¸çºŒåˆç´„ï¼‰
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - ğŸ“Š æƒæçµ±è¨ˆ: ç¸½æ•¸=530 | æ•¸æ“šå¯ç”¨=530 | æ•¸æ“šç¼ºå¤±=0
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - ================================================================================
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - ğŸ“Š ä¿¡è™Ÿåˆ†æè¨ºæ–·ï¼ˆä¿¡å¿ƒå€¼Top 10ï¼‰
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - ================================================================================
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  1. BTCUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  2. ETHUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  3. BCHUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  4. XRPUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  5. LTCUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  6. TRXUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  7. ETCUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  8. LINKUSDT     | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO -  9. XLMUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - 10. ADAUSDT      | ä¿¡å¿ƒ=  0.0 | å‹ç‡=  0.0% | âŒ ç„¡ä¿¡è™Ÿ
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - ================================================================================
2025-11-02 08:22:02,990 - src.core.unified_scheduler - INFO - â¸ï¸  æœ¬é€±æœŸç„¡æ–°ä¿¡è™Ÿ

ç”±äºæˆ‘ä»¬åˆšåˆšä¿®æ”¹äº†è¿”å›ç»“æ„ï¼Œå¯èƒ½æ˜¯åœ¨ä¿®æ”¹è¿‡ç¨‹ä¸­å¼•å…¥äº†é”™è¯¯ã€‚å¦å¤–ï¼Œä¹Ÿå¯èƒ½æ˜¯ç‰¹å¾å¼•æ“æ²¡æœ‰æ­£ç¡®è®¡ç®—ç‰¹å¾ã€‚

æˆ‘ä»¬ç›®å‰ä½¿ç”¨çš„æ˜¯çº¯ICTæ¨¡å¼è¿˜æ˜¯ä¼ ç»Ÿæ¨¡å¼ï¼Ÿä»ä¹‹å‰çš„ä»£ç å®¡æŸ¥ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ç³»ç»Ÿæ”¯æŒåŒæ¨¡å¼ã€‚å¦‚æœä½¿ç”¨çš„æ˜¯çº¯ICTæ¨¡å¼ï¼Œé‚£ä¹ˆé—®é¢˜å¯èƒ½å‡ºç°åœ¨ç‰¹å¾è®¡ç®—ä¸Šã€‚

æˆ‘ä»¬éœ€è¦åœ¨ä¿¡å·ç”Ÿæˆå™¨ä¸­æ·»åŠ æ›´è¯¦ç»†çš„æ—¥å¿—ï¼Œä»¥ç¡®å®šæ˜¯å“ªä¸ªç¯èŠ‚è¿”å›äº†0ã€‚

å»ºè®®çš„æ’æŸ¥æ­¥éª¤ï¼š

åœ¨rule_based_signal_generator.pyçš„generate_signalæ–¹æ³•ä¸­ï¼Œåœ¨å…³é”®æ­¥éª¤æ·»åŠ æ—¥å¿—ï¼Œç‰¹åˆ«æ˜¯ï¼š

æ•°æ®éªŒè¯å

è®¡ç®—ä¿¡å¿ƒå€¼å‰

è®¡ç®—ä¿¡å¿ƒå€¼å

è®¡ç®—èƒœç‡å

æ£€æŸ¥ç‰¹å¾å¼•æ“æ˜¯å¦æ­£å¸¸è®¡ç®—äº†ç‰¹å¾ã€‚å¦‚æœæ˜¯çº¯ICTæ¨¡å¼ï¼Œæ£€æŸ¥_build_ict_smc_featuresçš„è¿”å›ã€‚

æ£€æŸ¥æ˜¯å¦å› ä¸ºå¼‚å¸¸å¯¼è‡´ä¿¡å¿ƒå€¼è®¡ç®—è¢«è·³è¿‡ã€‚

ç”±äºæˆ‘ä»¬æ— æ³•åœ¨Replitä¸Šæµ‹è¯•ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆåœ¨æœ¬åœ°ï¼ˆæˆ–Railwayï¼‰ä¸Šè¿è¡Œå¹¶æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ã€‚

ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æ—¶é—´ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆå¿«é€Ÿæ·»åŠ ä¸€äº›æ—¥å¿—æ¥å®šä½é—®é¢˜ã€‚

ä¿®æ”¹rule_based_signal_generator.pyä¸­çš„generate_signalæ–¹æ³•ï¼Œåœ¨å…³é”®ç‚¹æ·»åŠ æ—¥å¿—ï¼š
ä¾‹å¦‚ï¼š

åœ¨æ–¹æ³•å¼€å§‹æ—¶ï¼Œè®°å½•è¿›å…¥generate_signal

åœ¨æ•°æ®éªŒè¯åï¼Œè®°å½•éªŒè¯ç»“æœ

åœ¨è®¡ç®—ä¿¡å¿ƒå€¼å‰ï¼Œè®°å½•å³å°†è®¡ç®—ä¿¡å¿ƒå€¼

åœ¨è®¡ç®—ä¿¡å¿ƒå€¼åï¼Œè®°å½•ä¿¡å¿ƒå€¼ç»“æœ

åœ¨è®¡ç®—èƒœç‡åï¼Œè®°å½•èƒœç‡ç»“æœ

åŒæ ·ï¼Œåœ¨self_learning_trader.pyçš„analyzeæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä¹Ÿæ·»åŠ ä¸€äº›æ—¥å¿—ï¼Œä»¥ç¡®å®šé—®é¢˜æ˜¯åœ¨ä¿¡å·ç”Ÿæˆå™¨è¿˜æ˜¯åœ¨å…¶ä¸Šå±‚ã€‚

ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬å·²ç»çœ‹åˆ°æ‰€æœ‰äº¤æ˜“å¯¹çš„ä¿¡å¿ƒå€¼å’Œèƒœç‡éƒ½æ˜¯0ï¼Œæ‰€ä»¥é—®é¢˜å¾ˆå¯èƒ½å‡ºç°åœ¨ä¿¡å·ç”Ÿæˆå™¨çš„ä¿¡å¿ƒå€¼è®¡ç®—ç¯èŠ‚ã€‚

å¦å¤–ï¼Œæ³¨æ„æˆ‘ä»¬ä¿®æ”¹äº†è¿”å›ç»“æ„ï¼Œå¯èƒ½åœ¨æŸäº›æå‰è¿”å›çš„åœ°æ–¹ï¼Œæˆ‘ä»¬è¿”å›äº†(None, 0.0, 0.0)ï¼Œä½†å®é™…ä¸Šå¯èƒ½åº”è¯¥è¿”å›(None, æŸä¸ªè®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼, æŸä¸ªè®¡ç®—å‡ºçš„èƒœç‡)ï¼Ÿ

å›é¡¾æˆ‘ä»¬ä¹‹å‰çš„ä¿®æ”¹ï¼Œåœ¨generate_signalä¸­ï¼Œæˆ‘ä»¬ä¿®æ”¹äº†æ‰€æœ‰è¿”å›è¯­å¥ï¼Œç¡®ä¿è¿”å›ä¸‰å…ƒç»„ã€‚ä½†æ˜¯ï¼Œåœ¨æå‰è¿”å›çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¿”å›çš„æ˜¯(None, 0.0, 0.0)ã€‚è¿™å¯èƒ½æ˜¯ä¸æ­£ç¡®çš„ï¼Œå› ä¸ºå³ä½¿æå‰è¿”å›ï¼Œæˆ‘ä»¬å¯èƒ½å·²ç»è®¡ç®—äº†ä¿¡å¿ƒå€¼å’Œèƒœç‡ï¼Ÿè¿™å–å†³äºæå‰è¿”å›çš„æ—¶æœºã€‚

è®©æˆ‘ä»¬é‡æ–°å®¡è§†generate_signalçš„æµç¨‹ï¼š

æ•°æ®éªŒè¯ï¼šå¦‚æœéªŒè¯å¤±è´¥ï¼Œè¿”å›(None, 0.0, 0.0)

ç¡®å®šä¿¡å·æ–¹å‘ï¼šå¦‚æœæ— æ³•ç¡®å®šæ–¹å‘ï¼Œè¿”å›(None, 0.0, 0.0)

è®¡ç®—ä¿¡å¿ƒå€¼å’Œèƒœç‡

æ£€æŸ¥é˜ˆå€¼ï¼Œå¦‚æœä¿¡å¿ƒå€¼æˆ–èƒœç‡ä¸è¶³ï¼Œè¿”å›(None, è®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼, è®¡ç®—å‡ºçš„èƒœç‡)

å¦åˆ™ï¼Œè¿”å›(ä¿¡å·, è®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼, è®¡ç®—å‡ºçš„èƒœç‡)

æ‰€ä»¥ï¼Œåœ¨æ­¥éª¤1å’Œ2ï¼Œæˆ‘ä»¬è¿”å›äº†(0,0)ï¼Œä½†åœ¨æ­¥éª¤4ï¼Œæˆ‘ä»¬è¿”å›äº†è®¡ç®—å‡ºçš„å€¼ï¼ˆå³ä½¿ä¿¡å·ä¸ºNoneï¼‰ã€‚

ç°åœ¨ï¼Œæ‰€æœ‰äº¤æ˜“å¯¹éƒ½è¿”å›(0,0)ï¼Œè¯´æ˜è¦ä¹ˆæ‰€æœ‰äº¤æ˜“å¯¹éƒ½åœ¨æ­¥éª¤1æˆ–2å°±æå‰è¿”å›äº†ï¼Œè¦ä¹ˆæ­¥éª¤3è®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼å’Œèƒœç‡å°±æ˜¯0ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šæ˜¯å“ªä¸ªç¯èŠ‚å‡ºäº†é—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨generate_signalä¸­æ·»åŠ æ—¥å¿—æ¥åŒºåˆ†ï¼š

ä¾‹å¦‚ï¼Œåœ¨æ•°æ®éªŒè¯å¤±è´¥æ—¶ï¼Œè®°å½•"æ•°æ®éªŒè¯å¤±è´¥"
åœ¨æ— æ³•ç¡®å®šæ–¹å‘æ—¶ï¼Œè®°å½•"æ— æ³•ç¡®å®šæ–¹å‘"
åœ¨è®¡ç®—ä¿¡å¿ƒå€¼å’Œèƒœç‡åï¼Œè®°å½•è®¡ç®—å‡ºçš„å€¼

è¿™æ ·ï¼Œæˆ‘ä»¬å°±èƒ½çŸ¥é“æ˜¯å“ªä¸ªç¯èŠ‚è¿”å›äº†0ã€‚

ç”±äºæˆ‘ä»¬å·²ç»åœ¨Railwayä¸Šè¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ è¿™äº›æ—¥å¿—å¹¶é‡æ–°éƒ¨ç½²æ¥è·å–æ›´å¤šä¿¡æ¯ã€‚

å…·ä½“ä¿®æ”¹ï¼š

åœ¨rule_based_signal_generator.pyçš„generate_signalæ–¹æ³•ä¸­ï¼š

åœ¨æ•°æ®éªŒè¯å¤±è´¥åï¼Œè®°å½•è­¦å‘Šã€‚
åœ¨æ— æ³•ç¡®å®šæ–¹å‘åï¼Œè®°å½•è­¦å‘Šã€‚
åœ¨è®¡ç®—ä¿¡å¿ƒå€¼å’Œèƒœç‡åï¼Œè®°å½•ä¿¡æ¯ã€‚

ä¾‹å¦‚ï¼š

python
    def generate_signal(self, symbol, klines_data, market_structure="NEUTRAL"):
        # æ•°æ®éªŒè¯
        if not self._validate_klines_data(klines_data):
            logger.warning(f"âŒ {symbol}: æ•°æ®éªŒè¯å¤±è´¥")
            return None, 0.0, 0.0

        # ç¡®å®šä¿¡å·æ–¹å‘
        direction = self._determine_signal_direction(klines_data, market_structure)
        if direction is None:
            logger.warning(f"âŒ {symbol}: æ— æ³•ç¡®å®šä¿¡å·æ–¹å‘")
            return None, 0.0, 0.0

        # è®¡ç®—ä¿¡å¿ƒå€¼å’Œèƒœç‡
        confidence_score, sub_scores = self._calculate_confidence(klines_data, direction, market_structure)
        win_probability = self._calculate_win_probability(klines_data, direction, confidence_score, market_structure)

        logger.info(f"ğŸ“Š {symbol}: è®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼={confidence_score}, èƒœç‡={win_probability}")

        # ... å…¶ä½™ä»£ç  ...
åŒæ ·ï¼Œåœ¨_calculate_confidenceå’Œ_calculate_win_probabilityå†…éƒ¨ä¹Ÿå¯èƒ½æœ‰æå‰è¿”å›0çš„æƒ…å†µï¼Œæˆ‘ä»¬ä¹Ÿè¦åœ¨è¿™äº›å‡½æ•°å†…éƒ¨æ·»åŠ æ—¥å¿—ã€‚

ä½†æ˜¯ï¼Œç”±äºæ—¶é—´å…³ç³»ï¼Œæˆ‘ä»¬å…ˆåœ¨generate_signalçš„å…³é”®ç‚¹æ·»åŠ æ—¥å¿—ï¼Œçœ‹çœ‹é—®é¢˜å‡ºåœ¨æ•°æ®éªŒè¯ã€æ–¹å‘ç¡®å®šè¿˜æ˜¯ä¿¡å¿ƒå€¼è®¡ç®—ã€‚

å¦å¤–ï¼Œæˆ‘ä»¬ä¹Ÿè¦æ£€æŸ¥æ•°æ®éªŒè¯å‡½æ•°_validate_klines_dataå’Œæ–¹å‘ç¡®å®šå‡½æ•°_determine_signal_directionã€‚

ç”±äºæˆ‘ä»¬ä¹‹å‰çš„æ•°æ®å¯ç”¨æ€§æ£€æŸ¥å·²ç»é€šè¿‡ï¼Œæ‰€ä»¥æ•°æ®åº”è¯¥æ˜¯å­˜åœ¨çš„ï¼Œä½†å¯èƒ½æ•°æ®éªŒè¯å‡½æ•°æœ‰æ›´ä¸¥æ ¼çš„è¦æ±‚ã€‚

æˆ‘ä»¬è¿˜å¯ä»¥æš‚æ—¶æ”¾å®½æ•°æ®éªŒè¯ï¼Œæ³¨é‡Šæ‰æ•°æ®éªŒè¯ï¼Œçœ‹çœ‹æ˜¯å¦ä»ç„¶è¿”å›0ã€‚

ä½†æ˜¯ï¼Œè€ƒè™‘åˆ°æˆ‘ä»¬å·²ç»åœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆRailwayï¼‰ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ—¥å¿—æ¥è¯Šæ–­ã€‚

è¯·æ·»åŠ ä¸Šè¿°æ—¥å¿—ï¼Œç„¶åé‡æ–°éƒ¨ç½²åˆ°Railwayï¼Œå¹¶è§‚å¯Ÿè¾“å‡ºã€‚

å¦‚æœå‘ç°æ˜¯æ•°æ®éªŒè¯å¤±è´¥ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ£€æŸ¥æ•°æ®éªŒè¯å‡½æ•°_validate_klines_dataä¸­åˆ°åº•åœ¨æ£€æŸ¥ä»€ä¹ˆã€‚

åŒæ ·ï¼Œå¦‚æœæ˜¯æ–¹å‘ç¡®å®šå¤±è´¥ï¼Œé‚£ä¹ˆæ£€æŸ¥æ–¹å‘ç¡®å®šå‡½æ•°ã€‚

å¦‚æœè®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼å’Œèƒœç‡å°±æ˜¯0ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦è¿›å…¥_calculate_confidenceå’Œ_calculate_win_probabilityå‡½æ•°å†…éƒ¨æ’æŸ¥ã€‚

ç”±äºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯çº¯ICTæ¨¡å¼ï¼Œé‚£ä¹ˆä¿¡å¿ƒå€¼è®¡ç®—å‡½æ•°åº”è¯¥æ˜¯_calculate_confidence_pure_ictï¼Œæˆ‘ä»¬éœ€è¦æ£€æŸ¥è¿™ä¸ªå‡½æ•°ã€‚

å¯èƒ½çš„é—®é¢˜ï¼šç‰¹å¾å¼•æ“è¿”å›çš„ç‰¹å¾éƒ½æ˜¯0ï¼Œå¯¼è‡´ä¿¡å¿ƒå€¼ä¸º0ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨_calculate_confidence_pure_ictä¸­æ·»åŠ æ—¥å¿—ï¼Œè®°å½•ç‰¹å¾å¼•æ“è¿”å›çš„ç‰¹å¾å€¼ã€‚

ä¾‹å¦‚ï¼š

python
    def _calculate_confidence_pure_ict(self, ict_features, direction, market_structure, order_blocks, current_price):
        logger.info(f"ICTç‰¹å¾: {ict_features}")
        # ... å…¶ä½™ä»£ç  ...
åŒæ ·ï¼Œåœ¨_calculate_win_probability_pure_ictä¸­ä¹Ÿæ·»åŠ æ—¥å¿—ã€‚

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥çŸ¥é“æ˜¯ç‰¹å¾è®¡ç®—çš„é—®é¢˜è¿˜æ˜¯ä¿¡å¿ƒå€¼è®¡ç®—å…¬å¼çš„é—®é¢˜ã€‚

ç”±äºé—®é¢˜æ¯”è¾ƒå¤æ‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸€æ­¥æ­¥æ’æŸ¥ã€‚

ç°åœ¨ï¼Œè¯·å…ˆæ·»åŠ åœ¨generate_signalä¸­çš„æ—¥å¿—ï¼Œç„¶åé‡æ–°éƒ¨ç½²ï¼Œè§‚å¯Ÿæ—¥å¿—è¾“å‡ºã€‚

å¦‚æœå‘ç°æ˜¯ç‰¹å¾è®¡ç®—é—®é¢˜ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ£€æŸ¥ç‰¹å¾å¼•æ“feature_engineçš„_build_ict_smc_featuresæ–¹æ³•ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ç‰¹å¾å¼•æ“ä¸­æ·»åŠ æ—¥å¿—ï¼Œè®°å½•æ¯ä¸ªç‰¹å¾çš„è®¡ç®—ç»“æœã€‚

ä¿¡å¿ƒå€¼è®¡ç®—å®Œå…¨å¤±è´¥
çœ‹åˆ°æ—¥å¿—åï¼Œé—®é¢˜éå¸¸æ˜ç¡®äº†ï¼šæ‰€æœ‰530ä¸ªäº¤æ˜“å¯¹çš„ä¿¡å¿ƒå€¼å’Œèƒœç‡éƒ½æ˜¯0.0%ã€‚è¿™è¯´æ˜ä¿¡å·ç”Ÿæˆé€»è¾‘å­˜åœ¨æ ¹æœ¬æ€§é—®é¢˜ã€‚

ğŸ” æ ¹æœ¬åŸå› åˆ†æ
å¯èƒ½æ€§1ï¼šçº¯ICTæ¨¡å¼ç‰¹å¾è®¡ç®—å¤±è´¥
python
# åœ¨feature_engine.pyä¸­ï¼Œç‰¹å¾è®¡ç®—å¯èƒ½è¿”å›ç©ºæˆ–é»˜è®¤å€¼
def _build_ict_smc_features(self, signal, klines_data):
    try:
        # ç‰¹å¾è®¡ç®—é€»è¾‘...
        return features
    except Exception:
        return {}  # âŒ è¿”å›ç©ºå­—å…¸ï¼Œå¯¼è‡´æ‰€æœ‰ç‰¹å¾ä¸º0
å¯èƒ½æ€§2ï¼šä¿¡å¿ƒå€¼è®¡ç®—å‡½æ•°è¢«è·³è¿‡
python
# åœ¨rule_based_signal_generator.pyä¸­
def _calculate_confidence_pure_ict(self, ict_features, ...):
    # å¦‚æœict_featuresä¸ºç©ºæˆ–æ— æ•ˆï¼Œæ‰€æœ‰å­åˆ†æ•°éƒ½ä¸º0
    structure_integrity = ict_features.get('structure_integrity', 0.0)  # âŒ æ€»æ˜¯0.0
    # ... å…¶ä»–ç‰¹å¾ä¹Ÿéƒ½æ˜¯0.0
    return 0.0, {}  # æœ€ç»ˆè¿”å›0ä¿¡å¿ƒå€¼
å¯èƒ½æ€§3ï¼šæ•°æ®æ ¼å¼ä¸åŒ¹é…
python
# WebSocketæ•°æ®æ ¼å¼ä¸ç‰¹å¾å¼•æ“æœŸæœ›çš„ä¸åŒ¹é…
klines_data = {
    '1h': h1_data,   # âŒ DataFrameç»“æ„å¯èƒ½ä¸æ­£ç¡®
    '15m': m15_data, # âŒ ç¼ºå°‘å¿…è¦åˆ—
    '5m': m5_data    # âŒ æ—¶é—´æˆ³æ ¼å¼é—®é¢˜
}
ğŸ› ï¸ ç«‹å³è¯Šæ–­æ­¥éª¤
æ­¥éª¤1ï¼šæ£€æŸ¥ç‰¹å¾å¼•æ“è¾“å‡º
åœ¨rule_based_signal_generator.pyçš„generate_signalæ–¹æ³•ä¸­æ·»åŠ ç‰¹å¾æ£€æŸ¥ï¼š

python
def generate_signal(self, symbol, klines_data, market_structure="NEUTRAL"):
    logger.info(f"ğŸ” å¼€å§‹åˆ†æ {symbol}")
    
    # éªŒè¯æ•°æ®
    if not self._validate_klines_data(klines_data):
        logger.warning(f"âŒ {symbol}: æ•°æ®éªŒè¯å¤±è´¥")
        return None, 0.0, 0.0
    
    # æ£€æŸ¥çº¯ICTæ¨¡å¼
    if self.use_pure_ict:
        logger.info(f"ğŸ”§ {symbol}: ä½¿ç”¨çº¯ICTæ¨¡å¼")
        
        # è·å–ICTç‰¹å¾
        ict_features = self.feature_engine._build_ict_smc_features(
            signal={'symbol': symbol, 'direction': 'NEUTRAL'},
            klines_data=klines_data
        )
        
        # ğŸ”¥ å…³é”®è¯Šæ–­ï¼šæ£€æŸ¥ç‰¹å¾æ˜¯å¦æ­£å¸¸
        logger.info(f"ğŸ“Š {symbol}: ICTç‰¹å¾æ•°é‡ = {len(ict_features)}")
        if not ict_features:
            logger.error(f"ğŸš¨ {symbol}: ICTç‰¹å¾ä¸ºç©º!")
            return None, 0.0, 0.0
        
        # æ£€æŸ¥å…³é”®ç‰¹å¾å€¼
        key_features = ['market_structure', 'order_blocks_count', 'structure_integrity']
        for feature in key_features:
            value = ict_features.get(feature, 'MISSING')
            logger.info(f"   {feature}: {value}")
        
        # è®¡ç®—ä¿¡å¿ƒå€¼
        confidence_score, sub_scores = self._calculate_confidence_pure_ict(
            ict_features, 'NEUTRAL', market_structure, [], current_price
        )
        
    else:
        # ä¼ ç»Ÿæ¨¡å¼...
        pass
    
    return signal, confidence_score, win_probability
æ­¥éª¤2ï¼šæ£€æŸ¥æ•°æ®è´¨é‡
åœ¨unified_scheduler.pyä¸­æ·»åŠ æ•°æ®è´¨é‡æ£€æŸ¥ï¼š

python
def scan_symbols(self):
    for i, symbol in enumerate(self.symbols[:3]):  # åªæ£€æŸ¥å‰3ä¸ªç¬¦å·
        multi_tf_data = self.data_service.get_multi_timeframe_klines(symbol, self.timeframes)
        
        # è¯¦ç»†æ£€æŸ¥æ•°æ®è´¨é‡
        logger.info(f"ğŸ” æ•°æ®è´¨é‡æ£€æŸ¥ - {symbol}:")
        for timeframe, data in multi_tf_data.items():
            if data is None:
                logger.warning(f"   {timeframe}: âŒ æ•°æ®ä¸ºNone")
                continue
                
            logger.info(f"   {timeframe}: âœ… {len(data)}è¡Œæ•°æ®")
            if len(data) > 0:
                # æ£€æŸ¥åˆ—å
                columns = list(data.columns)
                logger.info(f"      åˆ—å: {columns}")
                
                # æ£€æŸ¥æœ€æ–°æ•°æ®æ—¶é—´
                if 'timestamp' in data.columns:
                    latest_ts = data.iloc[-1]['timestamp']
                    logger.info(f"      æœ€æ–°æ—¶é—´æˆ³: {latest_ts}")
æ­¥éª¤3ï¼šéªŒè¯ç‰¹å¾å¼•æ“çŠ¶æ€
åœ¨è°ƒåº¦å™¨åˆå§‹åŒ–æ—¶æ£€æŸ¥ç‰¹å¾å¼•æ“ï¼š

python
def __init__(self, config=None, use_pure_ict: bool = True):
    self.use_pure_ict = use_pure_ict
    
    if use_pure_ict:
        from src.ml.feature_engine import FeatureEngine
        try:
            self.feature_engine = FeatureEngine()
            logger.info("âœ… Feature Engineåˆå§‹åŒ–æˆåŠŸ")
            
            # æµ‹è¯•ç‰¹å¾è®¡ç®—
            test_features = self.feature_engine._build_ict_smc_features(
                signal={'symbol': 'TEST', 'direction': 'NEUTRAL'},
                klines_data={'1h': None, '15m': None, '5m': None}  # ç©ºæ•°æ®æµ‹è¯•
            )
            logger.info(f"ğŸ§ª ç‰¹å¾å¼•æ“æµ‹è¯•: {len(test_features)}ä¸ªç‰¹å¾")
            
        except Exception as e:
            logger.error(f"âŒ Feature Engineåˆå§‹åŒ–å¤±è´¥: {e}")
            self.feature_engine = None
    else:
        self.feature_engine = None
        logger.info("ğŸ”§ ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼ï¼ŒæœªåŠ è½½Feature Engine")
ğŸ¯ å¿«é€Ÿä¿®å¤æ–¹æ¡ˆ
æ–¹æ¡ˆAï¼šåˆ‡æ¢åˆ°ä¼ ç»Ÿæ¨¡å¼ï¼ˆç«‹å³éªŒè¯ï¼‰
å¦‚æœçº¯ICTæ¨¡å¼æœ‰é—®é¢˜ï¼Œå…ˆåˆ‡æ¢å›ä¼ ç»Ÿæ¨¡å¼éªŒè¯ç³»ç»Ÿï¼š

python
# åœ¨unified_scheduler.pyä¸­ä¸´æ—¶å¼ºåˆ¶ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼
def __init__(self, config=None, use_pure_ict: bool = False):  # âŒ å¼ºåˆ¶False
    self.use_pure_ict = False  # è¦†ç›–å‚æ•°
    logger.warning("ğŸ”„ å¼ºåˆ¶ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼è¿›è¡ŒéªŒè¯")
æ–¹æ¡ˆBï¼šæ·»åŠ ç‰¹å¾å¼•æ“é™çº§
python
def generate_signal(self, symbol, klines_data, market_structure="NEUTRAL"):
    # å¦‚æœçº¯ICTæ¨¡å¼å¤±è´¥ï¼Œè‡ªåŠ¨é™çº§åˆ°ä¼ ç»Ÿæ¨¡å¼
    if self.use_pure_ict:
        try:
            ict_features = self.feature_engine._build_ict_smc_features(...)
            if not ict_features or all(v == 0 for v in ict_features.values()):
                logger.warning(f"âš ï¸ {symbol}: ICTç‰¹å¾å¼‚å¸¸ï¼Œé™çº§åˆ°ä¼ ç»Ÿæ¨¡å¼")
                return self._generate_signal_traditional(symbol, klines_data, market_structure)
        except Exception as e:
            logger.error(f"âŒ {symbol}: ICTæ¨¡å¼å¤±è´¥: {e}ï¼Œé™çº§åˆ°ä¼ ç»Ÿæ¨¡å¼")
            return self._generate_signal_traditional(symbol, klines_data, market_structure)
ğŸ“‹ ç«‹å³è¡ŒåŠ¨æ¸…å•
ä¼˜å…ˆçº§1ï¼šè¯Šæ–­ç‰¹å¾å¼•æ“ï¼ˆ5åˆ†é’Ÿï¼‰
æ·»åŠ ç‰¹å¾è¾“å‡ºæ—¥å¿—

æ£€æŸ¥æ•°æ®æ ¼å¼

éªŒè¯ç‰¹å¾å¼•æ“åˆå§‹åŒ–

ä¼˜å…ˆçº§2ï¼šå®æ–½å¿«é€Ÿä¿®å¤ï¼ˆ2åˆ†é’Ÿï¼‰
python
# é€‰é¡¹1ï¼šåˆ‡æ¢åˆ°ä¼ ç»Ÿæ¨¡å¼
self.use_pure_ict = False

# é€‰é¡¹2ï¼šæ·»åŠ é™çº§æœºåˆ¶
if ict_featureså¼‚å¸¸:
    ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼
ä¼˜å…ˆçº§3ï¼šé‡æ–°éƒ¨ç½²éªŒè¯
éƒ¨ç½²åˆ°Railway

è§‚å¯Ÿå‰å‡ ä¸ªäº¤æ˜“å¯¹çš„è¯¦ç»†è¯Šæ–­è¾“å‡º

æ ¹æ®è¾“å‡ºç¡®å®šå…·ä½“é—®é¢˜

ğŸ“Š é¢„æœŸä¿®å¤åè¾“å‡º
ä¿®å¤åæ‚¨åº”è¯¥çœ‹åˆ°ï¼š

text
ğŸ” å¼€å§‹åˆ†æ BTCUSDT
ğŸ”§ BTCUSDT: ä½¿ç”¨çº¯ICTæ¨¡å¼  
ğŸ“Š BTCUSDT: ICTç‰¹å¾æ•°é‡ = 12
   market_structure: 0.75
   order_blocks_count: 2
   structure_integrity: 0.8
ğŸ“Š BTCUSDT: è®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼=65.2, èƒœç‡=58.3%
æˆ–è€…ä¼ ç»Ÿæ¨¡å¼çš„è¾“å‡ºï¼š

text
ğŸ”§ BTCUSDT: ä½¿ç”¨ä¼ ç»Ÿæ¨¡å¼
ğŸ“Š BTCUSDT: EMAåå·®=0.02, RSI=45.2, MACD=0.001
ğŸ“Š BTCUSDT: è®¡ç®—å‡ºçš„ä¿¡å¿ƒå€¼=72.1, èƒœç‡=61.5%
ğŸ¯ æ€»ç»“
é—®é¢˜ç¡®è¯Šï¼šçº¯ICTæ¨¡å¼çš„ç‰¹å¾è®¡ç®—è¿”å›å…¨0å€¼ï¼Œå¯¼è‡´ä¿¡å¿ƒå€¼è®¡ç®—å¤±è´¥ã€‚

ç«‹å³è¡ŒåŠ¨ï¼š

æ·»åŠ è¯¦ç»†è¯Šæ–­æ—¥å¿—ç¡®å®šæ˜¯ç‰¹å¾å¼•æ“é—®é¢˜è¿˜æ˜¯æ•°æ®é—®é¢˜

ä¸´æ—¶åˆ‡æ¢åˆ°ä¼ ç»Ÿæ¨¡å¼éªŒè¯ç³»ç»ŸåŸºæœ¬åŠŸèƒ½

åŸºäºè¯Šæ–­ç»“æœä¿®å¤ç‰¹å¾å¼•æ“æˆ–æ•°æ®æ ¼å¼