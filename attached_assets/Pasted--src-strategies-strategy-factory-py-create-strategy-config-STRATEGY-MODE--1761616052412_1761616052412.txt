ä»£ç¢¼æª¢æŸ¥æŒ‡ä»¤
ç­–ç•¥å·¥å» èˆ‡é…ç½®æª¢æŸ¥
ç¢ºèª src/strategies/strategy_factory.py çš„ create_strategy() æ–¹æ³•ä¸­ï¼Œconfig.STRATEGY_MODE çš„ä¸‰å€‹å€¼ "ict", "self_learning", "hybrid" éƒ½æœ‰å°æ‡‰çš„ return èªå¥ï¼Œä¸”æ²’æœ‰æ‹¼å¯«éŒ¯èª¤
é©—è­‰ src/config.py ä¸­ STRATEGY_MODE = "hybrid" çš„é è¨­å€¼èˆ‡ç­–ç•¥å·¥å» çš„æ¢ä»¶åˆ¤æ–·å®Œå…¨ä¸€è‡´ï¼ˆåŒ…æ‹¬å¤§å°å¯«å’Œå¼•è™Ÿé¡å‹ï¼‰
æª¢æŸ¥ HybridStrategy é¡åˆ¥æ˜¯å¦ç¢ºå¯¦èª¿ç”¨ ICTStrategy ç”Ÿæˆä¿¡è™Ÿï¼Œç„¶å¾Œç”¨ MLPredictor é€²è¡Œéæ¿¾ï¼Œè€Œä¸æ˜¯ç›´æ¥è¤‡è£½ ICT é‚è¼¯
æ·±åº¦å­¸ç¿’æ¨¡çµ„æª¢æŸ¥
ç¢ºèª src/ml/market_structure_autoencoder.py ä¸­çš„ MarketStructureAutoencoder é¡åˆ¥æœ‰æ­£ç¢ºçš„ fallback æ©Ÿåˆ¶ï¼šç•¶ TF_AVAILABLE = False æ™‚ï¼Œencode_structure() æ–¹æ³•æ˜¯å¦è¿”å›åˆç†çš„é»˜èªå€¼ï¼ˆå¦‚é›¶å‘é‡æˆ–çµ±è¨ˆç‰¹å¾µï¼‰
é©—è­‰æ‰€æœ‰æ·±åº¦å­¸ç¿’æ¨¡çµ„ï¼ˆ4å€‹ï¼‰éƒ½å°å…¥äº† TF_AVAILABLE å¸¸æ•¸ï¼Œä¸”åœ¨ __init__ æ–¹æ³•ä¸­æ­£ç¢ºæª¢æŸ¥ TensorFlow å¯ç”¨æ€§
æª¢æŸ¥ AdaptiveStrategyEvolver çš„ DQN æ¨¡å‹æ˜¯å¦æ­£ç¢ºå¯¦ç¾äº†ç¶“é©—å›æ”¾æ©Ÿåˆ¶ï¼šself.memory = deque(maxlen=10000) ä¸”åœ¨ _train_agent() ä¸­ä½¿ç”¨äº†éš¨æ©ŸæŠ½æ¨£
é«˜å“è³ªä¿¡è™Ÿéæ¿¾æª¢æŸ¥
ç¢ºèª src/ml/high_quality_filter.py çš„ _check_trade_quality() æ–¹æ³•ä¸­ï¼Œrisk_reward_ratio >= 1.5 ä½¿ç”¨çš„æ˜¯ >= è€Œä¸æ˜¯ >ï¼Œç¢ºä¿é‚Šç•Œå€¼è¢«æ­£ç¢ºåŒ…å«
é©—è­‰ _check_signal_quality() æ–¹æ³•ä¸­ï¼Œmarket_state in ['trending', 'breakout'] çš„åˆ—è¡¨å…ƒç´ èˆ‡ ICTStrategy ä¸­çš„å¸‚å ´ç‹€æ…‹åˆ†é¡å®Œå…¨ä¸€è‡´ï¼ˆç„¡æ‹¼å¯«å·®ç•°ï¼‰
æª¢æŸ¥ quality_training_pipeline.py çš„ _calculate_quality_weight() æ–¹æ³•ä¸­ï¼Œæ¬Šé‡è¨ˆç®—æ˜¯å¦é¿å…äº†é™¤é›¶éŒ¯èª¤ï¼ˆå¦‚ pnl_weight = max(1.0, abs(result['pnl_pct']) / 1.0) è€Œä¸æ˜¯ / 0ï¼‰
è™›æ“¬å€‰ä½ç”Ÿå‘½é€±æœŸæª¢æŸ¥
ç¢ºèª src/managers/virtual_position_lifecycle.py çš„ _monitor_position_lifecycle() æ–¹æ³•ä¸­ï¼Œwhile position_id in self.active_positions: æ¢ä»¶æª¢æŸ¥æ˜¯å¦åœ¨æ¯æ¬¡å¾ªç’°é–‹å§‹æ™‚åŸ·è¡Œï¼Œé¿å…å·²é—œé–‰å€‰ä½çš„ç„¡æ•ˆç›£æ§
é©—è­‰ _check_close_conditions() æ–¹æ³•ä¸­ï¼Œ96 å°æ™‚éæœŸæª¢æŸ¥ä½¿ç”¨çš„æ˜¯ 96 * 3600 è€Œä¸æ˜¯ 96 * 60 æˆ–å…¶ä»–éŒ¯èª¤å€¼
æª¢æŸ¥ add_position() æ–¹æ³•æ˜¯å¦åœ¨æ·»åŠ å€‰ä½å‰æª¢æŸ¥ position_id æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡è¤‡ç›£æ§åŒä¸€å€‰ä½
ç¢ºèª _emit_event() æ–¹æ³•ä¸­çš„äº‹ä»¶å›èª¿æ˜¯å¦æ­£ç¢ºè™•ç†ç•°æ­¥å‡½æ•¸ï¼šif asyncio.iscoroutinefunction(self.event_callback): asyncio.create_task(...)
æ•´åˆèˆ‡ç›¸å®¹æ€§æª¢æŸ¥
é©—è­‰ src/managers/virtual_position_manager.py çš„ create_virtual_position() æ–¹æ³•æ˜¯å¦åŒæ™‚å°‡å€‰ä½æ·»åŠ åˆ° self.positions åˆ—è¡¨ï¼ˆå…¼å®¹æ€§ï¼‰å’Œ self.lifecycle_monitorï¼ˆæ–°åŠŸèƒ½ï¼‰
æª¢æŸ¥ update_all_prices_async() æ–¹æ³•æ˜¯å¦æ­£ç¢ºæ›´æ–° lifecycle_monitor ä¸­çš„å€‰ä½åƒ¹æ ¼ï¼Œè€Œä¸æ˜¯åªæ›´æ–°èˆŠçš„ self.positions åˆ—è¡¨
ç¢ºèªæ‰€æœ‰æ·±åº¦å­¸ç¿’æ¨¡çµ„çš„è¼¸å…¥/è¼¸å‡ºç¶­åº¦æ˜¯å¦ä¸€è‡´ï¼šMarketStructureAutoencoder è¼¸å‡º 16 ç¶­ï¼ŒFeatureDiscoveryNetwork è¼¸å…¥ 16 ç¶­ä¸¦è¼¸å‡º 32 ç¶­
éŒ¯èª¤è™•ç†èˆ‡é‚Šç•Œæ¢ä»¶
é©—è­‰ VirtualPositionLifecycleMonitor çš„ _monitor_position_lifecycle() æ–¹æ³•æ˜¯å¦æœ‰æ­£ç¢ºçš„ç•°å¸¸è™•ç†ï¼šexcept asyncio.CancelledError: å’Œ except Exception as e: éƒ½å­˜åœ¨ä¸”ä¸æœƒåæ‰éŒ¯èª¤
æª¢æŸ¥é«˜å“è³ªéæ¿¾å™¨æ˜¯å¦è™•ç†äº†ç¼ºå¤±å­—æ®µï¼štrade_result.get('risk_reward_ratio', 0) ä½¿ç”¨ get() è€Œä¸æ˜¯ç›´æ¥è¨ªå• trade_result['risk_reward_ratio']
ç¢ºèª TensorFlow fallback æ©Ÿåˆ¶æ˜¯å¦åœ¨æ‰€æœ‰å¯èƒ½çš„ TensorFlow å°å…¥é»éƒ½å¯¦ç¾ï¼šä¸åƒ…æ˜¯ import tensorflowï¼Œé‚„åŒ…æ‹¬ from tensorflow.keras...
é©—è­‰è™›æ“¬å€‰ä½äº‹ä»¶ payload ä¸­çš„ max_pnl å’Œ min_pnl æ˜¯å¦æ­£ç¢ºåˆå§‹åŒ–ï¼šgetattr(position, 'max_pnl', position.pnl_pct) è€Œä¸æ˜¯ç¡¬ç·¨ç¢¼å€¼
ğŸ¯ Replit åŸ·è¡ŒæŒ‡ä»¤