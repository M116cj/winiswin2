2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - ğŸ“Š Pipelineè¨ºæ–·å ±å‘Šï¼ˆå·²æƒæ400å€‹äº¤æ˜“å°ï¼‰
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - ================================================================================
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage0 - ç¸½æƒææ•¸: 400
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage1 - æ•¸æ“šé©—è­‰: æœ‰æ•ˆ=400, æ‹’çµ•=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æ‹’çµ•ç‡: 0.0%
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage2 - è¶¨å‹¢åˆ¤æ–·: æˆåŠŸ=400
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage3 - ä¿¡è™Ÿæ–¹å‘:
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æœ‰æ–¹å‘=376, ç„¡æ–¹å‘=24
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          å„ªå…ˆç´š1(å®Œç¾å°é½Š)=154
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          å„ªå…ˆç´š2(H1+M15)=126
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          å„ªå…ˆç´š3(è¶¨å‹¢åˆæœŸ)=4
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          å„ªå…ˆç´š4(H1ä¸»å°-å¯¬é¬†)=83
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          å„ªå…ˆç´š5(M15+M5-å¯¬é¬†)=9
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage4 - ADXéæ¿¾ï¼ˆv3.18.10+ 3å±¤æ‡²ç½°æ©Ÿåˆ¶ï¼‰:
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          ADX<10(ç¡¬æ‹’çµ•)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          ADX 10-15(å¼·æ‡²ç½°Ã—0.6)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          ADX 15-20(ä¸­æ‡²ç½°Ã—0.8)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          ADXâ‰¥20(é€šé)=376
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - ADXåˆ†å¸ƒ:
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          <10: 0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          10-15: 0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          15-20: 0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          20-25: 0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          â‰¥25: 376
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          ğŸ”¥ ADX<10å æ¯”: 0.0% â† ç¡¬æ‹’çµ•
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          ğŸ”¥ ADX<15å æ¯”: 0.0% â† åŒ…å«å¼·æ‡²ç½°å€é–“
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage5 - ä¿¡å¿ƒåº¦è¨ˆç®—: 376
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage6 - å‹ç‡è¨ˆç®—: 376
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage7 - é›™é–€æª»é©—è­‰:
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          é€šé=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æ‹’çµ•(å‹ç‡ä¸è¶³)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æ‹’çµ•(ä¿¡å¿ƒä¸è¶³)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æ‹’çµ•(R:Rè¶…ç¯„åœ)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage8 - è³ªé‡è©•åˆ†:
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          é€šé(qualityâ‰¥é–€æª»)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æ‹’çµ•(quality<é–€æª»)=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - Stage9 - æ’åº&åŸ·è¡Œ:
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æ’åºå€™é¸=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO -          æœ€çµ‚åŸ·è¡Œ=0
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - 
2025-11-03 12:56:34,184 - src.strategies.rule_based_signal_generator - INFO - ğŸ¯ Pipelineå®Œæ•´æ¼æ–—è½‰åŒ–ç‡: 0.00% (0/400)
é€™æ˜¯ä¸€å€‹åš´é‡çš„ä¿¡è™Ÿéæ¿¾å•é¡Œï¼ç³»çµ±æˆåŠŸç”Ÿæˆäº†376å€‹æœ‰æ–¹å‘çš„ä¿¡è™Ÿï¼Œä½†åœ¨Stage7é›™é–€æª»é©—è­‰å…¨éƒ¨è¢«æ‹’çµ•ï¼Œæœ€çµ‚0å€‹ä¿¡è™Ÿé€šéã€‚

ğŸ” å•é¡Œè¨ºæ–·
é—œéµå•é¡Œé»ï¼š
text
âœ… Stage1-6: å…¨éƒ¨æ­£å¸¸ (376å€‹ä¿¡è™Ÿ)
âŒ Stage7: é›™é–€æª»é©—è­‰ - é€šé=0
âŒ Stage8: è³ªé‡è©•åˆ† - é€šé=0  
âŒ Stage9: æœ€çµ‚åŸ·è¡Œ - 0å€‹ä¿¡è™Ÿ
æ ¹æœ¬åŸå› åˆ†æï¼š
é–€æª»è¨­ç½®éé«˜ï¼šä¿¡å¿ƒåº¦å’Œå‹ç‡é–€æª»å¯èƒ½è¨­ç½®ä¸åˆç†

è¨ˆç®—é‚è¼¯éŒ¯èª¤ï¼šä¿¡å¿ƒåº¦æˆ–å‹ç‡è¨ˆç®—å‡ºç¾å•é¡Œ

æ•¸æ“šè³ªé‡å•é¡Œï¼šæŠ€è¡“æŒ‡æ¨™è¨ˆç®—ä¸æº–ç¢ºå°è‡´è©•åˆ†éä½

ğŸš€ ç«‹å³ä¿®å¾©æ–¹æ¡ˆ
ä¿®å¾©1: æ·»åŠ è©³ç´°çš„é–€æª»è¨ºæ–·
python
# åœ¨ rule_based_signal_generator.py çš„é›™é–€æª»é©—è­‰éšæ®µæ·»åŠ è¨ºæ–·

def _apply_threshold_validation(self, signals: List[Dict]) -> List[Dict]:
    """æ‡‰ç”¨é›™é–€æª»é©—è­‰ï¼ˆå¸¶è©³ç´°è¨ºæ–·ï¼‰"""
    passed_signals = []
    rejection_reasons = {
        'confidence_too_low': 0,
        'win_rate_too_low': 0, 
        'risk_reward_out_of_range': 0
    }
    
    logger.info("ğŸ” é›™é–€æª»é©—è­‰è©³ç´°è¨ºæ–·:")
    
    for i, signal in enumerate(signals[:10]):  # åªæª¢æŸ¥å‰10å€‹ä¿¡è™Ÿçš„è©³ç´°ä¿¡æ¯
        symbol = signal.get('symbol', 'Unknown')
        confidence = signal.get('confidence', 0)
        win_rate = signal.get('win_probability', 0)
        risk_reward = signal.get('risk_reward_ratio', 0)
        
        logger.info(f"  {i+1}. {symbol}: ä¿¡å¿ƒ={confidence:.1f}, å‹ç‡={win_rate:.1f}%, R:R={risk_reward:.2f}")
    
    for signal in signals:
        symbol = signal.get('symbol', 'Unknown')
        confidence = signal.get('confidence', 0)
        win_rate = signal.get('win_probability', 0) 
        risk_reward = signal.get('risk_reward_ratio', 0)
        
        # æª¢æŸ¥ç•¶å‰é–€æª»å€¼
        confidence_threshold = getattr(self, 'confidence_threshold', 60.0)
        win_rate_threshold = getattr(self, 'win_rate_threshold', 55.0)
        min_rr = getattr(self, 'min_risk_reward', 1.2)
        max_rr = getattr(self, 'max_risk_reward', 3.0)
        
        rejection_reason = None
        
        if confidence < confidence_threshold:
            rejection_reason = 'confidence_too_low'
        elif win_rate < win_rate_threshold:
            rejection_reason = 'win_rate_too_low'
        elif not (min_rr <= risk_reward <= max_rr):
            rejection_reason = 'risk_reward_out_of_range'
        else:
            passed_signals.append(signal)
            
        if rejection_reason:
            rejection_reasons[rejection_reason] += 1
    
    # è¼¸å‡ºè©³ç´°æ‹’çµ•åˆ†æ
    logger.info("ğŸ“Š é›™é–€æª»æ‹’çµ•åˆ†æ:")
    total_rejected = len(signals) - len(passed_signals)
    for reason, count in rejection_reasons.items():
        if count > 0:
            percentage = (count / total_rejected) * 100 if total_rejected > 0 else 0
            logger.info(f"  âŒ {reason}: {count}å€‹ ({percentage:.1f}%)")
    
    logger.info(f"âœ… é€šéé©—è­‰: {len(passed_signals)}å€‹ä¿¡è™Ÿ")
    return passed_signals
ä¿®å¾©2: è‡¨æ™‚é™ä½é–€æª»é€²è¡Œæ¸¬è©¦
python
# åœ¨ config.py æˆ–ä¿¡è™Ÿç”Ÿæˆå™¨ä¸­æ·»åŠ è‡¨æ™‚èª¿è©¦é–€æª»

class RuleBasedSignalGenerator:
    def __init__(self, config):
        self.config = config
        # è‡¨æ™‚èª¿è©¦é–€æª» - ç”¨æ–¼è¨ºæ–·å•é¡Œ
        self.debug_mode = True
        self.debug_confidence_threshold = 40.0  # å¾60é™ä½åˆ°40
        self.debug_win_rate_threshold = 45.0    # å¾55é™ä½åˆ°45
        self.debug_min_rr = 1.0                 # å¾1.2é™ä½åˆ°1.0
        self.debug_max_rr = 5.0                 # å¾3.0æé«˜åˆ°5.0
        
    def _get_thresholds(self):
        """ç²å–ç•¶å‰é–€æª»å€¼ï¼ˆèª¿è©¦æ¨¡å¼ä½¿ç”¨è¼ƒä½é–€æª»ï¼‰"""
        if self.debug_mode:
            return {
                'confidence_threshold': self.debug_confidence_threshold,
                'win_rate_threshold': self.debug_win_rate_threshold, 
                'min_risk_reward': self.debug_min_rr,
                'max_risk_reward': self.debug_max_rr
            }
        else:
            return {
                'confidence_threshold': self.confidence_threshold,
                'win_rate_threshold': self.win_rate_threshold,
                'min_risk_reward': self.min_risk_reward,
                'max_risk_reward': self.max_risk_reward
            }
ä¿®å¾©3: æª¢æŸ¥ä¿¡å¿ƒåº¦å’Œå‹ç‡è¨ˆç®—é‚è¼¯
python
def _debug_signal_calculation(self, symbol: str, signal: Dict):
    """èª¿è©¦ä¿¡è™Ÿè¨ˆç®—é‚è¼¯"""
    logger.info(f"ğŸ”§ ä¿¡è™Ÿè¨ˆç®—èª¿è©¦ - {symbol}:")
    
    # æª¢æŸ¥é—œéµè¨ˆç®—åƒæ•¸
    trend_strength = signal.get('trend_strength', 0)
    pattern_score = signal.get('pattern_score', 0) 
    volume_confirmation = signal.get('volume_confirmation', 0)
    time_alignment = signal.get('time_alignment', 0)
    
    logger.info(f"   è¶¨å‹¢å¼·åº¦: {trend_strength:.1f}")
    logger.info(f"   æ¨¡å¼è©•åˆ†: {pattern_score:.1f}")
    logger.info(f"   æˆäº¤é‡ç¢ºèª: {volume_confirmation:.1f}")
    logger.info(f"   æ™‚é–“å°é½Š: {time_alignment:.1f}")
    
    # è¨ˆç®—ä¿¡å¿ƒåº¦çš„å„å€‹çµ„æˆéƒ¨åˆ†
    base_confidence = (trend_strength + pattern_score + volume_confirmation + time_alignment) / 4
    logger.info(f"   åŸºç¤ä¿¡å¿ƒåº¦: {base_confidence:.1f}")
    
    final_confidence = signal.get('confidence', 0)
    win_rate = signal.get('win_probability', 0)
    
    logger.info(f"   æœ€çµ‚ä¿¡å¿ƒåº¦: {final_confidence:.1f}")
    logger.info(f"   å‹ç‡: {win_rate:.1f}%")
ä¿®å¾©4: ç«‹å³éƒ¨ç½²è¨ºæ–·
python
# åœ¨ generate_signal æ–¹æ³•ä¸­æ·»åŠ èª¿è©¦

def generate_signal(self, symbol: str, multi_tf_data: Dict) -> Optional[Dict]:
    try:
        # ... ç¾æœ‰é‚è¼¯ ...
        
        signal = self._generate_ict_smc_signals(symbol, multi_tf_data)
        
        # æ·»åŠ èª¿è©¦ï¼šæª¢æŸ¥å‰5å€‹symbolçš„ä¿¡è™Ÿè¨ˆç®—
        if self._pipeline_stats['stage3_with_direction'] <= 5:
            self._debug_signal_calculation(symbol, signal)
            
        return signal
        
    except Exception as e:
        logger.error(f"âŒ {symbol} ä¿¡è™Ÿç”Ÿæˆç•°å¸¸: {e}")
        return None
ğŸš€ ç«‹å³åŸ·è¡Œæ­¥é©Ÿ
bash
# 1. æ·»åŠ è¨ºæ–·ä»£ç¢¼åˆ° rule_based_signal_generator.py
# 2. éƒ¨ç½²è¨ºæ–·ç‰ˆæœ¬
git add src/strategies/rule_based_signal_generator.py
git commit -m "è¨ºæ–·: æ·»åŠ é›™é–€æª»é©—è­‰è©³ç´°è¨ºæ–· + è‡¨æ™‚èª¿è©¦é–€æª»"
git push origin main

# 3. ç›£æ§è¨ºæ–·æ—¥èªŒ
railway logs --follow | grep -E "é›™é–€æª»é©—è­‰è©³ç´°è¨ºæ–·|ä¿¡è™Ÿè¨ˆç®—èª¿è©¦|é€šéé©—è­‰"
ğŸ“Š é æœŸè¨ºæ–·è¼¸å‡º
éƒ¨ç½²å¾Œä½ æ‡‰è©²çœ‹åˆ°ï¼š

text
ğŸ” é›™é–€æª»é©—è­‰è©³ç´°è¨ºæ–·:
  1. BTCUSDT: ä¿¡å¿ƒ=35.2, å‹ç‡=42.3%, R:R=1.8
  2. ETHUSDT: ä¿¡å¿ƒ=28.7, å‹ç‡=38.9%, R:R=2.1
  3. BNBUSDT: ä¿¡å¿ƒ=45.1, å‹ç‡=48.2%, R:R=1.5

ğŸ“Š é›™é–€æª»æ‹’çµ•åˆ†æ:
  âŒ confidence_too_low: 376å€‹ (100.0%)
  âŒ win_rate_too_low: 376å€‹ (100.0%) 
  âœ… é€šéé©—è­‰: 0å€‹ä¿¡è™Ÿ

ğŸ”§ ä¿¡è™Ÿè¨ˆç®—èª¿è©¦ - BTCUSDT:
  è¶¨å‹¢å¼·åº¦: 45.2
  æ¨¡å¼è©•åˆ†: 32.1
  æˆäº¤é‡ç¢ºèª: 28.5
  æ™‚é–“å°é½Š: 35.0
  åŸºç¤ä¿¡å¿ƒåº¦: 35.2
  æœ€çµ‚ä¿¡å¿ƒåº¦: 35.2
  å‹ç‡: 42.3%
ğŸ¯ æ ¹æ“šè¨ºæ–·çµæœçš„ä¸‹ä¸€æ­¥è¡Œå‹•
å¦‚æœä¿¡å¿ƒåº¦æ™®ééä½ï¼š
èª¿æ•´ä¿¡å¿ƒåº¦è¨ˆç®—å…¬å¼

é™ä½ä¿¡å¿ƒåº¦é–€æª»ï¼ˆ60 â†’ 45ï¼‰

å„ªåŒ–æŠ€è¡“æŒ‡æ¨™æ¬Šé‡

å¦‚æœå‹ç‡æ™®ééä½ï¼š
èª¿æ•´å‹ç‡è¨ˆç®—é‚è¼¯

é™ä½å‹ç‡é–€æª»ï¼ˆ55 â†’ 48ï¼‰

æª¢æŸ¥æ­·å²æ•¸æ“šè³ªé‡

å¦‚æœR:Ræ¯”ç‡ç•°å¸¸ï¼š
èª¿æ•´é¢¨éšªå›å ±è¨ˆç®—

æ”¾å¯¬R:Rç¯„åœï¼ˆ1.2-3.0 â†’ 1.0-4.0ï¼‰