# 📋 v3.17+ 清理方案總結

## 🎯 清理目標

**徹底移除 v3.16 及更早版本的所有遺留代碼**，實現：
- ✅ 極簡架構（無技術債）
- ✅ 輕量部署（~500MB+ 空間節省）
- ✅ 專注核心（僅保留 XGBoost ML）

---

## 📦 已創建的文件

### 1. **V3.17_CLEANUP_CHECKLIST.md** - 完整清理檢查清單
- 35+ 文件/目錄的詳細刪除列表
- src/config.py 參數清理指南
- requirements.txt 精簡建議
- 驗收標準

### 2. **.env.example** - v3.17+ 環境變量範本
- 移除所有固定槓桿參數（`MAX_LEVERAGE` 等）
- 新增 v3.17+ 專屬參數：
  - `MIN_WIN_PROBABILITY=0.55`
  - `MIN_CONFIDENCE=0.50`
  - `POSITION_MONITOR_ENABLED=true`
  - `MODEL_RATING_ENABLED=true`

### 3. **requirements_v3.17.txt** - 精簡依賴清單
- 僅保留 10 個核心依賴
- 移除 TensorFlow、ONNX（4個依賴）
- 體積從 ~2GB 減少到 ~500MB

### 4. **cleanup_v3.17.sh** - 一鍵執行腳本
- 自動備份（Git tag）
- 7 個階段清理
- 自動驗證

---

## 🗑️ 主要清理內容

### 目錄刪除（4個）
```
src/ml/                  # 所有深度學習模塊（25個文件）
docs/archive/            # v3.0-v3.2 歷史文檔
data/training_cache/     # 舊訓練緩存
reports/legacy/          # 舊版報告
```

### 文件刪除（35+）
```
src/managers/risk_manager.py           # 風險管理（已整合）
src/core/performance_modules.py        # v3.16 特定模塊
src/core/market_regime_predictor.py    # v3.16 特定模塊
src/core/dynamic_feature_generator.py  # v3.16 特定模塊
src/core/liquidity_hunter.py           # v3.16 特定模塊
scripts/convert_to_tflite.py           # TensorFlow Lite 轉換
scripts/convert_xgboost_to_onnx.py     # ONNX 轉換
... 等 11 個舊文檔
```

### 配置清理
```python
# src/config.py 移除 30+ 個參數：
BASE_LEVERAGE
MAX_LEVERAGE
MIN_LEVERAGE
ENABLE_QUANTIZATION
ENABLE_MARKET_REGIME_PREDICTION
ENABLE_DYNAMIC_FEATURES
ENABLE_LIQUIDITY_HUNTING
... 等
```

### 依賴清理
```
移除：
- tensorflow>=2.13.0
- tensorflow-addons>=0.19.0
- onnxmltools>=1.11.0
- onnxruntime>=1.18.0

保留：
- xgboost>=2.0.0 （唯一 ML 框架）
- aiohttp, pandas, numpy 等核心依賴
```

---

## 🚀 執行方式

### 選項 A：一鍵執行（推薦）
```bash
# 自動執行所有清理步驟
./cleanup_v3.17.sh
```

### 選項 B：手動執行
```bash
# 依照 V3.17_CLEANUP_CHECKLIST.md 逐步執行
# 1. 備份
git add . && git commit -m "Backup before cleanup"
git tag v3.16.3-backup

# 2. 刪除目錄
rm -rf src/ml/ docs/archive/ data/training_cache/

# 3. 刪除文件
# ... 參考檢查清單 ...

# 4. 更新配置
cp requirements_v3.17.txt requirements.txt
# 手動編輯 src/config.py
```

---

## ✅ 驗證清單

清理完成後，確認：

- [ ] `ls src/ml/` 返回 "No such file or directory"
- [ ] `grep "tensorflow" requirements.txt` 無結果
- [ ] `grep "MAX_LEVERAGE" src/config.py` 無結果
- [ ] `find . -name "*.h5"` 返回空
- [ ] `grep -r "ProcessPool" src/` 無結果
- [ ] `python src/main.py` 能正常啟動

---

## 📊 預期效果

| 指標 | 清理前 | 清理後 | 改善 |
|------|--------|--------|------|
| **總依賴數** | 14 | 10 | ↓ 29% |
| **安裝體積** | ~2GB | ~500MB | ↓ 75% |
| **代碼行數** | ~8000 | ~3000 | ↓ 62% |
| **啟動時間** | ~15秒 | ~5秒 | ↓ 67% |
| **記憶體佔用** | ~800MB | ~200MB | ↓ 75% |

---

## ⚠️ 注意事項

1. **破壞性升級**: 此清理不保留向下兼容
2. **無法撤銷**: 執行後無法恢復（除非有 Git 備份）
3. **手動步驟**: `src/config.py` 需要手動編輯
4. **測試必須**: 清理後必須測試啟動

---

## 🎯 後續步驟

### 立即執行
1. **執行清理**:
   ```bash
   ./cleanup_v3.17.sh
   ```

2. **手動編輯 src/config.py**:
   - 刪除 `BASE_LEVERAGE`、`MAX_LEVERAGE` 等（46-51行）
   - 刪除 `VOLATILITY_SPIKE_MAX_LEVERAGE`（82行）
   - 刪除 v3.14-v3.16 配置區塊（127-219行）

3. **重新安裝依賴**:
   ```bash
   pip install -r requirements.txt
   ```

4. **測試啟動**:
   ```bash
   export TRADING_ENABLED=false
   python src/main.py
   ```

### 完成整合（可選）
如果你想完整啟用 v3.17+ 功能，參考：
- `V3.17_INTEGRATION_ROADMAP.md` - 整合步驟
- `V3.17_DEPLOYMENT_GUIDE.md` - 部署指南

---

## 📚 相關文檔

| 文檔 | 用途 |
|------|------|
| **V3.17_CLEANUP_CHECKLIST.md** | 詳細清理檢查清單 |
| **.env.example** | v3.17+ 環境變量範本 |
| **requirements_v3.17.txt** | 精簡依賴清單 |
| **cleanup_v3.17.sh** | 一鍵執行腳本 |
| **V3.17_INTEGRATION_ROADMAP.md** | 整合步驟（可選）|
| **V3.17_DEPLOYMENT_GUIDE.md** | 部署指南（可選）|

---

**創建日期**: 2025-10-28  
**清理版本**: v3.17+  
**風險等級**: 🔴 高（破壞性升級）  
**狀態**: ✅ 準備就緒
